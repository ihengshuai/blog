<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建k8s集群 | hengshuai's blog</title>
    <meta name="description" content="Kubernetes 是一个开源的容器编排平台，用于自动化部署、扩展和管理容器化应用程序，提高应用程序的可靠性和安全性，本文使用kubeadm、minikube在虚拟机Centos系统上搭建k8s集群">
    <meta name="generator" content="VitePress v1.0.0-rc.40">
    <link rel="preload stylesheet" href="/assets/style.NwX665RZ.css" as="style">
    
    <script type="module" src="/assets/app.0fd12bH9.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.SV1ROkXV.js">
    <link rel="modulepreload" href="/assets/chunks/theme.l3RjJB8k.js">
    <link rel="modulepreload" href="/assets/fullstack_k8s_install.md.shPzlnU9.lean.js">
    <meta name="renderer" content="webkit">
    <meta name="author" content="ihengshuai@foxmail.com">
    <meta rel="profile" href="http://gmpg.org/xfn/11">
    <meta name="referrer" content="same-origin">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="theme-color" content="#646cff">
    <meta name="google-site-verification" content="T4xYOJVbUxeU5aZRUROdmEf_NWCjnRDwfXnzKYUVcFM">
    <meta name="baidu-site-verification" content="code-IpD4H7zKv4">
    <link rel="apple-touch-icon" href="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/192.png">
    <meta name="apple-mobile-web-app-title" content="hengshuai&#39;s blog">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#747bff">
    <meta rel="apple-touch-startup-image" href="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/192.png">
    <link rel="manifest" href="/manifest.json">
    <script id="ENV_VARIABLES">window.__ENV_VARIABLES__={ENV_PROD:!0};</script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V5736Z4DWT"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-V5736Z4DWT");</script>
    <script>var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6eda4089bba0c6f46ad6e00658a80f3";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta name="keywords" content="k8s安装,k8s搭建,k8s集群,kubeadm,minikube,k8s教程">
    <meta property="og:type" content="website">
    <meta property="og:title" content="搭建k8s集群 | hengshuai&#39;s blog">
    <meta property="og:url" content="https://blog.usword.cn/fullstack/k8s/install.html">
    <meta property="og:site_name" content="hengshuai&#39;s blog">
    <meta property="og:description" content="Kubernetes 是一个开源的容器编排平台，用于自动化部署、扩展和管理容器化应用程序，提高应用程序的可靠性和安全性，本文使用kubeadm、minikube在虚拟机Centos系统上搭建k8s集群">
    <meta property="og:image" content="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-k8s.png">
    <meta name="twitter:url" value="https://blog.usword.cn/fullstack/k8s/install.html">
    <meta name="twitter:title" value="搭建k8s集群 | hengshuai&#39;s blog">
    <meta name="twitter:domain" value="https://blog.usword.cn">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" value="Kubernetes 是一个开源的容器编排平台，用于自动化部署、扩展和管理容器化应用程序，提高应用程序的可靠性和安全性，本文使用kubeadm、minikube在虚拟机Centos系统上搭建k8s集群">
    <meta name="twitter:image" content="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-k8s.png">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-e69ff593><!--[--><!--]--><!--[--><span tabindex="-1" data-v-056fc64b></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-056fc64b> Skip to content </a><!--]--><!----><header class="VPNav" data-v-e69ff593 data-v-50ee880a><div class="VPNavBar has-sidebar" data-v-50ee880a data-v-575c0058><div class="wrapper" data-v-575c0058><div class="container" data-v-575c0058><div class="title" data-v-575c0058><div class="VPNavBarTitle has-sidebar" data-v-575c0058 data-v-5a8562d3><a class="title" href="/" data-v-5a8562d3><!--[--><!--]--><!----><!--[-->Hengshuai&#39;s blog<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-575c0058><div class="content-body" data-v-575c0058><!--[--><!--]--><div class="VPNavBarSearch search" data-v-575c0058><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-575c0058 data-v-3e017cdf><span id="main-nav-aria-label" class="visually-hidden" data-v-3e017cdf>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/frontend/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Frontend</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fullstack/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Fullstack</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/article/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Article</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://case.usword.cn" target="_blank" rel="noreferrer" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Case</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/me.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Me</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-575c0058 data-v-3bd0ddce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-3bd0ddce data-v-62e667eb data-v-0438efbe><span class="check" data-v-0438efbe><span class="icon" data-v-0438efbe><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-62e667eb><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-62e667eb><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-575c0058 data-v-47b9b291 data-v-f534a663><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ihengshuai" aria-label="github" target="_blank" rel="noopener" data-v-f534a663 data-v-70b9b240><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-575c0058 data-v-edb1db61 data-v-41b0fac7><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-41b0fac7><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-41b0fac7><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-41b0fac7><div class="VPMenu" data-v-41b0fac7 data-v-32c6b1d0><!----><!--[--><!--[--><!----><div class="group" data-v-edb1db61><div class="item appearance" data-v-edb1db61><p class="label" data-v-edb1db61>Appearance</p><div class="appearance-action" data-v-edb1db61><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-edb1db61 data-v-62e667eb data-v-0438efbe><span class="check" data-v-0438efbe><span class="icon" data-v-0438efbe><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-62e667eb><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-62e667eb><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-edb1db61><div class="item social-links" data-v-edb1db61><div class="VPSocialLinks social-links-list" data-v-edb1db61 data-v-f534a663><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ihengshuai" aria-label="github" target="_blank" rel="noopener" data-v-f534a663 data-v-70b9b240><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-575c0058 data-v-279e6295><span class="container" data-v-279e6295><span class="top" data-v-279e6295></span><span class="middle" data-v-279e6295></span><span class="bottom" data-v-279e6295></span></span></button></div></div></div></div><div class="divider" data-v-575c0058><div class="divider-line" data-v-575c0058></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-e69ff593 data-v-2ebb1e0d><div class="container" data-v-2ebb1e0d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2ebb1e0d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2ebb1e0d><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2ebb1e0d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2ebb1e0d data-v-ba90ba94><button data-v-ba90ba94>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-e69ff593 data-v-983e8791><div class="curtain" data-v-983e8791></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-983e8791><span class="visually-hidden" id="sidebar-aria-label" data-v-983e8791> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-983e8791><section class="VPSidebarItem level-0" data-v-983e8791 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h2 class="text" data-v-3445ab86>Docker</h2><!----></div><div class="items" data-v-3445ab86><!--[--><section class="VPSidebarItem level-1" data-v-3445ab86 data-v-3445ab86><!----><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/install-configure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Docker安装与配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/base-tutorial.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Docker基础教程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/volume-store.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Docker数据卷与持久化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/network.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Docker网络原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/dockerfile.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>使用Dockerfile构建镜像</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/docker-compose.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>使用DockerCompose部署服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/npm-repository.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>使用Docker搭建npm仓库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/docker-repository.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>搭建docker私有仓库</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-983e8791><section class="VPSidebarItem level-0" data-v-983e8791 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h2 class="text" data-v-3445ab86>Gitlab</h2><!----></div><div class="items" data-v-3445ab86><!--[--><section class="VPSidebarItem level-1" data-v-3445ab86 data-v-3445ab86><!----><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/gitlab/install-configure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>安装与配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/gitlab/gitlab-runner-install-configure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Gitlab Runner安装与配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/gitlab/gitlab-pipeline.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Gitlab流水线配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/gitlab/npm-repository.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Gitlab搭建npm仓库</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-983e8791><section class="VPSidebarItem level-0 has-active" data-v-983e8791 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h2 class="text" data-v-3445ab86>Kubernetes</h2><!----></div><div class="items" data-v-3445ab86><!--[--><section class="VPSidebarItem level-1 has-active" data-v-3445ab86 data-v-3445ab86><!----><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/k8s/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>初识kubernetes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/k8s/install.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>搭建k8s集群</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-e69ff593 data-v-5a285343><div class="VPDoc has-sidebar has-aside" data-v-5a285343 data-v-fb80de84><!--[--><!--]--><div class="container" data-v-fb80de84><div class="aside" data-v-fb80de84><div class="aside-curtain" data-v-fb80de84></div><div class="aside-container" data-v-fb80de84><div class="aside-content" data-v-fb80de84><div class="VPDocAside" data-v-fb80de84 data-v-bb0b59e9><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-bb0b59e9 data-v-ea307b6d><div class="content" data-v-ea307b6d><div class="outline-marker" data-v-ea307b6d></div><div class="outline-title" role="heading" aria-level="2" data-v-ea307b6d>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-ea307b6d><span class="visually-hidden" id="doc-outline-aria-label" data-v-ea307b6d> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-ea307b6d data-v-20500810><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-bb0b59e9></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-fb80de84><div class="content-container" data-v-fb80de84><!--[--><!--]--><main class="main" data-v-fb80de84><div style="position:relative;" class="vp-doc _fullstack_k8s_install external-link-icon-enabled" data-v-fb80de84><div><h1 id="搭建k8s集群" tabindex="-1">搭建k8s集群 <a class="header-anchor" href="#搭建k8s集群" aria-label="Permalink to &quot;搭建k8s集群&quot;">​</a></h1><p>本文带着大家按照<a href="https://kubernetes.io/zh-cn/docs/home/" target="_blank" rel="noreferrer">官方文档</a>进行k8s搭建，环境是基于arm架构centos7.9的虚拟机环境进行的，如果你使用的是非ARM架构的系统，仍然可以参考文章指导，而涉及到的一些安装链接需要根据情况替换成兼容你自己系统的链接</p><p>本次安装的版本为1.26.0版本，将会通过多种工具进行搭建，如：minikube、kubeadm等等</p><blockquote><p>现阶段k8s的迭代速度还是很快的，文章中的一些配置可能不适用了，如果你按照文档过程中遇到了问题，也请参考下官方文档</p></blockquote><p>阅读要求：</p><ul><li>熟悉linux命令</li><li>了解容器化技术，如：docker</li></ul><h2 id="配置要求" tabindex="-1">配置要求 <a class="header-anchor" href="#配置要求" aria-label="Permalink to &quot;配置要求&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>为了安装的正常进行，请确保节点的主机名、mac地址、product_uuid等不能重复，如果你使用了虚拟机搭建，最好不用使用虚拟机克隆，避免出现一些特殊的问题</p></div><ul><li>一台兼容的 Linux 主机。Kubernetes项目为基于Debian和RedHat的Linux发行版以及一些不提供包管理器的发行版提供通用的指令</li><li>每台机器 2 GB 或更多的 RAM（如果少于这个数字将会影响你应用的运行内存）</li><li>CPU 2 核心及以上</li><li>集群中的所有机器的网络彼此均能相互连接（公网和内网都可以）</li><li>节点之中不可以有重复的主机名、MAC 地址或 product_uuid，可以通过<code>cat /sys/class/dmi/id/product_uuid</code>查看</li><li>开启机器上的某些端口</li><li>禁用交换分区。为了保证 kubelet 正常工作，你必须禁用交换分区</li></ul><blockquote><p>更多注意事项详细请参考<a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" target="_blank" rel="noreferrer">官方文档</a></p></blockquote><h2 id="机器划分" tabindex="-1">机器划分 <a class="header-anchor" href="#机器划分" aria-label="Permalink to &quot;机器划分&quot;">​</a></h2><p>这里将准备1台master节点、2台worker节点进行搭建，其对应的相关配置如下：</p><ul><li>master节点：4C、4G、60G</li><li>woker节点：2C、2G、40G</li></ul><h2 id="环境准备" tabindex="-1">环境准备 <a class="header-anchor" href="#环境准备" aria-label="Permalink to &quot;环境准备&quot;">​</a></h2><p>相较于其他软件的安装k8s的安装其实相对繁琐，需要做一系列的环境准备，接下来就一步一步来配置吧，以下步骤需要在每台机器上进行配置</p><h3 id="内核升级" tabindex="-1">内核升级 <a class="header-anchor" href="#内核升级" aria-label="Permalink to &quot;内核升级&quot;">​</a></h3><p>k8s使用cgroup来管理容器资源，cgroup v2 是 Linux cgroup API 的最新版本, 提供了一个具有增强的资源管理能力的统一控制系统，使用它需要你的 Linux 发行版在内核版本 5.8 或更高版本</p><p>查看内核版本：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> uname -r</span></span>
<span class="line"><span style="color:#FFCB6B;">5.11.12-300.el7.aarch64</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>版本升级：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> update kernel -y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">reboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="更改主机名" tabindex="-1">更改主机名 <a class="header-anchor" href="#更改主机名" aria-label="Permalink to &quot;更改主机名&quot;">​</a></h3><p>如果你的主机名没有重复可以跳过此步骤，建议给每个机器起一个有意义的名字方便管理</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">hostnamectl</span><span style="color:#C3E88D;"> set-hostname k8s-master</span></span>
<span class="line"><span style="color:#FFCB6B;">hostnamectl</span><span style="color:#C3E88D;"> set-hostname k8s-node1</span></span>
<span class="line"><span style="color:#FFCB6B;">hostnamectl</span><span style="color:#C3E88D;"> set-hostname k8s-node2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里将master节点命名：k8s-master，2台worker节点命名：k8s-node1、k8s-node2</p><h3 id="配置dns" tabindex="-1">配置DNS <a class="header-anchor" href="#配置dns" aria-label="Permalink to &quot;配置DNS&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">192.168.10.100</span><span style="color:#C3E88D;"> cluster-endpoint</span></span>
<span class="line"><span style="color:#FFCB6B;">192.168.10.100</span><span style="color:#C3E88D;"> k8s-master</span></span>
<span class="line"><span style="color:#FFCB6B;">192.168.10.101</span><span style="color:#C3E88D;"> k8s-node1</span></span>
<span class="line"><span style="color:#FFCB6B;">192.168.10.102</span><span style="color:#C3E88D;"> k8s-node2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>以上所有机器均在<code>192.168.10/24</code>网段，每台机器上配置以上的DNS确保可以通过主机名互相进行访问，请根据自己实际情况配置机器网络，<u>检查能否互通</u></p><blockquote><p>配置cluster-endpoint 初始化集群master节点时作为 control-plane-endpoint 参数使用</p></blockquote><h3 id="配置防火墙" tabindex="-1">配置防火墙 <a class="header-anchor" href="#配置防火墙" aria-label="Permalink to &quot;配置防火墙&quot;">​</a></h3><p>由于本人是在虚拟机上演示，避免不必要的网关问题，直接将防火墙关闭了，如果在其他环境请自行处理好防火墙</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 检查防火墙</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> status firewalld.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 永久关闭防火墙</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> disable firewalld.service --now</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="禁用selinux" tabindex="-1">禁用selinux <a class="header-anchor" href="#禁用selinux" aria-label="Permalink to &quot;禁用selinux&quot;">​</a></h3><p>安全增强型Linux（SELinux）是一个Linux内核的功能，它提供支持访问控制的安全政策保护机制。一般情况下，开启SELinux会提高系统的安全性，但是会破坏操作系统的文件，造成系统无法启动的问题</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看是否关闭 SELINUX的值为 disabled、enforcing、permissive</span></span>
<span class="line"><span style="color:#FFCB6B;">getenforce</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>永久关闭：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#C3E88D;"> /etc/selinux/config</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 找到SELINUX=enforcing，按i进入编辑模式，将参数修改为SELINUX=disabled</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>本人使用以上关闭selinux后重启机器会很慢，并且会伴随重启，这是原生的bug，如果你也遇到以上关闭后重启很慢并且启动不了，可以通过以下的方式绕过：</p><ol><li>如果已经关闭进行重启了，在重启界面，按下<code>e</code> 进入控制台，找到 <code>fi</code>条件最后 加上<code>selinux=0</code>然后按<code>Ctrl+x</code>就可以进去了</li><li>进去后将上面修改的<code>selinux/config</code>的selinux状态改为<code>enforcing</code>，然后编辑内核启动文件<div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">vim</span><span style="color:#C3E88D;"> /etc/grub2-efi.cfg</span></span>
<span class="line"><span style="color:#FFCB6B;">linux</span><span style="color:#C3E88D;"> /vmlinuz-5.11.12-300.el7.aarch64 root=/dev/mapper/cl_fedora-root ro crashkernel=auto rd.lvm.lv=cl_fedora/root rd.lvm.lv=cl_fedora/swap rhgb quiet LANG=en_US.UTF-8 selinux=</span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 文件内容比较多，通过 /UTF-8 快速定位</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>以上在 <code>/etc/grub2-efi.cfg</code> 文件在添加了 <code>...en_US.UTF-8 </code> 后添加了 <code>selinux=0</code>这样每次重启也是关闭状态的，也解决了第一种方法关闭卡顿的问题</li></ol><h3 id="禁用swap" tabindex="-1">禁用swap <a class="header-anchor" href="#禁用swap" aria-label="Permalink to &quot;禁用swap&quot;">​</a></h3><p>swap 是 Linux 操作系统的一种机制，用于在物理内存不足时，将一部分不常用的内存页交换到硬盘上。这虽然可以让系统在内存不足时继续运行，但是在某些情况下会对系统性能和稳定性产生负面影响，可能导致容器应用程序出现问题，甚至导致节点崩溃</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> free -h</span></span>
<span class="line"><span style="color:#FFCB6B;">total</span><span style="color:#C3E88D;">        used        free      shared  buff/cache   available</span></span>
<span class="line"><span style="color:#FFCB6B;">Mem:</span><span style="color:#F78C6C;">           1.4</span><span style="color:#C3E88D;">G        </span><span style="color:#F78C6C;">183</span><span style="color:#C3E88D;">M        </span><span style="color:#F78C6C;">968</span><span style="color:#C3E88D;">M        </span><span style="color:#F78C6C;">8.6</span><span style="color:#C3E88D;">M        </span><span style="color:#F78C6C;">306</span><span style="color:#C3E88D;">M        </span><span style="color:#F78C6C;">1.2</span><span style="color:#C3E88D;">G</span></span>
<span class="line"><span style="color:#FFCB6B;">Swap:</span><span style="color:#F78C6C;">          2.0</span><span style="color:#C3E88D;">G          </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">B        </span><span style="color:#F78C6C;">2.0</span><span style="color:#C3E88D;">G</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>临时关闭：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">swapoff</span><span style="color:#C3E88D;"> -a</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>永久关闭：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 编辑此文件，注释掉所有swap的行，重启</span></span>
<span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#C3E88D;"> /etc/fstab</span></span>
<span class="line"><span style="color:#FFCB6B;">reboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="同步时区" tabindex="-1">同步时区 <a class="header-anchor" href="#同步时区" aria-label="Permalink to &quot;同步时区&quot;">​</a></h3><p>由于k8s时区不同可能会影响容器中应用程序的时间戳和日志记录，从而导致调试和排错变得困难。此外，多个节点之间的时钟同步也是保证集群中各组件之间时间一致性的必要条件。若你确定节点的时间一致可以忽略此步骤</p><p>安装<code>ntpdate</code>：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> install wntp -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>同步时区：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#C3E88D;"> -sf</span><span style="color:#C3E88D;"> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">Asia/Shanghai</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> /etc/timezone</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>同步时间：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ntpdate</span><span style="color:#C3E88D;"> time2.aliyun.com</span></span>
<span class="line"><span style="color:#FFCB6B;">crontab</span><span style="color:#C3E88D;"> -e</span></span>
<span class="line"><span style="color:#89DDFF;">*</span><span style="color:#BABED8;">/5 </span><span style="color:#89DDFF;">*</span><span style="color:#89DDFF;"> *</span><span style="color:#89DDFF;"> *</span><span style="color:#89DDFF;"> *</span><span style="color:#BABED8;"> ntpdate time2.aliyun.com</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="转发-ipv4-并让-iptables-看到桥接流量" tabindex="-1">转发 IPv4 并让 iptables 看到桥接流量 <a class="header-anchor" href="#转发-ipv4-并让-iptables-看到桥接流量" aria-label="Permalink to &quot;转发 IPv4 并让 iptables 看到桥接流量&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#89DDFF;"> &lt;&lt;</span><span style="color:#89DDFF;">EOF</span><span style="color:#89DDFF;"> |</span><span style="color:#BABED8;"> sudo tee /etc/modules-load.d/k8s.conf</span></span>
<span class="line"><span style="color:#C3E88D;">overlay</span></span>
<span class="line"><span style="color:#C3E88D;">br_netfilter</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">modprobe</span><span style="color:#C3E88D;"> overlay</span></span>
<span class="line"><span style="color:#FFCB6B;">modprobe</span><span style="color:#C3E88D;"> br_netfilter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 设置所需的 sysctl 参数，参数在重新启动后保持不变</span></span>
<span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#89DDFF;"> &lt;&lt;</span><span style="color:#89DDFF;">EOF</span><span style="color:#89DDFF;"> |</span><span style="color:#BABED8;"> sudo tee /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="color:#C3E88D;">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="color:#C3E88D;">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="color:#C3E88D;">net.ipv4.ip_forward = 1</span></span>
<span class="line"><span style="color:#C3E88D;">vm.swappiness = 0</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 应用 sysctl 参数而不重新启动</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#C3E88D;"> sysctl --system</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>运行以下指令查看以上配置是否正确：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 通过运行指令确认`br_netfilter`和`overlay`模块被加载</span></span>
<span class="line"><span style="color:#FFCB6B;">lsmod</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> br_netfilter</span></span>
<span class="line"><span style="color:#FFCB6B;">lsmod</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> overlay</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>通过运行以下指令确认以上系统变量在你的 sysctl 配置中被设置为 1</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">sysctl</span><span style="color:#C3E88D;"> net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="安装ipvs" tabindex="-1">安装ipvs <a class="header-anchor" href="#安装ipvs" aria-label="Permalink to &quot;安装ipvs&quot;">​</a></h3><p>IPVS（IP Virtual Server）是一个高性能的负载均衡技术，它可以将内部流量分发到多个后端 Pod，提高了容器应用程序的可用性、可扩展性和性能。为了提高 k8s 中 Service 的性能、可用性和灵活性，推荐使用 IPVS 作为负载均衡方式</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> -y</span><span style="color:#C3E88D;"> install ipset ipvsadm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>加载 IPVS 模块：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> /etc/sysconfig/modules/ipvs.modules </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#89DDFF;">EOF</span></span>
<span class="line"><span style="color:#C3E88D;">#!/bin/bash</span></span>
<span class="line"><span style="color:#C3E88D;">modprobe -- ip_vs</span></span>
<span class="line"><span style="color:#C3E88D;">modprobe -- ip_vs_rr</span></span>
<span class="line"><span style="color:#C3E88D;">modprobe -- ip_vs_wrr</span></span>
<span class="line"><span style="color:#C3E88D;">modprobe -- ip_vs_sh</span></span>
<span class="line"><span style="color:#C3E88D;">modprobe -- nf_conntrack</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"><span style="color:#BABED8;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#F78C6C;"> 755</span><span style="color:#C3E88D;"> /etc/sysconfig/modules/ipvs.modules </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#FFCB6B;"> bash</span><span style="color:#C3E88D;"> /etc/sysconfig/modules/ipvs.modules</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">lsmod</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> -e</span><span style="color:#C3E88D;"> ip_vs -e nf_conntrack</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> enable ipvsadm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="容器运行时" tabindex="-1">容器运行时 <a class="header-anchor" href="#容器运行时" aria-label="Permalink to &quot;容器运行时&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">注意</p><p>自 1.24 版起，Dockershim 已从 Kubernetes 项目中移除。v1.24 之前的 Kubernetes 版本直接集成了 Docker Engine 的一个组件，名为 dockershim。 这种特殊的直接整合不再是 Kubernetes 的一部分</p></div><p>k8s使用Container Runtime Interface (CRI) CLI和容器运行时进行交互，支持<code>containerd</code>、<code>cri-o</code>、<code>docker engine</code>等多种容器运行时，这里将分别演示containerd和docker engine两种使用</p><h3 id="docker" tabindex="-1">docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;docker&quot;">​</a></h3><p>使用docker engine需要安装docker，其安装这里不详细列出了，请参考我的<a href="/fullstack/docker/install-configure.html">「Docker安装与配置」</a>一文。</p><p>这里需要注意配置docker的默认情况会使用<code>cgroupfs</code>来管理容器的资源，而k8s默认使用<code>systemd cgroup</code>来管理资源，需要将docker和k8s保持一致，修改<code>/etc/docker/daemon.json</code>配置文件：</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	// ...</span></span>
<span class="line"><span style="color:#89DDFF;">	&quot;</span><span style="color:#C792EA;">exec-opts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">native.cgroupdriver=systemd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>由于Dockershim 已从 Kubernetes 项目中移除，还需要安装<a href="https://github.com/Mirantis/cri-dockerd" target="_blank" rel="noreferrer">cri-dockerd</a>容器运行时接口来对接k8s，可以采用以下两种方式进行安装：</p><ol><li><p>直接下载安装包：(<a href="https://github.com/Mirantis/cri-dockerd/releases" target="_blank" rel="noreferrer">仓库里</a>会发行很多不同版本、操作系统的包，可以自行选择)</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> wget https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.1/cri-dockerd-0.3.1.arm64.tgz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">100%[</span><span style="color:#BABED8;">==========================================================&gt;] </span><span style="color:#F78C6C;">24</span><span style="color:#C3E88D;">,356,769  </span><span style="color:#F78C6C;">33.0</span><span style="color:#C3E88D;">MB/s 用时 </span><span style="color:#F78C6C;">0.7</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#FFCB6B;">2020-04-05</span><span style="color:#F78C6C;"> 08</span><span style="color:#C3E88D;">:38:04 </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">33.0</span><span style="color:#C3E88D;"> MB/s</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;"> - 已保存 “cri-dockerd-0.3.1.arm64.tgz” [</span><span style="color:#F78C6C;">24356769</span><span style="color:#C3E88D;">/24356769]</span><span style="color:#BABED8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这里下载压缩包后解压文件，然后移动到指定位置，<u>其他主机重复此步骤或直接将其拷贝到目标主机</u>：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#C3E88D;"> xf cri-dockerd-0.3.1.arm64.tgz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#C3E88D;"> cri-dockerd/cri-dockerd /usr/bin/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这种方式安装比较简单，你也可以选择自行编译</p></li><li><p>自行编译：仓库中也允许自己编译代码最终生成<code>cri-dockerd</code>，如果你需要定制一些操作可以使用此步骤，需要注意的是编译依赖go环境，因此你的主机上需要安装go，这里不再赘述：</p><p>克隆仓库：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> clone https://github.com/Mirantis/cri-dockerd.git</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>编译：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#C3E88D;"> cri-dockerd</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#C3E88D;"> bin</span></span>
<span class="line"><span style="color:#FFCB6B;">go</span><span style="color:#C3E88D;"> build -o bin/cri-dockerd</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#C3E88D;"> -p</span><span style="color:#C3E88D;"> /usr/local/bin</span></span>
<span class="line"><span style="color:#FFCB6B;">install</span><span style="color:#C3E88D;"> -o</span><span style="color:#C3E88D;"> root -g root -m </span><span style="color:#F78C6C;">0755</span><span style="color:#C3E88D;"> bin/cri-dockerd /usr/local/bin/cri-dockerd</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#C3E88D;"> -a</span><span style="color:#C3E88D;"> packaging/systemd/</span><span style="color:#BABED8;">*</span><span style="color:#C3E88D;"> /etc/systemd/system</span></span>
<span class="line"><span style="color:#FFCB6B;">sed</span><span style="color:#C3E88D;"> -i</span><span style="color:#C3E88D;"> -e</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">s,/usr/bin/cri-dockerd,/usr/local/bin/cri-dockerd,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> /etc/systemd/system/cri-docker.service</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> daemon-reload</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> enable cri-docker.service</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> enable --now cri-docker.socket</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol><p>以上安装好后需要进一步配置系统文件</p><p>创建cri-docker<a href="https://github.com/Mirantis/cri-dockerd/blob/master/packaging/systemd/cri-docker.service" target="_blank" rel="noreferrer">启动文件</a>，<code>vim /usr/lib/systemd/system/cri-docker.service</code></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">Unit</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">Description</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">CRI Interface for Docker Application Container Engine</span></span>
<span class="line"><span style="color:#BABED8;">Documentation</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">https://docs.mirantis.com</span></span>
<span class="line"><span style="color:#BABED8;">After</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">network-online.target firewalld.service docker.service</span></span>
<span class="line"><span style="color:#BABED8;">Wants</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">network-online.target</span></span>
<span class="line"><span style="color:#BABED8;">Requires</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">cri-docker.socket</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">Service</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">Type</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">notify</span></span>
<span class="line"><span style="color:#BABED8;">ExecStart</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/usr/bin/cri-dockerd --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.7</span></span>
<span class="line"><span style="color:#BABED8;">ExecReload</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/bin/kill -s HUP </span><span style="color:#BABED8;">$MAINPID</span></span>
<span class="line"><span style="color:#BABED8;">TimeoutSec</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#BABED8;">RestartSec</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">Restart</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">always</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">StartLimitBurst</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">StartLimitInterval</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">60</span><span style="color:#C3E88D;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">LimitNOFILE</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">infinity</span></span>
<span class="line"><span style="color:#BABED8;">LimitNPROC</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">infinity</span></span>
<span class="line"><span style="color:#BABED8;">LimitCORE</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">infinity</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">TasksMax</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">infinity</span></span>
<span class="line"><span style="color:#BABED8;">Delegate</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">yes</span></span>
<span class="line"><span style="color:#BABED8;">KillMode</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">process</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">Install</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">WantedBy</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">multi-user.target</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>创建启动文件，<code>vim /usr/lib/systemd/system/cri-docker.socket</code></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">Unit</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">Description</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">CRI Docker Socket for the API</span></span>
<span class="line"><span style="color:#BABED8;">PartOf</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">cri-docker.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">Socket</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">ListenStream</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">%t/cri-dockerd.sock</span></span>
<span class="line"><span style="color:#BABED8;">SocketMode</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0660</span></span>
<span class="line"><span style="color:#BABED8;">SocketUser</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">root</span></span>
<span class="line"><span style="color:#BABED8;">SocketGroup</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">Install</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">WantedBy</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">sockets.target</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>重启cri-dockerd：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> daemon-reload</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> enable cri-docker --now</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>需要以上的脚本复制到每个节点上，至此<code>cri-dockerd</code>的安装就结束了，接下来可以看看containerd的安装</p><h3 id="containerd" tabindex="-1">containerd <a class="header-anchor" href="#containerd" aria-label="Permalink to &quot;containerd&quot;">​</a></h3><p>如果你的主机上已经安装了docker，docker也会自动帮你安装上containerd，可以单独安装：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum-config-manager</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#C3E88D;">    --add-repo</span><span style="color:#C3E88D;"> https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> install containerd -y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 开机自启</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> enable containerd --now</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>备份默认旧的containerd配置并生成新的配置文件：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#C3E88D;"> /etc/containerd</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 备份</span></span>
<span class="line"><span style="color:#FFCB6B;">mv</span><span style="color:#C3E88D;"> config.toml config.toml.bak</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 初始化新的配置</span></span>
<span class="line"><span style="color:#FFCB6B;">containerd</span><span style="color:#C3E88D;"> config default</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> config.toml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>配置containerd，<code>vim /etc/containerd/config.toml</code></p><div class="language-toml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line highlighted"><span style="color:#BABED8;">disabled_plugins </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">imports </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">oom_score </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">plugin_dir </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">required_plugins </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">root </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/var/lib/containerd</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">state </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/run/containerd</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">temp </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">version </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">cgroup</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">  path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">debug</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">  address </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  format </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  gid </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">  level </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  uid </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">grpc</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">  address </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/run/containerd/containerd.sock</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  gid </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">  max_recv_message_size </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 16777216</span></span>
<span class="line"><span style="color:#BABED8;">  max_send_message_size </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 16777216</span></span>
<span class="line"><span style="color:#BABED8;">  tcp_address </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  tcp_tls_ca </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  tcp_tls_cert </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  tcp_tls_key </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  uid </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">metrics</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">  address </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  grpc_histogram </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">gc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">scheduler&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    deletion_threshold </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">    mutation_threshold </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 100</span></span>
<span class="line"><span style="color:#BABED8;">    pause_threshold </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0.02</span></span>
<span class="line"><span style="color:#BABED8;">    schedule_delay </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">0s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    startup_delay </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">100ms</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    device_ownership_from_security_context </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    disable_apparmor </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    disable_cgroup </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    disable_hugetlb_controller </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> true</span></span>
<span class="line"><span style="color:#BABED8;">    disable_proc_mount </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    disable_tcp_service </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> true</span></span>
<span class="line"><span style="color:#BABED8;">    enable_selinux </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    enable_tls_streaming </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    enable_unprivileged_icmp </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    enable_unprivileged_ports </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    ignore_image_defined_volumes </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    max_concurrent_downloads </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 3</span></span>
<span class="line"><span style="color:#BABED8;">    max_container_log_line_size </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 16384</span></span>
<span class="line"><span style="color:#BABED8;">    netns_mounts_under_state_dir </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    restrict_oom_score_adj </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    sandbox_image </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.7</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    selinux_category_range </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 1024</span></span>
<span class="line"><span style="color:#BABED8;">    stats_collect_period </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 10</span></span>
<span class="line"><span style="color:#BABED8;">    stream_idle_timeout </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">4h0m0s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    stream_server_address </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">127.0.0.1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    stream_server_port </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    systemd_cgroup </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    tolerate_missing_hugetlb_controller </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> true</span></span>
<span class="line"><span style="color:#BABED8;">    unset_seccomp_profile </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cni</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">      bin_dir </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/opt/cni/bin</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">      conf_dir </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/etc/cni/net.d</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">      conf_template </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">      ip_pref </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">      max_conf_num </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">      default_runtime_name </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">runc</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">      disable_snapshot_annotations </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> true</span></span>
<span class="line"><span style="color:#BABED8;">      discard_unpacked_layers </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">      ignore_rdt_not_enabled_errors </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">      no_pivot </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">      snapshotter </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">overlayfs</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">default_runtime</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">        base_runtime_spec </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        cni_conf_dir </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        cni_max_conf_num </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">        container_annotations </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">        pod_annotations </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">        privileged_without_host_devices </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">        runtime_engine </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        runtime_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        runtime_root </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        runtime_type </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">default_runtime</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">options</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">runtimes</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">runtimes</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">runc</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">          base_runtime_spec </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">          cni_conf_dir </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">          cni_max_conf_num </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">          container_annotations </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">          pod_annotations </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">          privileged_without_host_devices </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">          runtime_engine </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">          runtime_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">          runtime_root </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">          runtime_type </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">io.containerd.runc.v2</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">          [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">runtimes</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">runc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">options</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            BinaryName </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">            CriuImagePath </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">            CriuPath </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">            CriuWorkPath </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">            IoGid </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">            IoUid </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">            NoNewKeyring </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">            NoPivotRoot </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">            Root </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">            ShimCgroup </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">            SystemdCgroup </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">untrusted_workload_runtime</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">        base_runtime_spec </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        cni_conf_dir </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        cni_max_conf_num </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">        container_annotations </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">        pod_annotations </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> []</span></span>
<span class="line"><span style="color:#BABED8;">        privileged_without_host_devices </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">        runtime_engine </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        runtime_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        runtime_root </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">        runtime_type </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">untrusted_workload_runtime</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">options</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">image_decryption</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">      key_model </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">node</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">registry</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">      config_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">registry</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">auths</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">registry</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">configs</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">registry</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">headers</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">registry</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">mirrors</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">        # docker镜像加速</span></span>
<span class="line"><span style="color:#89DDFF;">        [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">registry</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">mirrors</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;docker</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">io&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line highlighted"><span style="color:#BABED8;">          endpoint </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://lb04zzyw.mirror.aliyuncs.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">grpc</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cri&quot;</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">x509_key_pair_streaming</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">      tls_cert_file </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">      tls_key_file </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">internal</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">opt&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/opt/containerd</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">internal</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">restart&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    interval </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">10s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">internal</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">tracing&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    sampling_ratio </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 1.0</span></span>
<span class="line"><span style="color:#BABED8;">    service_name </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">containerd</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">metadata</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">bolt&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    content_sharing_policy </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">shared</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">monitor</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">cgroups&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    no_prometheus </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">runtime</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">linux&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    no_shim </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    runtime </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">runc</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    runtime_root </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    shim </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">containerd-shim</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    shim_debug </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">runtime</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v2</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">task&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    platforms </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">linux/arm64/v8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    sched_core </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">service</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">diff-service&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    default </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">walking</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">service</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">tasks-service&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    rdt_config_file </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">snapshotter</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">aufs&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    root_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">snapshotter</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">btrfs&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    root_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">snapshotter</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">devmapper&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    async_remove </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    base_image_size </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    discard_blocks </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    fs_options </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    fs_type </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    pool_name </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    root_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">snapshotter</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">native&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    root_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">snapshotter</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">overlayfs&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    root_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    upperdir_label </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">snapshotter</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">zfs&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    root_path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">plugins</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">tracing</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">processor</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">otlp&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    endpoint </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    insecure </span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#BABED8;">    protocol </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">proxy_plugins</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">stream_processors</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">stream_processors</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">ocicrypt</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">decoder</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">tar&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    accepts </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">application/vnd.oci.image.layer.v1.tar+encrypted</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    args </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">--decryption-keys-path</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/etc/containerd/ocicrypt/keys</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    env </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">ctd-decoder</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    returns </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">application/vnd.oci.image.layer.v1.tar</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  [</span><span style="color:#FFCB6B;">stream_processors</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">&quot;io</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">containerd</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">ocicrypt</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">decoder</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">tar</span><span style="color:#BABED8;">.</span><span style="color:#FFCB6B;">gzip&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    accepts </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">application/vnd.oci.image.layer.v1.tar+gzip+encrypted</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    args </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">--decryption-keys-path</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/etc/containerd/ocicrypt/keys</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    env </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    path </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">ctd-decoder</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    returns </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">application/vnd.oci.image.layer.v1.tar+gzip</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">timeouts</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#BABED8;">io.containerd.timeout.bolt.open</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">0s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#BABED8;">io.containerd.timeout.shim.cleanup</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">5s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#BABED8;">io.containerd.timeout.shim.load</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">5s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#BABED8;">io.containerd.timeout.shim.shutdown</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">3s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#BABED8;">io.containerd.timeout.task.state</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">2s</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">ttrpc</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">  address </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  gid </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">  uid </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br></div></div><p>以上对于默认配置修改了以下部分：</p><ul><li>disabled_plugins = [&quot;cri&quot;]移除cri</li><li>SystemdCgroup：true</li><li>sandbox_image：配置aliyun镜像</li><li>Docker.io镜像加速</li></ul><p>配置完后重启containerd：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> restart containerd</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#C3E88D;"> daemon-reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="配置k8s国内源" tabindex="-1">配置k8s国内源 <a class="header-anchor" href="#配置k8s国内源" aria-label="Permalink to &quot;配置k8s国内源&quot;">​</a></h2><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> /etc/yum.repos.d/kubernetes.repo </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#89DDFF;"> EOF</span></span>
<span class="line"><span style="color:#C3E88D;">[kubernetes]</span></span>
<span class="line"><span style="color:#C3E88D;">name=Kubernetes</span></span>
<span class="line highlighted"><span style="color:#C3E88D;">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-aarch64</span></span>
<span class="line"><span style="color:#C3E88D;">enabled=1</span></span>
<span class="line"><span style="color:#C3E88D;">gpgcheck=0</span></span>
<span class="line"><span style="color:#C3E88D;">repo_gpgcheck=0</span></span>
<span class="line"><span style="color:#C3E88D;">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意以上的<code>baseurl</code>，对于非arm架构的环境请使用<code>https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch</code></p><h2 id="使用kubeadm安装" tabindex="-1">使用kubeadm安装 <a class="header-anchor" href="#使用kubeadm安装" aria-label="Permalink to &quot;使用kubeadm安装&quot;">​</a></h2><p>使用kubeadm安装k8s，这里固定版本为<code>1.26.0</code>并设置开机启动</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> install -y kubelet-1.26.0 kubeadm-1.26.0 kubectl-1.26.0 --disableexcludes=kubernetes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#C3E88D;"> systemctl enable --now kubelet</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>以上需要在所有节点执行</p></blockquote><h3 id="master生成k8s集群配置" tabindex="-1">master生成k8s集群配置 <a class="header-anchor" href="#master生成k8s集群配置" aria-label="Permalink to &quot;master生成k8s集群配置&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 生成配置文件</span></span>
<span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> config print init-defaults --component-configs KubeletConfiguration,KubeProxyConfiguration </span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> kubeadm.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>初始配置文件会生成如下配置模板：</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> kubeadm.k8s.io/v1beta3</span></span>
<span class="line"><span style="color:#F07178;">bootstrapTokens</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> groups</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">  -</span><span style="color:#C3E88D;"> system:bootstrappers:kubeadm:default-node-token</span></span>
<span class="line"><span style="color:#F07178;">  token</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> abcdef.0123456789abcdef</span></span>
<span class="line"><span style="color:#F07178;">  ttl</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 24h0m0s</span></span>
<span class="line"><span style="color:#F07178;">  usages</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">  -</span><span style="color:#C3E88D;"> signing</span></span>
<span class="line"><span style="color:#89DDFF;">  -</span><span style="color:#C3E88D;"> authentication</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> InitConfiguration</span></span>
<span class="line"><span style="color:#F07178;">localAPIEndpoint</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # 配置API服务器地址 master节点</span></span>
<span class="line highlighted"><span style="color:#F07178;">  advertiseAddress</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 192.168.10.100</span></span>
<span class="line"><span style="color:#F07178;">  bindPort</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 6443</span></span>
<span class="line"><span style="color:#F07178;">nodeRegistration</span><span style="color:#89DDFF;">:</span></span>
<span class="line highlighted"><span style="color:#F07178;">  criSocket</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> unix:///var/run/containerd/containerd.sock</span></span>
<span class="line"><span style="color:#F07178;">  imagePullPolicy</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> IfNotPresent</span></span>
<span class="line"><span style="color:#F07178;">  name</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> node</span></span>
<span class="line"><span style="color:#F07178;">  taints</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 配置面板</span></span>
<span class="line highlighted"><span style="color:#F07178;">controlPlaneEndpoint</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> cluster-endpoint</span></span>
<span class="line"><span style="color:#F07178;">apiServer</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  timeoutForControlPlane</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 4m0s</span></span>
<span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> kubeadm.k8s.io/v1beta3</span></span>
<span class="line"><span style="color:#F07178;">certificatesDir</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> /etc/kubernetes/pki</span></span>
<span class="line"><span style="color:#F07178;">clusterName</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> kubernetes</span></span>
<span class="line"><span style="color:#F07178;">controllerManager</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {}</span></span>
<span class="line"><span style="color:#F07178;">dns</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {}</span></span>
<span class="line"><span style="color:#F07178;">etcd</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  local</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    dataDir</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> /var/lib/etcd</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 配置国内镜像</span></span>
<span class="line highlighted"><span style="color:#F07178;">imageRepository</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> registry.aliyuncs.com/google_containers</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> ClusterConfiguration</span></span>
<span class="line"><span style="color:#F07178;">kubernetesVersion</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 1.26.0</span></span>
<span class="line"><span style="color:#F07178;">networking</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  dnsDomain</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> cluster.local</span></span>
<span class="line"><span style="color:#F07178;">  serviceSubnet</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 10.96.0.0/12</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # 配置pod网段</span></span>
<span class="line highlighted"><span style="color:#F07178;">  podSubnet</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 172.30.0.0/16</span></span>
<span class="line"><span style="color:#F07178;">scheduler</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {}</span></span>
<span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> kubelet.config.k8s.io/v1beta1</span></span>
<span class="line"><span style="color:#F07178;">authentication</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  anonymous</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    enabled</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#F07178;">  webhook</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    cacheTTL</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">    enabled</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> true</span></span>
<span class="line"><span style="color:#F07178;">  x509</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    clientCAFile</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> /etc/kubernetes/pki/ca.crt</span></span>
<span class="line"><span style="color:#F07178;">authorization</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  mode</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> Webhook</span></span>
<span class="line"><span style="color:#F07178;">  webhook</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    cacheAuthorizedTTL</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">    cacheUnauthorizedTTL</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">cgroupDriver</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> systemd</span></span>
<span class="line"><span style="color:#F07178;">clusterDNS</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;"> 10.96.0.10</span></span>
<span class="line"><span style="color:#F07178;">clusterDomain</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> cluster.local</span></span>
<span class="line"><span style="color:#F07178;">cpuManagerReconcilePeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">evictionPressureTransitionPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">fileCheckFrequency</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">healthzBindAddress</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 127.0.0.1</span></span>
<span class="line"><span style="color:#F07178;">healthzPort</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 10248</span></span>
<span class="line"><span style="color:#F07178;">httpCheckFrequency</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">imageMinimumGCAge</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> KubeletConfiguration</span></span>
<span class="line"><span style="color:#F07178;">logging</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  flushFrequency</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#F07178;">  options</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    json</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">      infoBufferSize</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  verbosity</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#F07178;">memorySwap</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {}</span></span>
<span class="line"><span style="color:#F07178;">nodeStatusReportFrequency</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">nodeStatusUpdateFrequency</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">rotateCertificates</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> true</span></span>
<span class="line"><span style="color:#F07178;">runtimeRequestTimeout</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">shutdownGracePeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">shutdownGracePeriodCriticalPods</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">staticPodPath</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> /etc/kubernetes/manifests</span></span>
<span class="line"><span style="color:#F07178;">streamingConnectionIdleTimeout</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">syncFrequency</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">volumeStatsAggPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> kubeproxy.config.k8s.io/v1alpha1</span></span>
<span class="line"><span style="color:#F07178;">bindAddress</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 0.0.0.0</span></span>
<span class="line"><span style="color:#F07178;">bindAddressHardFail</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#F07178;">clientConnection</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  acceptContentTypes</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">  burst</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#F07178;">  contentType</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">  kubeconfig</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> /var/lib/kube-proxy/kubeconfig.conf</span></span>
<span class="line"><span style="color:#F07178;">  qps</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 0</span></span>
<span class="line"><span style="color:#F07178;">clusterCIDR</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">configSyncPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">conntrack</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  maxPerCore</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">  min</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">  tcpCloseWaitTimeout</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">  tcpEstablishedTimeout</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">detectLocal</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  bridgeInterface</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">  interfaceNamePrefix</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">detectLocalMode</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">enableProfiling</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#F07178;">healthzBindAddress</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">hostnameOverride</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">iptables</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  localhostNodePorts</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">  masqueradeAll</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#F07178;">  masqueradeBit</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">  minSyncPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">  syncPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">ipvs</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  excludeCIDRs</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">  minSyncPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">  scheduler</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">  strictARP</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#F07178;">  syncPeriod</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">  tcpFinTimeout</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">  tcpTimeout</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">  udpTimeout</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 0s</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> KubeProxyConfiguration</span></span>
<span class="line"><span style="color:#F07178;">metricsBindAddress</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 配置ip转发模式</span></span>
<span class="line highlighted"><span style="color:#F07178;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">ipvs</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">nodePortAddresses</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">oomScoreAdj</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> null</span></span>
<span class="line"><span style="color:#F07178;">portRange</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">showHiddenMetricsForVersion</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">winkernel</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  enableDSR</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#F07178;">  forwardHealthCheckVip</span><span style="color:#89DDFF;">:</span><span style="color:#FF9CAC;"> false</span></span>
<span class="line"><span style="color:#F07178;">  networkName</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">  rootHnsEndpointName</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#F07178;">  sourceVip</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br></div></div><p>以上配置文件注意事项如下：</p><ul><li>配置API服务器地址 master节点，根据自己的情况修改(第13行)</li><li>k8s默认使用containerd，如果你使用的是docker，请替换成<code>/var/run/cri-dockerd.sock</code>(第16行)</li><li>配置面板<code>controlPlaneEndpoint</code>对应的master的地址，方便以后扩展为多master节点集群，需要注意的是自行配置dns(第22行)</li><li>配置镜像加速地址(第34行)</li><li>配置pod网段，不要和service、docker以及任何其他的网段重复(第41行)</li><li>配置kube proxy使用<code>ipvs</code>作为路由转发(第129行)</li></ul><h3 id="拉取镜像" tabindex="-1">拉取镜像 <a class="header-anchor" href="#拉取镜像" aria-label="Permalink to &quot;拉取镜像&quot;">​</a></h3><p>提前拉取安装k8s时所需要的组件</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> config images list</span></span>
<span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> config images pull --config kubeadm.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="初始化k8s集群" tabindex="-1">初始化k8s集群 <a class="header-anchor" href="#初始化k8s集群" aria-label="Permalink to &quot;初始化k8s集群&quot;">​</a></h3><p>此命令会正式在master节点上初始化k8s集群：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> init --config kubeadm.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>以上是通过<u>配置文件</u>的形式进行初始化k8s集群的，你也可以直接通过命令行的方式进行初始化：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> init </span><span style="color:#BABED8;">\</span></span>
<span class="line"><span style="color:#C3E88D;">   --apiserver-advertise-address=192.168.10.100</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#C3E88D;">   --image-repository</span><span style="color:#C3E88D;"> registry.aliyuncs.com/google_containers </span><span style="color:#BABED8;">\</span></span>
<span class="line"><span style="color:#C3E88D;">   --kubernetes-version</span><span style="color:#C3E88D;"> v1.26.0 </span><span style="color:#BABED8;">\</span></span>
<span class="line"><span style="color:#C3E88D;">   --service-cidr=10.96.0.0/12</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#C3E88D;">   --pod-network-cidr=172.30.0.0/16</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#C3E88D;">   --cri-socket</span><span style="color:#C3E88D;"> unix:///var/run/cri-dockerd.sock </span><span style="color:#BABED8;">\</span></span>
<span class="line"><span style="color:#C3E88D;">   --control-plane-endpoint=cluster-endpoint</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>以上初始化成功后会显示如下结果：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">Your</span><span style="color:#C3E88D;"> Kubernetes control-plane has initialized successfully!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">To</span><span style="color:#C3E88D;"> start using your cluster, you need to run the following as a regular user:</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#FFCB6B;">  mkdir</span><span style="color:#C3E88D;"> -p</span><span style="color:#BABED8;"> $HOME</span><span style="color:#C3E88D;">/.kube</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">  sudo</span><span style="color:#C3E88D;"> cp -i /etc/kubernetes/admin.conf </span><span style="color:#BABED8;">$HOME</span><span style="color:#C3E88D;">/.kube/config</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">  sudo</span><span style="color:#C3E88D;"> chown </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">id</span><span style="color:#C3E88D;"> -u</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">id</span><span style="color:#C3E88D;"> -g</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> $HOME</span><span style="color:#C3E88D;">/.kube/config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Alternatively,</span><span style="color:#C3E88D;"> if you are the root user, you can run:</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">  export</span><span style="color:#BABED8;"> KUBECONFIG</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/etc/kubernetes/admin.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">You</span><span style="color:#C3E88D;"> should now deploy a pod network to the cluster.</span></span>
<span class="line"><span style="color:#FFCB6B;">Run</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">kubectl apply -f [podnetwork].yaml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> with one of the options listed at:</span></span>
<span class="line"><span style="color:#FFCB6B;">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">You</span><span style="color:#C3E88D;"> can now join any number of control-plane nodes by copying certificate authorities</span></span>
<span class="line"><span style="color:#FFCB6B;">and</span><span style="color:#C3E88D;"> service account keys on each node and then running the following as root:</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#FFCB6B;">  kubeadm</span><span style="color:#C3E88D;"> join cluster-endpoint:6443 --token rvnvf2.hxsd36svcudrfrsi </span><span style="color:#BABED8;">\</span></span>
<span class="line highlighted"><span style="color:#C3E88D;">	--discovery-token-ca-cert-hash</span><span style="color:#C3E88D;"> sha256:7b2f630ecb3fac019db7f487525aaf34f609a0690808dcd873c542984be875c5 </span><span style="color:#BABED8;">\</span></span>
<span class="line highlighted"><span style="color:#C3E88D;">	--control-plane</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Then</span><span style="color:#C3E88D;"> you can join any number of worker nodes by running the following on each as root:</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> join cluster-endpoint:6443 --token rvnvf2.hxsd36svcudrfrsi </span><span style="color:#BABED8;">\</span></span>
<span class="line highlighted"><span style="color:#C3E88D;">	--discovery-token-ca-cert-hash</span><span style="color:#C3E88D;"> sha256:7b2f630ecb3fac019db7f487525aaf34f609a0690808dcd873c542984be875c5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>初始化完成后还需要根据以上步骤，在master节点上执行：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#C3E88D;"> -p</span><span style="color:#BABED8;"> $HOME</span><span style="color:#C3E88D;">/.kube</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#C3E88D;"> cp -i /etc/kubernetes/admin.conf </span><span style="color:#BABED8;">$HOME</span><span style="color:#C3E88D;">/.kube/config</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#C3E88D;"> chown </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">id</span><span style="color:#C3E88D;"> -u</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">id</span><span style="color:#C3E88D;"> -g</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> $HOME</span><span style="color:#C3E88D;">/.kube/config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#BABED8;"> KUBECONFIG</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/etc/kubernetes/admin.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>You can now join any number of control-plane nodes by copying certificate authorities and service account keys on each node and then running the following as root:</p><p>上面还提示如果再加入其他master节点可以执行</p></blockquote><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> join cluster-endpoint:6443 --token rvnvf2.hxsd36svcudrfrsi </span><span style="color:#BABED8;">\</span></span>
<span class="line"><span style="color:#C3E88D;">	--discovery-token-ca-cert-hash</span><span style="color:#C3E88D;"> sha256:7b2f630ecb3fac019db7f487525aaf34f609a0690808dcd873c542984be875c5 </span><span style="color:#BABED8;">\</span></span>
<span class="line"><span style="color:#C3E88D;">	--control-plane</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="work节点加入集群" tabindex="-1">work节点加入集群 <a class="header-anchor" href="#work节点加入集群" aria-label="Permalink to &quot;work节点加入集群&quot;">​</a></h3><p>根据上面提示执行相关命令：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> join cluster-endpoint:6443 --token rvnvf2.hxsd36svcudrfrsi </span><span style="color:#BABED8;">\</span></span>
<span class="line"><span style="color:#C3E88D;">	--discovery-token-ca-cert-hash</span><span style="color:#C3E88D;"> sha256:7b2f630ecb3fac019db7f487525aaf34f609a0690808dcd873c542984be875c5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="token过期处理" tabindex="-1">token过期处理 <a class="header-anchor" href="#token过期处理" aria-label="Permalink to &quot;token过期处理&quot;">​</a></h3><p>加入集群的token有效期为1天，当过期后可以采用以下方式重新生成token：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubeadm</span><span style="color:#C3E88D;"> token create --print-join-command</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="网络组件" tabindex="-1">网络组件 <a class="header-anchor" href="#网络组件" aria-label="Permalink to &quot;网络组件&quot;">​</a></h2><p>以上初始化好后还需要安装网络组件，以便 Pod 可以相互通信。 在安装网络之前，集群 DNS (CoreDNS) 将不会启动，这里将使用<a href="https://docs.tigera.io/calico/latest/getting-started/kubernetes/self-managed-onprem/onpremises" target="_blank" rel="noreferrer">calico</a>作为网络组件。</p><p>没安装网络组件时查看当前k8s集群状态：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> kubectl get node</span></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#C3E88D;">        STATUS     ROLES           AGE   VERSION</span></span>
<span class="line"><span style="color:#FFCB6B;">k8s-master</span><span style="color:#C3E88D;">  NotReady   control-plane   </span><span style="color:#F78C6C;">27</span><span style="color:#C3E88D;">d   v1.26.0</span></span>
<span class="line"><span style="color:#FFCB6B;">k8s-node1</span><span style="color:#C3E88D;">   NotReady   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">          27</span><span style="color:#C3E88D;">d   v1.26.0</span></span>
<span class="line"><span style="color:#FFCB6B;">k8s-node2</span><span style="color:#C3E88D;">   NotReady   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">          27</span><span style="color:#C3E88D;">d   v1.26.0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>安装calico，下载配置文件</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#C3E88D;"> create -f https://raw.githubusercontent.com/projectcalico/calico/v3.25.1/manifests/tigera-operator.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> https://raw.githubusercontent.com/projectcalico/calico/v3.25.0/manifests/custom-resources.yaml </span><span style="color:#BABED8;">\</span></span>
<span class="line"><span style="color:#C3E88D;">	-O</span><span style="color:#C3E88D;"> calico-custom.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>自定义配置文件，<code>vim calico-custom.yaml</code></p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># This section includes base Calico installation configuration.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># For more information, see: https://projectcalico.docs.tigera.io/master/reference/installation/api#operator.tigera.io/v1.Installation</span></span>
<span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> operator.tigera.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> Installation</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  name</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> default</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  # Configures Calico networking.</span></span>
<span class="line"><span style="color:#F07178;">  calicoNetwork</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # Note: The ipPools section cannot be modified post-install.</span></span>
<span class="line"><span style="color:#F07178;">    ipPools</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">    -</span><span style="color:#F07178;"> blockSize</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 26</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">      # pod网段</span></span>
<span class="line highlighted"><span style="color:#F07178;">      cidr</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> 172.30.0.0/16</span></span>
<span class="line"><span style="color:#F07178;">      encapsulation</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> VXLANCrossSubnet</span></span>
<span class="line"><span style="color:#F07178;">      natOutgoing</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> Enabled</span></span>
<span class="line"><span style="color:#F07178;">      nodeSelector</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> all()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # 网络接口</span></span>
<span class="line"><span style="color:#F07178;">    nodeAddressAutodetectionV4</span><span style="color:#89DDFF;">:</span></span>
<span class="line highlighted"><span style="color:#F07178;">      interface</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> ens*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">---</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># This section configures the Calico API server.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># For more information, see: https://projectcalico.docs.tigera.io/master/reference/installation/api#operator.tigera.io/v1.APIServer</span></span>
<span class="line"><span style="color:#F07178;">apiVersion</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> operator.tigera.io/v1</span></span>
<span class="line"><span style="color:#F07178;">kind</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> APIServer</span></span>
<span class="line"><span style="color:#F07178;">metadata</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">  name</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> default</span></span>
<span class="line"><span style="color:#F07178;">spec</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>自定配置需要修改的有：</p><ul><li>修改<code>cidr</code>值保持和k8s设置的pod网段一致(第14行)</li><li>由于机器上可能有多个网卡，修改<code>interface: ens*</code>，保证可以抓取虚拟机的所有网卡接口(第20行)</li></ul><p>以上配置好以后运行此配置文件：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">kubectl</span><span style="color:#C3E88D;"> create -f calico-custom.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>接下来k8s会创建calico的相关组件，根据自己机器的配置高低等待一段时间，再次查看集群信息：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看节点信息</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> kubectl get node -owide</span></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#C3E88D;">         STATUS   ROLES           AGE   VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE                   KERNEL-VERSION            CONTAINER-RUNTIME</span></span>
<span class="line"><span style="color:#FFCB6B;">k8s-master</span><span style="color:#C3E88D;">   Ready    control-plane   </span><span style="color:#F78C6C;">42</span><span style="color:#C3E88D;">h   v1.26.0   </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.100   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">        CentOS Linux </span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">AltArch</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">   5.11</span><span style="color:#C3E88D;">.12-300.el7.aarch64   containerd://1.6.18</span></span>
<span class="line"><span style="color:#FFCB6B;">k8s-node1</span><span style="color:#C3E88D;">    Ready    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">          42</span><span style="color:#C3E88D;">h   v1.26.0   </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">        CentOS Linux </span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">AltArch</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">   5.11</span><span style="color:#C3E88D;">.12-300.el7.aarch64   containerd://1.6.18</span></span>
<span class="line"><span style="color:#FFCB6B;">k8s-node2</span><span style="color:#C3E88D;">    Ready    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">          42</span><span style="color:#C3E88D;">h   v1.26.0   </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.102   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">        CentOS Linux </span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">AltArch</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">   5.11</span><span style="color:#C3E88D;">.12-300.el7.aarch64   containerd://1.6.18</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看pod信息</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> k8s-master ~ kubectl get pod -A</span></span>
<span class="line"><span style="color:#FFCB6B;">NAMESPACE</span><span style="color:#C3E88D;">          NAME                                       READY   STATUS    RESTARTS        AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-apiserver</span><span style="color:#C3E88D;">   calico-apiserver-9cd64756d-xkkkt           </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">24</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">119s</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">   41</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-apiserver</span><span style="color:#C3E88D;">   calico-apiserver-9cd64756d-xpdhn           </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">      41</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      calico-kube-controllers-6b7b9c649d-fk5fs   </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">17h</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">    42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      calico-node-65gtc                          </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">0</span><span style="color:#F78C6C;">               70</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      calico-node-8rbd8                          </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">0</span><span style="color:#F78C6C;">               70</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      calico-node-pckn6                          </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">0</span><span style="color:#F78C6C;">               70</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      calico-typha-57bb7ddcf8-gmsxc              </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">      42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      calico-typha-57bb7ddcf8-rjsbb              </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">18h</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">     41</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      csi-node-driver-g9xt7                      </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">/2     Running   </span><span style="color:#F78C6C;">12</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">     41</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      csi-node-driver-lgzmt                      </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">/2     Running   </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">110s</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">   41</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      csi-node-driver-wmwd8                      </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">/2     Running   </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">119s</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">   41</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        coredns-5bbd96d687-q9lpt                   </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">119s</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">    42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        coredns-5bbd96d687-tw7nx                   </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">6</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">      42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        etcd-k8s-master                            </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">     42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        kube-apiserver-k8s-master                  </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">22</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">     42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        kube-controller-manager-k8s-master         </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">17</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">10h</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">    17</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        kube-proxy-jbz8f                           </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">18h</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">     41</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        kube-proxy-kcn6c                           </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">      42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        kube-proxy-ksfqx                           </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">7</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">18h</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">     42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-system</span><span style="color:#C3E88D;">        kube-scheduler-k8s-master                  </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">     42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"><span style="color:#FFCB6B;">tigera-operator</span><span style="color:#C3E88D;">    tigera-operator-54b47459dd-vjkb7           </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">9</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">2m</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">      42</span><span style="color:#C3E88D;">h</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="集群验证" tabindex="-1">集群验证 <a class="header-anchor" href="#集群验证" aria-label="Permalink to &quot;集群验证&quot;">​</a></h2><ol><li>验证节点与K8s核心service互通</li></ol><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看k8s service</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> kubectl get svc</span></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#C3E88D;">         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">S</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">   AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">kubernetes</span><span style="color:#C3E88D;">   ClusterIP   </span><span style="color:#F78C6C;">10.96</span><span style="color:#C3E88D;">.0.1    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">        443</span><span style="color:#C3E88D;">/TCP   </span><span style="color:#F78C6C;">42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 在每台机器 ping 10.96.0.1 是否能ping通</span></span>
<span class="line"><span style="color:#FFCB6B;">PING</span><span style="color:#F78C6C;"> 10.96</span><span style="color:#C3E88D;">.0.1 </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">10.96.0.1</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;"> 56</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">84</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;"> bytes of data.</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">10.96</span><span style="color:#C3E88D;">.0.1: icmp_seq=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">128</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">3.55</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">10.96</span><span style="color:#C3E88D;">.0.1: icmp_seq=</span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">128</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">1.96</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">10.96</span><span style="color:#C3E88D;">.0.1: icmp_seq=</span><span style="color:#F78C6C;">3</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">128</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">1.83</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># coredns</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> kubectl get svc -n kube-system</span></span>
<span class="line"><span style="color:#FFCB6B;">NAME</span><span style="color:#C3E88D;">       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">S</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">                  AGE</span></span>
<span class="line"><span style="color:#FFCB6B;">kube-dns</span><span style="color:#C3E88D;">   ClusterIP   </span><span style="color:#F78C6C;">10.96</span><span style="color:#C3E88D;">.0.10   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">        53</span><span style="color:#C3E88D;">/UDP,53/TCP,9153/TCP   </span><span style="color:#F78C6C;">42</span><span style="color:#C3E88D;">h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 在每台机器 ping 10.96.0.10 是否能ping通</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> ping </span><span style="color:#F78C6C;">10.96</span><span style="color:#C3E88D;">.0.10</span></span>
<span class="line"><span style="color:#FFCB6B;">PING</span><span style="color:#F78C6C;"> 10.96</span><span style="color:#C3E88D;">.0.10 </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">10.96.0.10</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;"> 56</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">84</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;"> bytes of data.</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">10.96</span><span style="color:#C3E88D;">.0.10: icmp_seq=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">128</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">0.761</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">10.96</span><span style="color:#C3E88D;">.0.10: icmp_seq=</span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">128</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">0.612</span><span style="color:#C3E88D;"> ms</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ol start="2"><li>查看节点到容器之间能否互通</li></ol><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> kubectl get pod -A -owide</span></span>
<span class="line"><span style="color:#FFCB6B;">NAMESPACE</span><span style="color:#C3E88D;">          NAME                                       READY   STATUS    RESTARTS       AGE     IP               NODE         NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      calico-kube-controllers-6b7b9c649d-fk5fs   </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">18h</span><span style="color:#C3E88D;"> ago</span><span style="color:#89DDFF;">)</span><span style="color:#F78C6C;">   42</span><span style="color:#C3E88D;">h     </span><span style="color:#F78C6C;">172.20</span><span style="color:#C3E88D;">.36.73     k8s-node1    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#89DDFF;">           &lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">calico-system</span><span style="color:#C3E88D;">      calico-node-65gtc                          </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/1     Running   </span><span style="color:#F78C6C;">0</span><span style="color:#F78C6C;">              9</span><span style="color:#C3E88D;">m57s   </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.102   k8s-node2    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#89DDFF;">           &lt;</span><span style="color:#C3E88D;">non</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#... 省略其他pod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 进入calico-system下的calico-node-65gtc容器（node2节点），ping calico-system下的calico-kube-controllers-6b7b9c649d-fk5fs容器 （node1节点） IP：172.20.36.73</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> kubectl exec -it -n calico-system calico-node-65gtc -- sh</span></span>
<span class="line"><span style="color:#FFCB6B;">Defaulted</span><span style="color:#C3E88D;"> container </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">calico-node</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> out of: calico-node, flexvol-driver </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">init</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">, install-cni </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">init</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">sh-4.4#</span><span style="color:#C3E88D;"> ping </span><span style="color:#F78C6C;">172.20</span><span style="color:#C3E88D;">.36.73</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="dashboard" tabindex="-1">Dashboard <a class="header-anchor" href="#dashboard" aria-label="Permalink to &quot;Dashboard&quot;">​</a></h2><h3 id="安装metrics" tabindex="-1">安装Metrics <a class="header-anchor" href="#安装metrics" aria-label="Permalink to &quot;安装Metrics&quot;">​</a></h3><h3 id="安装dashborad" tabindex="-1">安装Dashborad <a class="header-anchor" href="#安装dashborad" aria-label="Permalink to &quot;安装Dashborad&quot;">​</a></h3><h2 id="参考文档" tabindex="-1">参考文档 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档&quot;">​</a></h2><ul><li><a href="https://kubernetes.io/docs/home/" target="_blank" rel="noreferrer">Kubernetes官方文档</a></li><li><a href="https://docs.tigera.io/calico/latest/about/" target="_blank" rel="noreferrer">Calico网络组件</a></li><li><a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noreferrer">Docker官方文档</a></li><li><a href="https://github.com/Mirantis/cri-dockerd" target="_blank" rel="noreferrer">cri-dockerd使用</a></li></ul><!--[--><div class="reward-divider"></div><figure><figcaption> 若您在阅读过程中发现一些错误：如语句不通、文字、逻辑等错误，可以在评论区指出，我会及时调整修改，感谢您的阅读。同时您觉得这篇文章对您有帮助的话，可以打赏作者一笔作为鼓励，金额不限，感谢支持🤝。 </figcaption><div style="text-align:center;margin-top:2em;"><img style="display:inline;" src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/005HV6Avgy1h72anu40usj30dw0dw40j.jpg" width="200" alt="支付宝捐赠"><img style="display:inline;" src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/005HV6Avgy1h72ap99ym1j30b40b4abq.jpg" width="200" alt="微信支付捐赠"></div></figure><div class="reward-divider"></div><div class="share_wrap"><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-weibo.png" alt="share to weibo" title="分享到微博"></a><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-twitter.png" alt="share to twitter" title="分享到twitter"></a><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-facebook.png" alt="share to facebook" title="分享到facebook"></a></div><!--]--><!----></div></div></main><footer class="VPDocFooter" data-v-fb80de84 data-v-a4d10c8e><!--[--><!--]--><div class="edit-info" data-v-a4d10c8e><!----><div class="last-updated" data-v-a4d10c8e><p class="VPLastUpdated" data-v-a4d10c8e data-v-86563300>最近更新: <time datetime="2024-03-03T04:31:19.000Z" data-v-86563300></time></p></div></div><nav class="prev-next" data-v-a4d10c8e><div class="pager" data-v-a4d10c8e><a class="VPLink link pager-link prev" href="/fullstack/k8s/base.html" data-v-a4d10c8e><!--[--><span class="desc" data-v-a4d10c8e>Previous page</span><span class="title" data-v-a4d10c8e>初识kubernetes</span><!--]--></a></div><div class="pager" data-v-a4d10c8e><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-e69ff593 data-v-e09097b5><div class="container" data-v-e09097b5><p class="message" data-v-e09097b5>Released under the MIT License.</p><p class="copyright" data-v-e09097b5>Copyright © 2018-2024 HengShuai</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"frontend_babel_babel-analysis.md\":\"wGpC9j4r\",\"frontend_babel_babel-plugin-guide.md\":\"ppFJFpUc\",\"frontend_babel_base.md\":\"vrUaWuJ_\",\"frontend_base.md\":\"dwQglb_Z\",\"frontend_browser_base.md\":\"8v9kmWYQ\",\"frontend_building-tool_base.md\":\"IZjj-1k_\",\"frontend_canvas_base.md\":\"4FFeOXMN\",\"frontend_canvas_magic-effects.md\":\"d72-kJZY\",\"frontend_cli_index.md\":\"LW95mYz4\",\"frontend_compiler_index.md\":\"kb3LvP4F\",\"article_2021_vue-img-lazyload.md\":\"nS2xctKa\",\"frontend_computer-network_arp-protocol.md\":\"Kq6yx99o\",\"article_2020_vscode-shortcut.md\":\"9YPtkAQd\",\"article_2020_web-cache.md\":\"tgnHisxs\",\"article_2019_mysql-guide.md\":\"sVywMOTl\",\"article_2021_pwa-app.md\":\"OleMbyZc\",\"article_2021_vue-core-process.md\":\"lvBKNU2P\",\"article_2019_js-type-transfer.md\":\"6bgN44L7\",\"frontend_computer-network_base.md\":\"rscsR2cq\",\"article_base.md\":\"MRVl6scQ\",\"article_2022_emoji-markup.md\":\"OhV-I-1u\",\"article_2019_what-bfc.md\":\"3X8ih4fR\",\"article_2021_ts-decorator.md\":\"t9oGw5oN\",\"article_2020_webpack-guide.md\":\"4hgG0rTv\",\"article_2021_js-pattern.md\":\"s7bHowR9\",\"article_2021_flex-layout.md\":\"Svx6-bGi\",\"article_2019_nvm-guide.md\":\"DOn-ZyKp\",\"article_2019_ktv-system.md\":\"8zwU_3Hs\",\"article_2020_optimize-web-server.md\":\"zI4x4pon\",\"article_2019_css-center.md\":\"39T7ILEY\",\"article_2020_domparser-xml.md\":\"14rZ0LzC\",\"frontend_nginx_base.md\":\"zoU8TEMt\",\"article_2019_promise.md\":\"PPpH3Goo\",\"article_2019_bind-call-apply.md\":\"sKjhWUC_\",\"article_2019_js-copy.md\":\"aASz1f6e\",\"article_2020_regexp-guide.md\":\"Hz2CcED7\",\"article_2021_performance-tools.md\":\"f1ArMVK_\",\"frontend_performance_chunk-upload.md\":\"_H6a4GPM\",\"frontend_performance_load-perf.md\":\"GBvTUzYN\",\"frontend_performance_network-perf.md\":\"5sGmco83\",\"frontend_performance_cache.md\":\"GADg4UGM\",\"frontend_performance_performance.md\":\"eTHaQNUO\",\"frontend_performance_range-download.md\":\"hDSmWOR2\",\"frontend_performance_secure-perf.md\":\"1SJRKrnr\",\"frontend_performance_seo.md\":\"nVWyT-cr\",\"frontend_performance_virtual-scroll-1.md\":\"GMhzOTOC\",\"frontend_performance_virtual-scroll-2.md\":\"Tf9Xw2tC\",\"frontend_performance_web-score.md\":\"t6trh2aX\",\"frontend_project-integration_base.md\":\"H9p7xZIC\",\"frontend_project-integration_build-tool.md\":\"YEHYzLz2\",\"frontend_debug-skill_base.md\":\"ardgOXee\",\"frontend_debug-skill_charles.md\":\"c860e4Ce\",\"frontend_debug-skill_chrome.md\":\"VolKnY9H\",\"frontend_computer-network_ip-protocol.md\":\"cYsrbBjs\",\"frontend_project-integration_debugger-skill.md\":\"gdFZBkWV\",\"frontend_project-integration_deploy-specification.md\":\"TAZbHJxr\",\"frontend_project-integration_framework.md\":\"5X0ugAP5\",\"frontend_project-integration_git-commit.md\":\"hau9b8OP\",\"frontend_project-integration_monorepo.md\":\"vk1tlUoK\",\"frontend_project-integration_specification.md\":\"FUpSWKJb\",\"frontend_project-integration_style.md\":\"6YvYxYxO\",\"frontend_react_index.md\":\"WCWdbrtn\",\"frontend_regexp_base.md\":\"bxZXRG-x\",\"frontend_render-mode_base.md\":\"awKqNZtj\",\"frontend_sandbox_index.md\":\"gXXOpt2O\",\"frontend_ts_base.md\":\"EsuvODQ8\",\"frontend_vue_computed-watch.md\":\"ViMqGS60\",\"frontend_vue_pinia.md\":\"sFmcIG8v\",\"frontend_vue_router.md\":\"oywyEaoK\",\"frontend_vue_slot.md\":\"-cpDvOd1\",\"frontend_vue_template-compiler.md\":\"BoDuPu-F\",\"frontend_vue_transition.md\":\"oLOqknqJ\",\"frontend_debug-skill_h5.md\":\"JqHXkiol\",\"frontend_vue_update-process.md\":\"k6l2RNx4\",\"frontend_debug-skill_vscode.md\":\"bJXMRiLv\",\"frontend_vue_vuex.md\":\"mDVwtyM1\",\"frontend_wasm_base.md\":\"wKzjPpun\",\"frontend_debug-skill_wireshark.md\":\"h-Af8Z2N\",\"frontend_desktop-app_index.md\":\"CwmxVITt\",\"frontend_webpack_webpack-analysis.md\":\"B7vs5RGV\",\"frontend_editor_index.md\":\"Z3QRmU7I\",\"frontend_webpack_webpack-loader.md\":\"H5WVjPyO\",\"frontend_js_async.md\":\"xM2atz8E\",\"frontend_node-bff_index.md\":\"uvIlJlnt\",\"frontend_js_audio.md\":\"SxVGBXDx\",\"frontend_webpack_webpack-node.md\":\"wv3teGYs\",\"frontend_js_base.md\":\"xDEIN0Le\",\"frontend_webpack_webpack-plugin.md\":\"9tSSq7pn\",\"fullstack_base.md\":\"I4wE93qI\",\"fullstack_docker_base-tutorial.md\":\"9ZJDDyO1\",\"fullstack_docker_docker-compose.md\":\"zjlwGtUy\",\"frontend_js_binary.md\":\"APMVe8ro\",\"fullstack_docker_docker-repository.md\":\"wBmXzDQl\",\"frontend_js_eventloop.md\":\"F1aGIeQj\",\"frontend_js_implicit-conversion.md\":\"z9evaHOi\",\"fullstack_docker_dockerfile.md\":\"3YPLdvgt\",\"frontend_js_js-gc.md\":\"zQJ4SnO7\",\"frontend_js_meta-coding.md\":\"doArwweu\",\"fullstack_docker_install-configure.md\":\"ycQmqQb6\",\"frontend_lowcoding_base.md\":\"1AMtoVOM\",\"frontend_micro-frontend_base.md\":\"VCogbXGF\",\"frontend_monitor_base.md\":\"1PrBd---\",\"fullstack_docker_network.md\":\"sG-Vuzgw\",\"fullstack_docker_npm-repository.md\":\"xNRdDnzE\",\"fullstack_docker_volume-store.md\":\"AmWixEc_\",\"frontend_nestjs_swagger.md\":\"Miz3IuZP\",\"fullstack_gitlab_gitlab-pipeline.md\":\"2PnzZMhY\",\"fullstack_gitlab_gitlab-runner-install-configure.md\":\"AcLdY8_f\",\"fullstack_gitlab_install-configure.md\":\"hsqEggJv\",\"frontend_nestjs_base.md\":\"GEmB31Yt\",\"frontend_nestjs_mvc.md\":\"G7xy_a_Y\",\"frontend_nestjs_useful.md\":\"5BxCDwjN\",\"frontend_node-optimize_index.md\":\"9iTkxv8U\",\"frontend_node_base.md\":\"f045EATv\",\"frontend_node_node-debug.md\":\"VzMrpiGN\",\"fullstack_k8s_install.md\":\"shPzlnU9\",\"frontend_node_node-web.md\":\"BA0Qp_xe\",\"frontend_performance_node-score.md\":\"GHFkv_LH\",\"frontend_npm_index.md\":\"cPGRzDNd\",\"frontend_performance_base.md\":\"boqnWWao\",\"frontend_performance_cache-perf.md\":\"c67R59ai\",\"index.md\":\"DNChHY-j\",\"me.md\":\"9KzOPl0U\",\"super-nav_index.md\":\"sa1sp0Lq\",\"talk_2023_dad-foot-injured.md\":\"e316_81h\",\"talk_2023_lose-qoo-job.md\":\"wc9xrS2F\",\"talk_2023_love-4th-anniversary.md\":\"EL8i9jjc\",\"talk_2023_second-covid.md\":\"DQ3RHk2a\",\"talk_base.md\":\"bc9zk1r_\",\"frontend_computer-network_http-protocol.md\":\"bfrkeSkr\",\"frontend_project-integration_choose-editor.md\":\"0gNbjQse\",\"frontend_project-integration_ci-pipeline.md\":\"qrLOyYjp\",\"frontend_flutter_base.md\":\"yyvMr_gq\",\"frontend_node_node-framework.md\":\"G8o8zeYS\",\"frontend_debug-skill_fiddler.md\":\"NqneAeW9\",\"frontend_js_proto-inherit.md\":\"E5dVTnVb\",\"frontend_micro-program_index.md\":\"yyQYNhB6\",\"frontend_vue_reactivity.md\":\"9xkgqhJY\",\"frontend_webpack_base.md\":\"C2knYA00\",\"frontend_hybrid-app_base.md\":\"-Vm4xYDr\",\"frontend_node_node-measure.md\":\"4GqjVgP8\",\"frontend_node_node-process.md\":\"Ps4VtoHq\",\"frontend_project-integration_test-framework.md\":\"zZle5pVy\",\"frontend_computer-network_tcp-protocol.md\":\"fep1PHVR\",\"frontend_ts_ts-configure.md\":\"rAao85Hb\",\"frontend_visual_index.md\":\"qSiOl_Sl\",\"frontend_vue_component-render.md\":\"ZCTZuvWu\",\"frontend_js_scope-closure.md\":\"5EWzSuzB\",\"fullstack_k8s_base.md\":\"3Tzy-t_S\",\"fullstack_gitlab_npm-repository.md\":\"vjG8GM3X\",\"frontend_pattern_base.md\":\"GAbsFqbU\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"hengshuai's blog\",\"description\":\"大家好我是卫恒帅，这是我的个人博客，在这里我会分享web开发相关技能经验，也有自己的一些生活所思所悟，希望对你有所帮助，如你感觉不错可以将本站收藏！\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"dark\",\"themeConfig\":{\"externalLinkIcon\":true,\"logoLink\":\"/\",\"siteTitle\":\"Hengshuai's blog\",\"outline\":[2,3],\"outlineTitle\":\"目录\",\"nav\":[{\"text\":\"Frontend\",\"link\":\"/frontend/base.html\",\"activeMatch\":\"/frontend/base\"},{\"text\":\"Fullstack\",\"link\":\"/fullstack/base.html\",\"activeMatch\":\"/fullstack/base\"},{\"text\":\"Article\",\"link\":\"/article/base.html\",\"activeMatch\":\"/article/base\"},{\"text\":\"Case\",\"link\":\"https://case.usword.cn\"},{\"text\":\"Me\",\"link\":\"/me.html\",\"activeMatch\":\"/me\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/ihengshuai\"}],\"sidebar\":{\"/frontend/\":[{\"collapsible\":true,\"items\":[{\"text\":\"Javascript\",\"collapsed\":false,\"link\":\"/frontend/js/base.html\",\"items\":[{\"text\":\"原型、原型链与继承\",\"link\":\"/frontend/js/proto-inherit.html\"},{\"text\":\"作用域(链)、执行上下文及闭包\",\"link\":\"/frontend/js/scope-closure.html\"},{\"text\":\"类型隐式转换\",\"link\":\"/frontend/js/implicit-conversion.html\"},{\"text\":\"事件循环(EventLoop)\",\"link\":\"/frontend/js/eventloop.html\"},{\"text\":\"异步编程\",\"link\":\"/frontend/js/async.html\"},{\"text\":\"元编程\",\"link\":\"/frontend/js/meta-coding.html\"},{\"text\":\"二进制\",\"link\":\"/frontend/js/binary.html\"},{\"text\":\"音视频\",\"link\":\"/frontend/js/audio.html\"},{\"text\":\"垃圾回收\",\"link\":\"/frontend/js/js-gc.html\"}]},{\"text\":\"Browser\",\"link\":\"/frontend/browser/base.html\"},{\"text\":\"Vue\",\"collapsed\":true,\"items\":[{\"text\":\"响应式原理\",\"link\":\"/frontend/vue/reactivity.html\"},{\"text\":\"计算属性与侦听函数\",\"link\":\"/frontend/vue/computed-watch.html\"},{\"text\":\"模板编译\",\"link\":\"/frontend/vue/template-compiler.html\"},{\"text\":\"组件创建与渲染\",\"link\":\"/frontend/vue/component-render.html\"},{\"text\":\"视图更新流程\",\"link\":\"/frontend/vue/update-process.html\"},{\"text\":\"插槽原理\",\"link\":\"/frontend/vue/slot.html\"},{\"text\":\"实现过渡\",\"link\":\"/frontend/vue/transition.html\"},{\"text\":\"vuex内幕\",\"link\":\"/frontend/vue/vuex.html\"},{\"text\":\"pinia原理\",\"link\":\"/frontend/vue/pinia.html\"},{\"text\":\"路由实现\",\"link\":\"/frontend/vue/router.html\"}]},{\"text\":\"Regexp\",\"link\":\"/frontend/regexp/base.html\"},{\"text\":\"Babel\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/babel/base.html\"},{\"text\":\"原理分析\",\"link\":\"/frontend/babel/babel-analysis.html\"},{\"text\":\"自定义插件\",\"link\":\"/frontend/babel/babel-plugin-guide.html\"}]},{\"text\":\"Webpack\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/webpack/base.html\"},{\"text\":\"自定义loader\",\"link\":\"/frontend/webpack/webpack-loader.html\"},{\"text\":\"自定义插件\",\"link\":\"/frontend/webpack/webpack-plugin.html\"},{\"text\":\"结合node使用\",\"link\":\"/frontend/webpack/webpack-node.html\"},{\"text\":\"原理分析\",\"link\":\"/frontend/webpack/webpack-analysis.html\"}]},{\"text\":\"Building Tool\",\"link\":\"/frontend/building-tool/base.html\"},{\"text\":\"Debug Skill\",\"collapsed\":true,\"link\":\"/frontend/debug-skill/base.html\",\"items\":[{\"text\":\"Chrome\",\"link\":\"/frontend/debug-skill/chrome.html\"},{\"text\":\"Vscode\",\"link\":\"/frontend/debug-skill/vscode.html\"},{\"text\":\"Fiddler\",\"link\":\"/frontend/debug-skill/fiddler.html\"},{\"text\":\"Charles\",\"link\":\"/frontend/debug-skill/charles.html\"},{\"text\":\"Wireshark\",\"link\":\"/frontend/debug-skill/wireshark.html\"},{\"text\":\"H5\",\"link\":\"/frontend/debug-skill/h5.html\"}]},{\"text\":\"NodeJS\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/node/base.html\"},{\"text\":\"web服务\",\"link\":\"/frontend/node/node-web.html\"},{\"text\":\"多进程与多线程\",\"link\":\"/frontend/node/node-process.html\"},{\"text\":\"常见框架\",\"link\":\"/frontend/node/node-framework.html\"},{\"text\":\"调试技巧\",\"link\":\"/frontend/node/node-debug.html\"},{\"text\":\"性能优化\",\"link\":\"/frontend/node/node-measure.html\"}]},{\"text\":\"Typescript\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/ts/base.html\"},{\"text\":\"2.配置文件\",\"link\":\"/frontend/ts/ts-configure.html\"}]},{\"text\":\"NestJS\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/nestjs/base.html\"},{\"text\":\"2.搭建web服务\",\"link\":\"/frontend/nestjs/mvc.html\"},{\"text\":\"3.swagger文档\",\"link\":\"/frontend/nestjs/swagger.html\"},{\"text\":\"4.实用手册\",\"link\":\"/frontend/nestjs/useful.html\"}]},{\"text\":\"Render Mode\",\"link\":\"/frontend/render-mode/base.html\"},{\"text\":\"Canvas\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/canvas/base.html\"},{\"text\":\"2.炫酷特效\",\"link\":\"/frontend/canvas/magic-effects.html\"}]},{\"text\":\"Project Integration\",\"collapsed\":true,\"items\":[{\"text\":\"1.项目集成\",\"link\":\"/frontend/project-integration/base.html\"},{\"text\":\"2.编辑器之争\",\"link\":\"/frontend/project-integration/choose-editor.html\"},{\"text\":\"3.框架选型\",\"link\":\"/frontend/project-integration/framework.html\"},{\"text\":\"4.打包工具\",\"link\":\"/frontend/project-integration/build-tool.html\"},{\"text\":\"5.语法规范\",\"link\":\"/frontend/project-integration/specification.html\"},{\"text\":\"6.风格指南\",\"link\":\"/frontend/project-integration/style.html\"},{\"text\":\"7.提交规范\",\"link\":\"/frontend/project-integration/git-commit.html\"},{\"text\":\"8.monorepo\",\"link\":\"/frontend/project-integration/monorepo.html\"},{\"text\":\"9.自动化测试\",\"link\":\"/frontend/project-integration/test-framework.html\"},{\"text\":\"10.发布规范\",\"link\":\"/frontend/project-integration/deploy-specification.html\"},{\"text\":\"11.调试技巧\",\"link\":\"/frontend/project-integration/debugger-skill.html\"},{\"text\":\"12.自动化\",\"link\":\"/frontend/project-integration/ci-pipeline.html\"}]},{\"text\":\"Computer Network\",\"collapsed\":true,\"link\":\"/frontend/computer-network/base.html\",\"items\":[{\"text\":\"TCP协议\",\"link\":\"/frontend/computer-network/tcp-protocol.html\"},{\"text\":\"HTTP协议\",\"link\":\"/frontend/computer-network/http-protocol.html\"},{\"text\":\"IP协议\",\"link\":\"/frontend/computer-network/ip-protocol.html\"},{\"text\":\"ARP协议\",\"link\":\"/frontend/computer-network/arp-protocol.html\"}]},{\"text\":\"Performance\",\"collapsed\":true,\"items\":[{\"text\":\"前言\",\"link\":\"/frontend/performance/base.html\"},{\"text\":\"大文件上传\",\"link\":\"/frontend/performance/chunk-upload.html\"},{\"text\":\"大文件下载\",\"link\":\"/frontend/performance/range-download.html\"},{\"text\":\"虚拟滚动一\",\"link\":\"/frontend/performance/virtual-scroll-1.html\"},{\"text\":\"虚拟滚动二\",\"link\":\"/frontend/performance/virtual-scroll-2.html\"},{\"text\":\"网络优化\",\"link\":\"/frontend/performance/network-perf.html\"},{\"text\":\"加载优化\",\"link\":\"/frontend/performance/load-perf.html\"},{\"text\":\"缓存优化\",\"link\":\"/frontend/performance/cache-perf.html\"},{\"text\":\"安全优化\",\"link\":\"/frontend/performance/secure-perf.html\"},{\"text\":\"SEO优化\",\"link\":\"/frontend/performance/seo.html\"},{\"text\":\"Performance工具\",\"link\":\"/frontend/performance/performance.html\"},{\"text\":\"web评分指标\",\"link\":\"/frontend/performance/web-score.html\"},{\"text\":\"node评分指标\",\"link\":\"/frontend/performance/node-score.html\"}]},{\"text\":\"Nginx\",\"link\":\"/frontend/nginx/base.html\"},{\"text\":\"Design Pattern\",\"link\":\"/frontend/pattern/base.html\"},{\"text\":\"Monitor\",\"link\":\"/frontend/monitor/base.html\"},{\"text\":\"Micro Frontend\",\"link\":\"/frontend/micro-frontend/base.html\"},{\"text\":\"Webassembly\",\"link\":\"/frontend/wasm/base.html\"},{\"text\":\"Hybrid App\",\"link\":\"/frontend/hybrid-app/base.html\"},{\"text\":\"Flutter\",\"link\":\"/frontend/flutter/base.html\"}]}],\"/fullstack/\":[{\"text\":\"Docker\",\"items\":[{\"items\":[{\"text\":\"Docker安装与配置\",\"link\":\"/fullstack/docker/install-configure.html\"},{\"text\":\"Docker基础教程\",\"link\":\"/fullstack/docker/base-tutorial.html\"},{\"text\":\"Docker数据卷与持久化\",\"link\":\"/fullstack/docker/volume-store.html\"},{\"text\":\"Docker网络原理\",\"link\":\"/fullstack/docker/network.html\"},{\"text\":\"使用Dockerfile构建镜像\",\"link\":\"/fullstack/docker/dockerfile.html\"},{\"text\":\"使用DockerCompose部署服务\",\"link\":\"/fullstack/docker/docker-compose.html\"},{\"text\":\"使用Docker搭建npm仓库\",\"link\":\"/fullstack/docker/npm-repository.html\"},{\"text\":\"搭建docker私有仓库\",\"link\":\"/fullstack/docker/docker-repository.html\"}]}]},{\"text\":\"Gitlab\",\"items\":[{\"items\":[{\"text\":\"安装与配置\",\"link\":\"/fullstack/gitlab/install-configure.html\"},{\"text\":\"Gitlab Runner安装与配置\",\"link\":\"/fullstack/gitlab/gitlab-runner-install-configure.html\"},{\"text\":\"Gitlab流水线配置\",\"link\":\"/fullstack/gitlab/gitlab-pipeline.html\"},{\"text\":\"Gitlab搭建npm仓库\",\"link\":\"/fullstack/gitlab/npm-repository.html\"}]}]},{\"text\":\"Kubernetes\",\"items\":[{\"items\":[{\"text\":\"初识kubernetes\",\"link\":\"/fullstack/k8s/base.html\"},{\"text\":\"搭建k8s集群\",\"link\":\"/fullstack/k8s/install.html\"}]}]}],\"/article/\":[{\"text\":\"2022\",\"items\":[{\"items\":[{\"text\":\"emoji markup\",\"link\":\"/article/2022/emoji-markup.html\"}]}]},{\"text\":\"2021\",\"items\":[{\"items\":[{\"text\":\"PWA渐进式应用\",\"link\":\"/article/2021/pwa-app.html\"},{\"text\":\"前端性能测试工具\",\"link\":\"/article/2021/performance-tools.html\"},{\"text\":\"Typescript装饰器指南\",\"link\":\"/article/2021/ts-decorator.html\"},{\"text\":\"手写vue图片懒加载插件\",\"link\":\"/article/2021/vue-img-lazyload.html\"},{\"text\":\"谈谈vue内部运行机制\",\"link\":\"/article/2021/vue-core-process.html\"},{\"text\":\"JS中的设计模式\",\"link\":\"/article/2021/js-pattern.html\"},{\"text\":\"flex布局\",\"link\":\"/article/2021/flex-layout.html\"}]}]},{\"text\":\"2020\",\"items\":[{\"items\":[{\"text\":\"关于DOMParser、XMLSerializer、createTreeWalker使用\",\"link\":\"/article/2020/domparser-xml.html\"},{\"text\":\"vscode快捷键\",\"link\":\"/article/2020/vscode-shortcut.html\"},{\"text\":\"优化改善网页的加载及性能\",\"link\":\"/article/2020/optimize-web-server.html\"},{\"text\":\"深入浅出RegExp\",\"link\":\"/article/2020/regexp-guide.html\"},{\"text\":\"从零配置webpack工程\",\"link\":\"/article/2020/webpack-guide.html\"},{\"text\":\"web缓存策略\",\"link\":\"/article/2020/web-cache.html\"}]}]},{\"text\":\"2019\",\"items\":[{\"items\":[{\"text\":\"nvm使用技巧\",\"link\":\"/article/2019/nvm-guide.html\"},{\"text\":\"MySQL从入门到放弃\",\"link\":\"/article/2019/mysql-guide.html\"},{\"text\":\"7天撸完ktv点歌系统\",\"link\":\"/article/2019/ktv-system.html\"},{\"text\":\"css的10中居中方式\",\"link\":\"/article/2019/css-center.html\"},{\"text\":\"Promise使用与原理\",\"link\":\"/article/2019/promise.html\"},{\"text\":\"JS隐式转换\",\"link\":\"/article/2019/js-type-transfer.html\"},{\"text\":\"什么是BFC\",\"link\":\"/article/2019/what-bfc.html\"},{\"text\":\"JS深浅拷贝\",\"link\":\"/article/2019/js-copy.html\"},{\"text\":\"bind、call、apply使用技巧\",\"link\":\"/article/2019/bind-call-apply.html\"}]}]}],\"/talk/\":[{\"items\":[{\"items\":[{\"text\":\"我也赶上了裁员\",\"link\":\"/talk/2023/lose-qoo-job.html\"},{\"text\":\"我爸脚受伤了\",\"link\":\"/talk/2023/dad-foot-injured.html\"},{\"text\":\"二🐑了\",\"link\":\"/talk/2023/second-covid.html\"}]}]}]},\"lastUpdated\":{\"text\":\"最近更新\",\"formatOptions\":{\"dateStyle\":\"medium\"}},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2018-2024 HengShuai\"},\"search\":{\"options\":{\"detailedView\":true,\"miniSearch\":{\"searchOptions\":{\"fields\":[\"title\",\"text\"]}}},\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>