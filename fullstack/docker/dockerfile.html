<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用Dockerfile构建镜像 | hengshuai's blog</title>
    <meta name="description" content="Dockerfile是一个文本文件里面包含了一条条构建镜像的指令，使用Dockerfile构建镜像更加方便、间接、透明">
    <meta name="generator" content="VitePress v1.0.0-rc.40">
    <link rel="preload stylesheet" href="/assets/style.NwX665RZ.css" as="style">
    
    <script type="module" src="/assets/app.0fd12bH9.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.SV1ROkXV.js">
    <link rel="modulepreload" href="/assets/chunks/theme.l3RjJB8k.js">
    <link rel="modulepreload" href="/assets/fullstack_docker_dockerfile.md.3YPLdvgt.lean.js">
    <meta name="renderer" content="webkit">
    <meta name="author" content="ihengshuai@foxmail.com">
    <meta rel="profile" href="http://gmpg.org/xfn/11">
    <meta name="referrer" content="same-origin">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="theme-color" content="#646cff">
    <meta name="google-site-verification" content="T4xYOJVbUxeU5aZRUROdmEf_NWCjnRDwfXnzKYUVcFM">
    <meta name="baidu-site-verification" content="code-IpD4H7zKv4">
    <link rel="apple-touch-icon" href="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/192.png">
    <meta name="apple-mobile-web-app-title" content="hengshuai&#39;s blog">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#747bff">
    <meta rel="apple-touch-startup-image" href="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/192.png">
    <link rel="manifest" href="/manifest.json">
    <script id="ENV_VARIABLES">window.__ENV_VARIABLES__={ENV_PROD:!0};</script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V5736Z4DWT"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-V5736Z4DWT");</script>
    <script>var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6eda4089bba0c6f46ad6e00658a80f3";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta name="keywords" content="Dockerfile构建镜像,Dockerfile构建优化,Dockerfile多阶段构建,Dockerfile如何运行,docker镜像构建,定制docker镜像">
    <meta property="og:type" content="website">
    <meta property="og:title" content="使用Dockerfile构建镜像 | hengshuai&#39;s blog">
    <meta property="og:url" content="https://blog.usword.cn/fullstack/docker/dockerfile.html">
    <meta property="og:site_name" content="hengshuai&#39;s blog">
    <meta property="og:description" content="Dockerfile是一个文本文件里面包含了一条条构建镜像的指令，使用Dockerfile构建镜像更加方便、间接、透明">
    <meta property="og:image" content="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-docker.png">
    <meta name="twitter:url" value="https://blog.usword.cn/fullstack/docker/dockerfile.html">
    <meta name="twitter:title" value="使用Dockerfile构建镜像 | hengshuai&#39;s blog">
    <meta name="twitter:domain" value="https://blog.usword.cn">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" value="Dockerfile是一个文本文件里面包含了一条条构建镜像的指令，使用Dockerfile构建镜像更加方便、间接、透明">
    <meta name="twitter:image" content="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-docker.png">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-e69ff593><!--[--><!--]--><!--[--><span tabindex="-1" data-v-056fc64b></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-056fc64b> Skip to content </a><!--]--><!----><header class="VPNav" data-v-e69ff593 data-v-50ee880a><div class="VPNavBar has-sidebar" data-v-50ee880a data-v-575c0058><div class="wrapper" data-v-575c0058><div class="container" data-v-575c0058><div class="title" data-v-575c0058><div class="VPNavBarTitle has-sidebar" data-v-575c0058 data-v-5a8562d3><a class="title" href="/" data-v-5a8562d3><!--[--><!--]--><!----><!--[-->Hengshuai&#39;s blog<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-575c0058><div class="content-body" data-v-575c0058><!--[--><!--]--><div class="VPNavBarSearch search" data-v-575c0058><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-575c0058 data-v-3e017cdf><span id="main-nav-aria-label" class="visually-hidden" data-v-3e017cdf>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/frontend/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Frontend</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fullstack/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Fullstack</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/article/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Article</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://case.usword.cn" target="_blank" rel="noreferrer" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Case</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/me.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Me</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-575c0058 data-v-3bd0ddce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-3bd0ddce data-v-62e667eb data-v-0438efbe><span class="check" data-v-0438efbe><span class="icon" data-v-0438efbe><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-62e667eb><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-62e667eb><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-575c0058 data-v-47b9b291 data-v-f534a663><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ihengshuai" aria-label="github" target="_blank" rel="noopener" data-v-f534a663 data-v-70b9b240><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-575c0058 data-v-edb1db61 data-v-41b0fac7><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-41b0fac7><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-41b0fac7><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-41b0fac7><div class="VPMenu" data-v-41b0fac7 data-v-32c6b1d0><!----><!--[--><!--[--><!----><div class="group" data-v-edb1db61><div class="item appearance" data-v-edb1db61><p class="label" data-v-edb1db61>Appearance</p><div class="appearance-action" data-v-edb1db61><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-edb1db61 data-v-62e667eb data-v-0438efbe><span class="check" data-v-0438efbe><span class="icon" data-v-0438efbe><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-62e667eb><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-62e667eb><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-edb1db61><div class="item social-links" data-v-edb1db61><div class="VPSocialLinks social-links-list" data-v-edb1db61 data-v-f534a663><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ihengshuai" aria-label="github" target="_blank" rel="noopener" data-v-f534a663 data-v-70b9b240><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-575c0058 data-v-279e6295><span class="container" data-v-279e6295><span class="top" data-v-279e6295></span><span class="middle" data-v-279e6295></span><span class="bottom" data-v-279e6295></span></span></button></div></div></div></div><div class="divider" data-v-575c0058><div class="divider-line" data-v-575c0058></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-e69ff593 data-v-2ebb1e0d><div class="container" data-v-2ebb1e0d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2ebb1e0d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2ebb1e0d><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2ebb1e0d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2ebb1e0d data-v-ba90ba94><button data-v-ba90ba94>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-e69ff593 data-v-983e8791><div class="curtain" data-v-983e8791></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-983e8791><span class="visually-hidden" id="sidebar-aria-label" data-v-983e8791> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-983e8791><section class="VPSidebarItem level-0 has-active" data-v-983e8791 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h2 class="text" data-v-3445ab86>Docker</h2><!----></div><div class="items" data-v-3445ab86><!--[--><section class="VPSidebarItem level-1 has-active" data-v-3445ab86 data-v-3445ab86><!----><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/install-configure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Docker安装与配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/base-tutorial.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Docker基础教程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/volume-store.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Docker数据卷与持久化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/network.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Docker网络原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/dockerfile.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>使用Dockerfile构建镜像</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/docker-compose.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>使用DockerCompose部署服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/npm-repository.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>使用Docker搭建npm仓库</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/docker/docker-repository.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>搭建docker私有仓库</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-983e8791><section class="VPSidebarItem level-0" data-v-983e8791 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h2 class="text" data-v-3445ab86>Gitlab</h2><!----></div><div class="items" data-v-3445ab86><!--[--><section class="VPSidebarItem level-1" data-v-3445ab86 data-v-3445ab86><!----><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/gitlab/install-configure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>安装与配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/gitlab/gitlab-runner-install-configure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Gitlab Runner安装与配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/gitlab/gitlab-pipeline.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Gitlab流水线配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/gitlab/npm-repository.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Gitlab搭建npm仓库</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-983e8791><section class="VPSidebarItem level-0" data-v-983e8791 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h2 class="text" data-v-3445ab86>Kubernetes</h2><!----></div><div class="items" data-v-3445ab86><!--[--><section class="VPSidebarItem level-1" data-v-3445ab86 data-v-3445ab86><!----><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/k8s/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>初识kubernetes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/fullstack/k8s/install.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>搭建k8s集群</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-e69ff593 data-v-5a285343><div class="VPDoc has-sidebar has-aside" data-v-5a285343 data-v-fb80de84><!--[--><!--]--><div class="container" data-v-fb80de84><div class="aside" data-v-fb80de84><div class="aside-curtain" data-v-fb80de84></div><div class="aside-container" data-v-fb80de84><div class="aside-content" data-v-fb80de84><div class="VPDocAside" data-v-fb80de84 data-v-bb0b59e9><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-bb0b59e9 data-v-ea307b6d><div class="content" data-v-ea307b6d><div class="outline-marker" data-v-ea307b6d></div><div class="outline-title" role="heading" aria-level="2" data-v-ea307b6d>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-ea307b6d><span class="visually-hidden" id="doc-outline-aria-label" data-v-ea307b6d> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-ea307b6d data-v-20500810><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-bb0b59e9></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-fb80de84><div class="content-container" data-v-fb80de84><!--[--><!--]--><main class="main" data-v-fb80de84><div style="position:relative;" class="vp-doc _fullstack_docker_dockerfile external-link-icon-enabled" data-v-fb80de84><div><h1 id="使用dockerfile构建镜像" tabindex="-1">使用Dockerfile构建镜像 <a class="header-anchor" href="#使用dockerfile构建镜像" aria-label="Permalink to &quot;使用Dockerfile构建镜像&quot;">​</a></h1><p>前面我们学习了可以使用<code>docker commit</code>命令式构建新的镜像，而此方式相对来说比较繁琐且对于旁人来说内部都是黑箱操作，无法了解制作的具体细节。很有可能很长时间后制作者也会对其忘却，且制作多镜像时相同阶段也无法共用已构建的产物，Dockerfile便可以完美解决这些问题。</p><h2 id="概念" tabindex="-1">概念 <a class="header-anchor" href="#概念" aria-label="Permalink to &quot;概念&quot;">​</a></h2><p>Dockerfile是用于定义Docker镜像的文件，是一种纯文本文件，其中包含了一系列的指令和配置信息，以描述如何构建和运行一个Docker容器。Dockerfile的内容可以基于现有的镜像进行扩展和定制化，也可以自己编写底层的操作系统配置和应用程序安装脚本。</p><p>镜像是分层构建的，每一层都对应了具体的构建指令，而Dockerfile中每一条指令也代表着每层的构建过程</p><h2 id="作用" tabindex="-1">作用 <a class="header-anchor" href="#作用" aria-label="Permalink to &quot;作用&quot;">​</a></h2><p>使用Dockerfile为镜像的构建使得更加便利，其优势大致如下：</p><ul><li>自动化构建：使用Dockerfile可以自动构建Docker镜像，避免了手动操作的繁琐和错误</li><li>可重复性：通过Dockerfile可以确保每次构建出的镜像都是相同的，避免了因为不同的环境或依赖出现的差异</li><li>可维护性：使用Dockerfile可以清晰地描述容器的配置和依赖，方便维护和升级</li><li>灵活性：Dockerfile提供了灵活的自定义选项，可以根据需要对容器进行个性化配置</li><li>可分享性：Dockerfile可以作为代码一样进行版本控制和分享，方便团队协作和共享</li></ul><h2 id="初识dockerfile" tabindex="-1">初识Dockerfile <a class="header-anchor" href="#初识dockerfile" aria-label="Permalink to &quot;初识Dockerfile&quot;">​</a></h2><p>和大部分配置文件不同，Dockerfile其实就是个普通的文本文件，内部由一条条具体的构建指令组合而成，可以说Dockerfile是加强版的命令构建版本。以下是一个简单的Dockerfile：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> nginx:alpine</span></span>
<span class="line"><span style="color:#F78C6C;">ENV</span><span style="color:#BABED8;"> DESC=</span><span style="color:#C3E88D;">&quot;DOCKERFILE_DEMO&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">WORKDIR</span><span style="color:#BABED8;"> /var/nginx/html</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> echo $DESC</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> . .</span></span>
<span class="line"><span style="color:#F78C6C;">EXPOSE</span><span style="color:#BABED8;"> 80</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;nginx&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;-g&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;daemon off;&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>以上配置指定了构建以<code>nginx:alpine</code>镜像为基础，定义容器的工作目录为<code>/var/nginx/html</code>，并将宿主机当前目录下的文件复制到容器的工作目录下，暴露端口80，并规定容器启动后让nginx以<u>前台</u>的形式运行。除此之外还定义了环境变量<code>DESC</code>的值为<code>DOCKERFILE_DEMO</code>，并打印其结果</p><p>接下来构建生成目标镜像：<code>nginx:dockerfile</code></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker build -t nginx:dockerfile .</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">+</span><span style="color:#89DDFF;">]</span><span style="color:#BABED8;"> Building 15.3s </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">9/9</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> FINISHED</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load build definition from Dockerfile                                                                      0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> transferring dockerfile: </span><span style="color:#F78C6C;">182</span><span style="color:#C3E88D;">B                                                                                      </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load .dockerignore                                                                                         0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> transferring context: </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">B                                                                                           </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line highlighted"><span style="color:#BABED8;"> =&gt; [internal] load metadata </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> docker.io/library/nginx:alpine                                                          15.3s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [1/4] FROM docker.io/library/nginx:alpine@sha256:eb05700fe7baa6890b74278e39b66b2ed1326831f9ec3ed4bdc6361a4ac2f333     0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load build context                                                                                         0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> transferring context: </span><span style="color:#F78C6C;">182</span><span style="color:#C3E88D;">B                                                                                         </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; </span><span style="color:#C3E88D;">CACHED [</span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">/4] WORKDIR /var/nginx/html                                                                                  </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line highlighted"><span style="color:#BABED8;"> =&gt; </span><span style="color:#C3E88D;">CACHED [</span><span style="color:#F78C6C;">3</span><span style="color:#C3E88D;">/4] RUN echo DOCKERFILE_DEMO                                                                                 </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [4/4] COPY </span><span style="color:#82AAFF;">.</span><span style="color:#82AAFF;"> .</span><span style="color:#BABED8;">                                                                                                        0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; </span><span style="color:#C3E88D;">exporting to image                                                                                                    </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> exporting layers                                                                                                   </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> writing image sha256:bcd9c0828a32f7f2816cc128ac1f1f7368066caf401c93057825d0f3b5df4864                              </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> naming to docker.io/library/nginx:dockerfile</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>查看并运行：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看镜像已经存在</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker images </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> dockerfile</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#C3E88D;">    dockerfile     bcd9c0828a32   </span><span style="color:#F78C6C;">56</span><span style="color:#C3E88D;"> seconds ago   </span><span style="color:#F78C6C;">22.1</span><span style="color:#C3E88D;">MB</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 运行容器</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker run --rm -p </span><span style="color:#F78C6C;">8088</span><span style="color:#C3E88D;">:80 nginx:dockerfile</span></span>
<span class="line"><span style="color:#FFCB6B;">/docker-entrypoint.sh:</span><span style="color:#C3E88D;"> /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span></span>
<span class="line"><span style="color:#FFCB6B;">/docker-entrypoint.sh:</span><span style="color:#C3E88D;"> Looking for shell scripts in /docker-entrypoint.d/</span></span>
<span class="line"><span style="color:#FFCB6B;">/docker-entrypoint.sh:</span><span style="color:#C3E88D;"> Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span></span>
<span class="line"><span style="color:#FFCB6B;">10-listen-on-ipv6-by-default.sh:</span><span style="color:#C3E88D;"> info: Getting the checksum of /etc/nginx/conf.d/default.conf</span></span>
<span class="line"><span style="color:#FFCB6B;">10-listen-on-ipv6-by-default.sh:</span><span style="color:#C3E88D;"> info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>以上我们便使用Dockerfile配置文件定制nginx镜像的完整流程，可以体验出它相比命令式更加便捷，操作简单透明，并且同阶段的构建会被缓存起来复用，可以很好的提高构建效率，对于相同镜像的共享也只需拿到配置文件即可制作完全一样的镜像。</p><p>相反不使用Dockerfile，需要我们一步一步使用命令进行构建，那样会相对繁琐，整体构建的操作也会是黑箱操作，无法满足简单、易维护、高效的特性。</p><p>了解了Dockerfile的便捷之处后，接下来学习详细语法。</p><h2 id="语法" tabindex="-1">语法 <a class="header-anchor" href="#语法" aria-label="Permalink to &quot;语法&quot;">​</a></h2><h3 id="from" tabindex="-1">FROM <a class="header-anchor" href="#from" aria-label="Permalink to &quot;FROM&quot;">​</a></h3><p>初始化基础的镜像，在Dockerfile中必须的也是最开始就需要的，后面的命令需要基于最初的镜像进行操作。<code>FROM</code>一般是最开始执行的，<code>ARG</code>命令是唯一可以在<code>FROM</code>前执行的命令。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#BABED8;"> [--platform=&lt;platform&gt;] </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">image</span><span style="color:#89DDFF;">&gt;[</span><span style="color:#BABED8;">:tag</span><span style="color:#89DDFF;">]</span><span style="color:#89DDFF;"> [</span><span style="color:#BABED8;">AS </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">&gt;]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>AS name</code>：可选，指定构建阶段的名称，适用于多阶段构建</li><li><code>--platform</code>：指定平台，如arm，amd等等</li><li><code>tag</code>：可选，不指定镜像tag默认为latest</li></ul><h3 id="arg" tabindex="-1">ARG <a class="header-anchor" href="#arg" aria-label="Permalink to &quot;ARG&quot;">​</a></h3><p>ARG 指令用于设置构建时的参数，这些参数可以在构建时传递给 Docker 以影响镜像的构建，使用ARG可以简化镜像的构建过程、将容器的配置信息与容器的代码分离，提高容器的可维护性</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ARG</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">nam</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">[=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">default valu</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>可以在构建时使用 <code>--build-arg &lt;key&gt;=&lt;value&gt;</code> 参数来传递一个新的值给指定的参数</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Dockerfile-ARG</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> nginx:alpine</span></span>
<span class="line"><span style="color:#F78C6C;">ARG</span><span style="color:#BABED8;"> VERSION=0.0.1</span></span>
<span class="line"><span style="color:#F78C6C;">ENV</span><span style="color:#BABED8;"> VERSION=$VERSION</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> echo $VERSION</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>构建镜像重新赋值：从第9行看到已经被赋新值<code>0.1.0</code></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker build --build-arg VERSION=</span><span style="color:#F78C6C;">0.1</span><span style="color:#C3E88D;">.0 -t nginx:ARG --file Dockerfile-ARG .</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">+</span><span style="color:#89DDFF;">]</span><span style="color:#BABED8;"> Building 15.9s </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">6/6</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> FINISHED</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load .dockerignore                                                                                         0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> transferring context: </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">B                                                                                           </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load build definition from Dockerfile-ARG                                                                  0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> transferring dockerfile: </span><span style="color:#F78C6C;">119</span><span style="color:#C3E88D;">B                                                                                      </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load metadata </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> docker.io/library/nginx:alpine                                                          15.6s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; </span><span style="color:#C3E88D;">CACHED [</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/2] FROM docker.io/library/nginx:alpine@sha256:eb05700fe7baa6890b74278e39b66b2ed1326831f9ec3ed4bdc6361a4ac2  </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line highlighted"><span style="color:#BABED8;"> =&gt; [2/2] RUN echo 0.1.0                                                                                                  0.3s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; </span><span style="color:#C3E88D;">exporting to image                                                                                                    </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> exporting layers                                                                                                   </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> writing image sha256:c073ffd0029a4a3e64b68f2a9e450a4389d0b81fc7221bfcd727448be48bea36                              </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> naming to docker.io/library/nginx:ARG</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>然后可以通过<code>docker inspect</code>查看镜像的变量：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker inspect nginx:ARG </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> -A</span><span style="color:#F78C6C;"> 6</span><span style="color:#C3E88D;"> Env</span></span>
<span class="line"><span style="color:#FFCB6B;">  &quot;Env&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#FFCB6B;">      &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">      &quot;NGINX_VERSION=1.21.5&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">      &quot;NJS_VERSION=0.7.1&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">      &quot;PKG_RELEASE=1&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">      &quot;VERSION=0.1.0&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  ],</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="env" tabindex="-1">ENV <a class="header-anchor" href="#env" aria-label="Permalink to &quot;ENV&quot;">​</a></h3><p>该指令用于设置环境变量，可以在容器运行时使用这些环境变量</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ENV</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">ke</span><span style="color:#BABED8;">y</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">valu</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>其中，<code>&lt;key&gt;</code> 表示要设置的环境变量的名称，<code>&lt;value&gt;</code>表示要设置的环境变量的值。如果要设置多个环境变量，可以在<u>ENV指令中指定多个键值对，每个键值对用空格分隔，双引号将会被移除如果没有使用转义</u>。Dockerfile中ENV定义的变量会持久保存在镜像中，可以使用<code>docker inspect image</code>查看内部的环境变量，可以在<u>运行容器时</u>使用<code>-e &lt;key&gt;=&lt;value&gt;</code>来覆盖原来的值，或设置新的环境变量</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Dockerfile</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> nginx:alpine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 设置时区</span></span>
<span class="line"><span style="color:#F78C6C;">ENV</span><span style="color:#BABED8;"> TZ=Asia/Shanghai</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">ENV</span><span style="color:#BABED8;"> k1=v1</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> echo $k1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>构建镜像：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> build --file Dockerfile -t nginx:ENV .</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">+</span><span style="color:#89DDFF;">]</span><span style="color:#BABED8;"> Building 15.7s </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">6/6</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> FINISHED</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load build definition from Dockerfile-ENV                                                                  0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> transferring dockerfile: </span><span style="color:#F78C6C;">86</span><span style="color:#C3E88D;">B                                                                                       </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load .dockerignore                                                                                         0.0s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> transferring context: </span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;">B                                                                                           </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; [internal] load metadata </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> docker.io/library/nginx:alpine                                                          15.5s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; </span><span style="color:#C3E88D;">CACHED [</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">/2] FROM docker.io/library/nginx:alpine@sha256:eb05700fe7baa6890b74278e39b66b2ed1326831f9ec3ed4bdc6361a4ac2  </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line highlighted"><span style="color:#BABED8;"> =&gt; [2/2] RUN echo v1                                                                                                     0.2s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; </span><span style="color:#C3E88D;">exporting to image                                                                                                    </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> exporting layers                                                                                                   </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> writing image sha256:c6e1d107c5aa56a9c70fcd377c539e6ae28267e4f1660d9dd8ee5d7a40ac79e6                              </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">s</span></span>
<span class="line"><span style="color:#BABED8;"> =&gt; =</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> naming to docker.io/library/nginx:ENV</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>查看镜像内部持久化的变量：第8行看到镜像内部设置的<code>k1</code>变量</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> inspect nginx:ENV </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> -A</span><span style="color:#F78C6C;"> 5</span><span style="color:#C3E88D;"> ENV</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ...</span></span>
<span class="line"><span style="color:#FFCB6B;">&quot;Env&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;NGINX_VERSION=1.21.5&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;NJS_VERSION=0.7.1&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;PKG_RELEASE=1&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">    &quot;k1=v1&quot;</span></span>
<span class="line"><span style="color:#BABED8;">],</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>运行容器并覆盖镜像中默认的<code>k1</code>变量值：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> run -d -p </span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">:80 -e k1=v2 --name nginx-env nginx:ENV</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看容器 nginx-env 内部配置</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> inspect nginx-env </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;"> grep</span><span style="color:#C3E88D;"> -A</span><span style="color:#F78C6C;"> 6</span><span style="color:#C3E88D;"> Env</span></span>
<span class="line"><span style="color:#FFCB6B;">  &quot;Env&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">      &quot;k1=v2&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">      &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">      &quot;NGINX_VERSION=1.21.5&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">      &quot;NJS_VERSION=0.7.1&quot;</span><span style="color:#FFCB6B;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">      &quot;PKG_RELEASE=1&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  ],</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="workdir" tabindex="-1">WORKDIR <a class="header-anchor" href="#workdir" aria-label="Permalink to &quot;WORKDIR&quot;">​</a></h3><p>WORKDIR 指令用于设置容器中的工作目录。当我们在容器中运行命令时，它们将在 WORKDIR 指定的目录中运行。如果在 Dockerfile 中没有使用 WORKDIR 指令，则默认的工作目录是根目录（/）。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">WORKDIR</span><span style="color:#C3E88D;"> /path/to/workdir</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> ubuntu:latest</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 指定容器工作目录为/app</span></span>
<span class="line"><span style="color:#F78C6C;">WORKDIR</span><span style="color:#BABED8;"> /app</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 将当前目录下的内容复制到容器中的 /app 目录中</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> . .</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> apt-get update &amp;&amp; apt-get install -y python3</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;python3&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;app.py&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="label" tabindex="-1">LABEL <a class="header-anchor" href="#label" aria-label="Permalink to &quot;LABEL&quot;">​</a></h3><p>给镜像添加标签，label使用键值对的方式定义，有空格的值要用双引号包括，尽量在一行中定义完所有的label，自己使用意义不大了解下即可</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">LABEL</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">ke</span><span style="color:#BABED8;">y</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">valu</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">ke</span><span style="color:#BABED8;">y</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">valu</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">ke</span><span style="color:#BABED8;">y</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">=</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">valu</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">LABEL</span><span style="color:#BABED8;"> label1=xxxxx \</span></span>
<span class="line"><span style="color:#BABED8;">      label2=123143 \</span></span>
<span class="line"><span style="color:#BABED8;">      label3=</span><span style="color:#C3E88D;">&quot;sdfsdfs&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 使用 arm架构的 nginx:1.15.3 的镜像作为 build 阶段的基础镜像</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> --platform=arm nginx:1.15.3 </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> build</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="run" tabindex="-1">RUN <a class="header-anchor" href="#run" aria-label="Permalink to &quot;RUN&quot;">​</a></h3><p>在当前镜像上层执行相关命令，并commited一个新的镜像层提供给下一层阶段使用。由于一条RUN指令便会产生新的镜像层，使得构建体积变大，在生产构建时尽量采用 <code>&amp;&amp;</code> 把RUN合并成一条指令执行，当然在测试构建时分开写更容易排查构建错误</p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>使用RUN执行命令时当前阶段必须包含所执行的命令才可以，否则需要先安装相关命令</p></div><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">comman</span><span style="color:#BABED8;">d</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">executable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">param1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">param2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">...]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>RUN支持两种执行形式：<u>shell格式和exec格式</u>。shell格式就是在终端执行命令一样，可以使用管道、重定向、变量的一些特性，而exec格式不会采用shell执行，而是直接在容器中执行，写法就像一个一维数组，将每个参数放在每个位置即可，使用exec可以减少启动新shell进程的开销，且会作为第一进程执行。</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> curl -I http://localhost</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;curl&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;-I&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;http://localhost&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="copy" tabindex="-1">COPY <a class="header-anchor" href="#copy" aria-label="Permalink to &quot;COPY&quot;">​</a></h3><p>复制本地文件或路径到容器的文件系统，支持通配符匹配，不支持远程url文件地址，不支持压缩包自动解压，相比<a href="/fullstack/docker/dockerfile.html#add">ADD指令</a>一般使用这个也够用了</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#BABED8;"> [--chown=&lt;user&gt;:&lt;group&gt;] </span><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">--chmod</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#BABED8;">perms</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#BABED8;">src</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">... </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">dest</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#BABED8;"> [--chown=&lt;user&gt;:&lt;group&gt;] </span><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">--chmod</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#BABED8;">perms</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;src&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,... </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;dest&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>复制文件也支持设置指定的用户和权限组，同时支持<code>--from=xx</code>多阶段产物的复制，这种特性对于减小镜像构建体积作用很大，你可以从<a href="/fullstack/docker/dockerfile.html#多阶段构建">多阶段构建</a>了解其作用</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 绝对路径</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> *.md /app</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> hom?.txt /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 相对路径 work相对于 WORKDIR</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> *.sh work</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 修改文件权限</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> --chown=1 files* /somedir/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="add" tabindex="-1">ADD <a class="header-anchor" href="#add" aria-label="Permalink to &quot;ADD&quot;">​</a></h3><p>复制本地文件、路径或<u>远程文件</u>到容器文件系统，相比<a href="/fullstack/docker/dockerfile.html#copy">COPY</a>可以远程文件，并自动下载复制到目标位置。如果是压缩文件，也会自动解压。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ADD</span><span style="color:#BABED8;"> [--chown=&lt;user&gt;:&lt;group&gt;] </span><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">--chmod</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#BABED8;">perms</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#89DDFF;"> [</span><span style="color:#BABED8;">--checksum</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#BABED8;">checksum</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#BABED8;">src</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">... </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;">dest</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">ADD</span><span style="color:#BABED8;"> [--chown=&lt;user&gt;:&lt;group&gt;] </span><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">--chmod</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#BABED8;">perms</span><span style="color:#89DDFF;">&gt;]</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;src&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,... </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;dest&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">ADD</span><span style="color:#BABED8;"> ubuntu-xenial-core-cloudimg-amd64-root.tar.gz /</span></span>
<span class="line"><span style="color:#F78C6C;">ADD</span><span style="color:#BABED8;"> *.md /app</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="volume" tabindex="-1">VOLUME <a class="header-anchor" href="#volume" aria-label="Permalink to &quot;VOLUME&quot;">​</a></h3><p>定义容器数据挂载点，在运行容器时使用<code>-v</code>或<code>--mount</code>参数指定宿主机目录或文件挂载到容器的挂载点，实现容器与主机之间的数据共享，将容器的数据和应用程序分离开来，保持容器的数据独立性，也便于在主机上修改相应的配置文件。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">VOLUME</span><span style="color:#C3E88D;"> /dir1 /dir2 /dir3 ...</span></span>
<span class="line"><span style="color:#FFCB6B;">VOLUME</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dir1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">...., </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dir9999</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>VOLUME支持多个挂载点，在运行容器时通过<code>-v</code>进行挂载</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ...</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建文件夹 static</span></span>
<span class="line"><span style="color:#BABED8;">mkdir /static</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 将容器外部的html文件复制到 static中</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> /html /static</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建挂载点</span></span>
<span class="line"><span style="color:#F78C6C;">VOLUME</span><span style="color:#BABED8;"> /static</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在运行时通过<code>-v /somedir:/static</code>可以覆盖容器中的文件</p><h3 id="expose" tabindex="-1">EXPOSE <a class="header-anchor" href="#expose" aria-label="Permalink to &quot;EXPOSE&quot;">​</a></h3><p>EXPOSE 指令用于声明容器运行时要监听的网络端口号。该指令并不会在容器运行时自动将端口号映射到主机上，而是作为一种文档形式的标记，用于告诉用户哪些端口可以被容器访问。</p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>EXPOSE指令并不会自动将容器的端口映射到主机上，如果需要将容器的端口映射到主机上，需要在运行容器时使用 -p 或 --publish 参数指定端口映射规则。同时，也需要确保容器运行的应用程序实际上监听了指定的端口号，否则端口号将无法被访问。</p></div><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">EXPOSE</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">por</span><span style="color:#BABED8;">t</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> [&lt;port&gt;/&lt;protocol&gt;...]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>其中，<code>&lt;port&gt;</code>表示要监听的端口号，可以是1到65535之间的任意整数。如果要监听多个端口号，可以在 EXPOSE 指令中指定多个端口号，每个端口号用空格分隔。如果要监听的端口号是使用 TCP 或 UDP 协议，则可以在端口号后面添加 /tcp 或 /udp 表示协议类型。例如，<code>EXPOSE 80/tcp</code> 表示要监听 TCP 协议的 80 端口。</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> nginx</span></span>
<span class="line"><span style="color:#F78C6C;">EXPOSE</span><span style="color:#BABED8;"> 80/tcp</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>指明该容器运行是会监听容器中的80端口，然后在运行时可以通过<code>-p</code>和主机进行端口之间的映射：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 将主机的 8088 端口映射到 容器的 80端口，就可以使用 宿主机的 IP:port 方式访问到nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> run -p </span><span style="color:#F78C6C;">8088</span><span style="color:#C3E88D;">:80 nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="cmd" tabindex="-1">CMD <a class="header-anchor" href="#cmd" aria-label="Permalink to &quot;CMD&quot;">​</a></h3><p>CMD 指令用于指定容器启动时默认要执行的命令。当我们使用<code>docker run</code>命令启动容器时，如果没有指定要执行的命令，那么将会执行 CMD 中指定的命令。</p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Dockerfile 中只能使用一条 CMD 指令。如果在 Dockerfile 中使用了多个 CMD 指令，只有最后一个 CMD 指令会生效</p></div><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># exec执行</span></span>
<span class="line"><span style="color:#FFCB6B;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">executable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">param1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">param2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 作为 ENTRYPOINT参数</span></span>
<span class="line"><span style="color:#FFCB6B;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">param1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">param2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># shell 执行</span></span>
<span class="line"><span style="color:#FFCB6B;">CMD</span><span style="color:#C3E88D;"> command param1 param2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>CMD支持exec和shell两种写法，使用exec方式可以和<a href="/fullstack/docker/dockerfile.html#entrypoint">ENTRYPOINT</a>结合并作为其参数使用，强烈建议使用exec方式使用。</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> busybox</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 使用ping localhost 3次后停止</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;ping&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;-c&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;3&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;localhost&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>构建镜像：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> build -t nginx:CMD --file Dockerfile-CMD .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>运行容器：容器启动会执行Dockerfile中指定的CMD命令，这里执行<code>ping localhost</code>3次后停止</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker run --rm  nginx:CMD</span></span>
<span class="line"><span style="color:#FFCB6B;">PING</span><span style="color:#C3E88D;"> localhost </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">127.0.0.1</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">: </span><span style="color:#F78C6C;">56</span><span style="color:#C3E88D;"> data bytes</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">127.0</span><span style="color:#C3E88D;">.0.1: seq=</span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">64</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">0.064</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">127.0</span><span style="color:#C3E88D;">.0.1: seq=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">64</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">0.198</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">127.0</span><span style="color:#C3E88D;">.0.1: seq=</span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">64</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">0.196</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">---</span><span style="color:#C3E88D;"> localhost ping statistics ---</span></span>
<span class="line"><span style="color:#FFCB6B;">3</span><span style="color:#C3E88D;"> packets transmitted, </span><span style="color:#F78C6C;">3</span><span style="color:#C3E88D;"> packets received, </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">% packet loss</span></span>
<span class="line"><span style="color:#FFCB6B;">round-trip</span><span style="color:#C3E88D;"> min/avg/max = </span><span style="color:#F78C6C;">0.064</span><span style="color:#C3E88D;">/0.152/0.198 ms</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>运行容器时提供默认运行的命令来覆盖默认的命令：这里使用<code>date</code>命令代替了Dockerfile中CMD的命令</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker run --rm  nginx:CMD date</span></span>
<span class="line"><span style="color:#FFCB6B;">Tue</span><span style="color:#C3E88D;"> Mar </span><span style="color:#F78C6C;">28</span><span style="color:#F78C6C;"> 07</span><span style="color:#C3E88D;">:23:07 UTC </span><span style="color:#F78C6C;">2020</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p>容器的运行必须提供默认的运行命令，可以运行时提供(CMD/ENTRYPOINT)或者构建时提供，没有默认运行命令则会自动退出，低版本可能会报错</p></div><p>我们去掉以上的<code>CMD</code>命令重新构建镜像：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> build -t nginx:CMD --file Dockerfile-CMD .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后运行容器：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker run --rm  nginx:CMD</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="entrypoint" tabindex="-1">ENTRYPOINT <a class="header-anchor" href="#entrypoint" aria-label="Permalink to &quot;ENTRYPOINT&quot;">​</a></h3><p>和<a href="/fullstack/docker/dockerfile.html#cmd">CMD</a>一样ENTRYPOINT命令也是用于指定容器启动时默认要执行的命令，也是只能最后一个生效。若Dockerfile中CMD和ENTRYPOINT都存在，则ENTRYPOINT作为容器的运行命令，CMD将作为ENTRYPOINT的参数；若运行容器时再次指定了CMD的参数，将会覆盖默认的CMD参数，但参数也会追加到ENTRYPOINT作为参数使用。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">executable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">param1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">, </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">param2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">]</span></span>
<span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#C3E88D;"> command param1 param2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>尽管ENTRYPOINT支持两种形式的写法，但是也是强烈建议使用exec形式，避免和CMD参数追加的问题。</p><p>若想覆盖Dockerfile中的ENTRYPOINT时，可以在运行容器时通过<code>--entrypoint</code>来指定要运行的程序</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> busybox</span></span>
<span class="line"><span style="color:#F78C6C;">ENTRYPOINT</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;ping&quot;</span><span style="color:#BABED8;">]</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;localhost&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;-c&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;3&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>以上指定容器运行程序为<code>ping</code>，CMD作为ENTRYPOINT的参数，整体命令为<code>ping localhost -c 3</code>，ping完localhost 3次就会停止</p><p>运行容器：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker run --rm  nginx:ENTRYPOINT</span></span>
<span class="line"><span style="color:#FFCB6B;">PING</span><span style="color:#C3E88D;"> localhost </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">127.0.0.1</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">: </span><span style="color:#F78C6C;">56</span><span style="color:#C3E88D;"> data bytes</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">127.0</span><span style="color:#C3E88D;">.0.1: seq=</span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">64</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">0.069</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">127.0</span><span style="color:#C3E88D;">.0.1: seq=</span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">64</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">0.256</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">127.0</span><span style="color:#C3E88D;">.0.1: seq=</span><span style="color:#F78C6C;">2</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">64</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">0.248</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">---</span><span style="color:#C3E88D;"> localhost ping statistics ---</span></span>
<span class="line"><span style="color:#FFCB6B;">3</span><span style="color:#C3E88D;"> packets transmitted, </span><span style="color:#F78C6C;">3</span><span style="color:#C3E88D;"> packets received, </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">% packet loss</span></span>
<span class="line"><span style="color:#FFCB6B;">round-trip</span><span style="color:#C3E88D;"> min/avg/max = </span><span style="color:#F78C6C;">0.069</span><span style="color:#C3E88D;">/0.191/0.256 ms</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>运行时通过传参覆盖掉默认的 CMD，并且会将动态添加的参数追加到 ENTRYPOINT：这里改为ping qq.com 1次就停止</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker run --rm  nginx:ENTRYPOINT qq.com -c </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#FFCB6B;">PING</span><span style="color:#C3E88D;"> qq.com </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">183.3.226.35</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">: </span><span style="color:#F78C6C;">56</span><span style="color:#C3E88D;"> data bytes</span></span>
<span class="line"><span style="color:#FFCB6B;">64</span><span style="color:#C3E88D;"> bytes from </span><span style="color:#F78C6C;">183.3</span><span style="color:#C3E88D;">.226.35: seq=</span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;"> ttl=</span><span style="color:#F78C6C;">127</span><span style="color:#C3E88D;"> time=</span><span style="color:#F78C6C;">34.314</span><span style="color:#C3E88D;"> ms</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">---</span><span style="color:#C3E88D;"> qq.com ping statistics ---</span></span>
<span class="line"><span style="color:#FFCB6B;">1</span><span style="color:#C3E88D;"> packets transmitted, </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;"> packets received, </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">% packet loss</span></span>
<span class="line"><span style="color:#FFCB6B;">round-trip</span><span style="color:#C3E88D;"> min/avg/max = </span><span style="color:#F78C6C;">34.314</span><span style="color:#C3E88D;">/34.314/34.314 ms</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>通过运行容器时使用<code>--entrypoint</code>替换默认的ENTRYPOINT命令：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> docker run --rm --entrypoint </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ls</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> nginx:ENTRYPOINT -ll</span></span>
<span class="line"><span style="color:#FFCB6B;">total</span><span style="color:#F78C6C;"> 16</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#F78C6C;">    2</span><span style="color:#C3E88D;"> root     root         </span><span style="color:#F78C6C;">12288</span><span style="color:#C3E88D;"> Dec </span><span style="color:#F78C6C;">29</span><span style="color:#F78C6C;">  2021</span><span style="color:#C3E88D;"> bin</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#F78C6C;">    5</span><span style="color:#C3E88D;"> root     root           </span><span style="color:#F78C6C;">340</span><span style="color:#C3E88D;"> Mar </span><span style="color:#F78C6C;">28</span><span style="color:#F78C6C;"> 10</span><span style="color:#C3E88D;">:07 dev</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#F78C6C;">    1</span><span style="color:#C3E88D;"> root     root            </span><span style="color:#F78C6C;">66</span><span style="color:#C3E88D;"> Mar </span><span style="color:#F78C6C;">28</span><span style="color:#F78C6C;"> 10</span><span style="color:#C3E88D;">:07 etc</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#F78C6C;">    2</span><span style="color:#C3E88D;"> nobody   nobody           </span><span style="color:#F78C6C;">6</span><span style="color:#C3E88D;"> Dec </span><span style="color:#F78C6C;">29</span><span style="color:#F78C6C;">  2021</span><span style="color:#C3E88D;"> home</span></span>
<span class="line"><span style="color:#FFCB6B;">dr-xr-xr-x</span><span style="color:#F78C6C;">  294</span><span style="color:#C3E88D;"> root     root             </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;"> Mar </span><span style="color:#F78C6C;">28</span><span style="color:#F78C6C;"> 10</span><span style="color:#C3E88D;">:07 proc</span></span>
<span class="line"><span style="color:#FFCB6B;">drwx------</span><span style="color:#F78C6C;">    2</span><span style="color:#C3E88D;"> root     root             </span><span style="color:#F78C6C;">6</span><span style="color:#C3E88D;"> Dec </span><span style="color:#F78C6C;">29</span><span style="color:#F78C6C;">  2021</span><span style="color:#C3E88D;"> root</span></span>
<span class="line"><span style="color:#FFCB6B;">dr-xr-xr-x</span><span style="color:#F78C6C;">   12</span><span style="color:#C3E88D;"> root     root             </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;"> Mar </span><span style="color:#F78C6C;">28</span><span style="color:#F78C6C;"> 10</span><span style="color:#C3E88D;">:07 sys</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxrwxrwt</span><span style="color:#F78C6C;">    2</span><span style="color:#C3E88D;"> root     root             </span><span style="color:#F78C6C;">6</span><span style="color:#C3E88D;"> Dec </span><span style="color:#F78C6C;">29</span><span style="color:#F78C6C;">  2021</span><span style="color:#C3E88D;"> tmp</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#F78C6C;">    3</span><span style="color:#C3E88D;"> root     root            </span><span style="color:#F78C6C;">18</span><span style="color:#C3E88D;"> Dec </span><span style="color:#F78C6C;">29</span><span style="color:#F78C6C;">  2021</span><span style="color:#C3E88D;"> usr</span></span>
<span class="line"><span style="color:#FFCB6B;">drwxr-xr-x</span><span style="color:#F78C6C;">    4</span><span style="color:#C3E88D;"> root     root            </span><span style="color:#F78C6C;">30</span><span style="color:#C3E88D;"> Dec </span><span style="color:#F78C6C;">29</span><span style="color:#F78C6C;">  2021</span><span style="color:#C3E88D;"> var</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="onbuild" tabindex="-1">ONBUILD <a class="header-anchor" href="#onbuild" aria-label="Permalink to &quot;ONBUILD&quot;">​</a></h3><p>当使用包含 ONBUILD 指令的镜像作为下一个 Dockerfile 的基础镜像时，ONBUILD 指令中的命令将自动执行，并将其结果添加到子镜像中。这样可以在构建镜像时预先处理一些操作，以便在基于该镜像构建更高级别的应用程序时，执行这些操作不必重复编写代码。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">ONBUILD</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">INSTRUCTIO</span><span style="color:#BABED8;">N</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> ubuntu:latest</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> apt-get update &amp;&amp; apt-get install -y python3</span></span>
<span class="line"><span style="color:#F78C6C;">WORKDIR</span><span style="color:#BABED8;"> /app</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">ONBUILD</span><span style="color:#F78C6C;"> COPY</span><span style="color:#BABED8;"> . .</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">ONBUILD</span><span style="color:#F78C6C;"> RUN</span><span style="color:#BABED8;"> pip3 install -r requirements.txt</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">ONBUILD</span><span style="color:#F78C6C;"> CMD</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;python3&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;app.py&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当使用这个镜像作为基础镜像创建一个新的 Dockerfile 时，Docker 将自动复制当前 Dockerfile 目录中的所有文件到新的镜像中，并安装 requirements.txt 中指定的 Python 库。然后，在新的镜像中，CMD 指令将自动运行 Python 应用程序。 假如以上的镜像名为<code>myimage</code>，使用其作为基础镜像再次构建新的镜像：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> myimage</span></span>
<span class="line"><span style="color:#F78C6C;">EXPOSE</span><span style="color:#BABED8;"> 5000</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;python3&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;run.py&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在这个 Dockerfile 中，我们使用 myimage 镜像作为基础镜像，并指定了一些额外的操作，例如暴露端口和运行<code>run.py</code>文件。由于 myimage 镜像中包含 ONBUILD 指令，因此 Docker 将自动执行 COPY 和 RUN 命令，并安装 requirements.txt 中指定的 Python 库。然后，在新的镜像中，CMD 指令将自动运行 Python 应用程序。</p><h3 id="healthcheck" tabindex="-1">HEALTHCHECK <a class="header-anchor" href="#healthcheck" aria-label="Permalink to &quot;HEALTHCHECK&quot;">​</a></h3><p>指定容器健康检查的方式和频率，以及容器健康检查失败时的行为，Docker 支持多种检查方式，例如 HTTP 接口、TCP 端口、命令行输出等。可以根据应用程序的特点和需求选择适合的健康检查方式。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">HEALTHCHECK</span><span style="color:#BABED8;"> [OPTIONS] CMD command</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 禁止健康检查</span></span>
<span class="line"><span style="color:#FFCB6B;">HEALTHCHECK</span><span style="color:#C3E88D;"> NONE</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> nginx</span></span>
<span class="line"><span style="color:#F78C6C;">HEALTHCHECK</span><span style="color:#BABED8;"> --interval=10s --timeout=10s \</span></span>
<span class="line"><span style="color:#F78C6C;">  CMD</span><span style="color:#BABED8;"> curl -I http://localhost || exit 1</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;nginx&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;g&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;daemon off;&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在这个 Dockerfile 中，我们使用HEALTHCHECK指令设置了容器健康检查的方式。具体来说，我们使用 curl 命令检查容器中是否能够访问 <code>http://localhost</code>，并将检查间隔设置为<code>10s</code>，检查超时时间设置为<code>10s</code>。如果健康检查失败，则容器将退出。</p><p>在运行容器时，可以使用 --health-cmd、--health-interval、--health-timeout 等参数覆盖 Dockerfile 中设置的健康检查参数</p><p>⭐️⭐️⭐️⭐️⭐️</p><p>到这里关于Dockerfile的语法知识已经讲的差不多了，如果你还需要更多有关Dockerfile语法请阅读<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noreferrer">官方文档</a></p><h2 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h2><ol><li>保留字指令必须大写，后面要跟随至少一个参数</li><li>指令从上到下执行</li><li>每条指令都会创建一个新的镜像层并对镜像进行提交</li><li>docker会对前面相同的步骤进行构建缓存</li></ol><h2 id="构建上下文" tabindex="-1">构建上下文 <a class="header-anchor" href="#构建上下文" aria-label="Permalink to &quot;构建上下文&quot;">​</a></h2><p>Dockerfile 的构建上下文（Build Context）是指在构建 Docker 镜像时，Docker 引擎需要读取的文件和目录的集合。</p><p>构建上下文通过<code>docker build</code>命令的<code>-f</code>和 <code>.</code> 参数指定。其中，<code>-f</code> 参数用于指定 Dockerfile 文件的路径，<code>.</code> 参数用于指定构建上下文的路径。例如，下面是一个使用 docker build 命令构建 Docker 镜像的示例：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> build -f Dockerfile -t myimage .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>在这个命令中，我们使用 <code>-f</code> 参数指定 Dockerfile 文件的路径为当前目录下的 Dockerfile 文件，使用 <code>.</code> 参数指定构建上下文的路径为当前目录。Docker引擎将读取当前目录下的所有文件和目录，并根据 Dockerfile 文件中的指令构建 Docker 镜像。</p><p>需要注意的是，构建上下文中包含的所有文件和目录都会被上传到 Docker 引擎中进行构建。因此，构建上下文的大小会直接影响构建时间和构建过程中网络传输的数据量。建议使用<code>.dockerignore</code>将构建上下文限制在必要的文件和目录范围内，避免上传无用文件和目录，以提高构建效率。</p><h2 id="镜像构建" tabindex="-1">镜像构建 <a class="header-anchor" href="#镜像构建" aria-label="Permalink to &quot;镜像构建&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>规定在Dockerfile中第一条指令必须是<code>FROM</code>，作为制作镜像的最基础的镜像层，基础镜像可以是空镜像如：scratch 镜像</p></div><p>或许你已经注意到了，以上镜像构建使用的是<code>docker build</code>命令，它就是用来构建镜像的。<u><strong>构建是在服务端(docker引擎)进行的，我们知道docker是典型的<code>C/S</code>架构，通过构建命令会将当前上下文的文件传递给服务端，然后进行构建，这种架构也天然的支持分布式远端构建，</strong></u>这里不用了解太多。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> build [OPTIONS] PATH </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;"> URL</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> -</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>支持本地Dockerfile文件，还支持远程URL，如果文件是个tar压缩包，将会自动解压。常用的参数如下：</p><ul><li><code>构建上下文</code>：指定上下文目录，默认<code>.</code>，可以是任何文件系统路径</li><li><code>-f</code>：指定Dockerfile文件路径，其命名可以随意，默认当前路径下的Dockerfile文件</li><li><code>-t</code>：镜像名及标签，如 nginx:1.1</li><li><code>--build-arg</code>：Dockerfile构建arg参数</li><li><code>--no-cache</code>：禁用构建缓存，强制重新构建镜像</li><li><code>--pull</code>：强制每次重新拉取远程镜像</li></ul><blockquote><p>在构建命令前加上 DOCKER_BUILDKIT=1 参数可以查看构建构建日志和进度，便于调试</p></blockquote><p>例子：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> build -t nginx:1.1 -f ../Dockerfile . --pull --no-cache</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>更多关于<code>docker build</code>的用法可以使用<code>docker build -h</code>了解</p></blockquote><h2 id="多阶段构建" tabindex="-1">多阶段构建 <a class="header-anchor" href="#多阶段构建" aria-label="Permalink to &quot;多阶段构建&quot;">​</a></h2><p>到这里你基本上已经会简单的构建镜像了，但往往构建的镜像体积比较大，内部往往包含了一些无用的内容文件。如前端静态项目可能需要用node进行打包，最后用nginx提供http服务，实际并不需要node环境及文件，但还是一并放进了镜像中，体积会变大好多，这种情况可以使用多阶段构建解决。</p><p>Dockerfile 多阶段构建是一种优化 Docker 镜像构建过程的技术。它可以在一个 Dockerfile 文件中定义多个阶段，每个阶段可以使用不同的基础镜像和构建步骤，并且可以挑取上一阶段的产物，最终生成一个精简的镜像。</p><p>语法：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#C3E88D;"> xxx AS stageName</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>同样的每个阶段都是以<code>FROM</code>开始，使用<code>AS</code>可以为当前阶段命名，名字需小写</p><p>例子：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># build阶段</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> node:14.16.2 </span><span style="color:#F78C6C;">AS</span><span style="color:#BABED8;"> build</span></span>
<span class="line"><span style="color:#F78C6C;">WORKDIR</span><span style="color:#BABED8;"> /app</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> package.json .</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> src .</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> npm install &amp;&amp; npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 最后一个阶段</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> nginx:alpine</span></span>
<span class="line highlighted"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> --from=build /app/dist /var/etc/nginx/html</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;nginx&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;g&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;daemon off;&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这个Dockerfile定义了两个阶段的构建，第一阶段为<code>build</code>阶段，使用<code>node:14.16.2</code>为基础镜像，安装前端依赖并进行打包，产物为<code>dist</code>目录；第二阶段以<code>nginx:alpine</code>为基础镜像使用<code>COPY --from=build</code>将build阶段的<code>/app/dist</code>产物复制到第二阶段的nginx静态目录，最终设置容器的启动命令。最终打包出来的镜像只包含了最后一阶段的文件，不会包含build阶段的node内容，这样会使镜像的体积减小很多，也能在<code>CI/CD</code>中减小打包交付时间，提高效率</p><blockquote><p>你可以尝试将以上的Dockerfile分别用单阶段和多阶段进行构建，对比下两者的大小，加深其作用印象</p></blockquote><h2 id="dockerignore" tabindex="-1">dockerignore <a class="header-anchor" href="#dockerignore" aria-label="Permalink to &quot;dockerignore&quot;">​</a></h2><p>使用多阶段构建是一种优化手段，另一个重要的概念便是<code>dockerignore</code>，它是用来做什么的？前面也提到了docker是一个<code>C/S</code>架构，镜像的构建是在Docker Engine构建的，构建时会将构建上下文的文件全部上传到服务端，如果上传了一些不必要的文件，就会影响总体耗时。</p><p>docker也支持像<code>.gitignore</code>类似的配置文件<code>.dockerignore</code>，在构建上传文件时将会忽略掉<code>.gitignore</code>中匹配的文件或路径，从而缩短文件上传耗时。</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span>.DS_Store</span></span>
<span class="line"><span>node_modules</span></span>
<span class="line"><span>*.md</span></span>
<span class="line"><span>*/dist</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="构建前端项目" tabindex="-1">构建前端项目 <a class="header-anchor" href="#构建前端项目" aria-label="Permalink to &quot;构建前端项目&quot;">​</a></h2><p>本次就分别以前端的静态项目和NodeJS项目为例子做个简单的构建演示</p><h3 id="静态项目" tabindex="-1">静态项目 <a class="header-anchor" href="#静态项目" aria-label="Permalink to &quot;静态项目&quot;">​</a></h3><p>静态项目用node打包，最终以nginx发布，源码地址👉<a href="https://github.com/ihengshuai/blog/tree/main/__example__/docker/frontend-static" target="_blank" rel="noreferrer">点击这里</a></p><p>这里使用<code>vite</code>简单创建一个demo，使用<code>react+ts</code>模板</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> create vite</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>编写Dockerfile：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># docker发布前端静态项目简单demo</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> node:alpine </span><span style="color:#F78C6C;">as</span><span style="color:#BABED8;"> builder</span></span>
<span class="line"><span style="color:#F78C6C;">WORKDIR</span><span style="color:#BABED8;"> /app</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> . .</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> npm install &amp;&amp; npm run build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 大小只有20MB左右</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> nginx:alpine</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> --from=builder /app/dist /usr/share/nginx/html</span></span>
<span class="line"><span style="color:#F78C6C;">CMD</span><span style="color:#BABED8;"> [ </span><span style="color:#C3E88D;">&quot;nginx&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;-g&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;daemon off;&quot;</span><span style="color:#BABED8;"> ]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>构建镜像：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> build -t blog:v1 .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>运行容器：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> run --rm -p </span><span style="color:#F78C6C;">8088</span><span style="color:#C3E88D;">:80 blog:v1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>以本人为例以上镜像大小只有<code>22.4MB</code>，浏览器输入<code>IP:8088</code>访问页面就可以看到静态页面了</p><h3 id="nodejs项目" tabindex="-1">NodeJS项目 <a class="header-anchor" href="#nodejs项目" aria-label="Permalink to &quot;NodeJS项目&quot;">​</a></h3><p>NodeJS服务项目，使用<code>pm2</code>进行发布，源码地址👉<a href="https://github.com/ihengshuai/blog/tree/main/__example__/docker/frontend-nodejs" target="_blank" rel="noreferrer">点击这里</a>。 初始化项目，并安装相应的依赖：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> init -y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># package.json文件</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#FFCB6B;">  &quot;name&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">frontend-nodejs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">  &quot;version&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">  &quot;main&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">  &quot;dependencies&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#C3E88D;"> {</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;dayjs&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">^1.11.7</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#FFCB6B;">    &quot;express&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">^4.18.2</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>创建<code>server.js</code>文件：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> express</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> dayjs </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dayjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> res</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#BABED8;">  console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">【request】：</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> +</span><span style="color:#BABED8;"> req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">  res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    code</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    date</span><span style="color:#89DDFF;">:</span><span style="color:#82AAFF;"> dayjs</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">format</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">YYYY-MM-DD HH:mm:ss</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    path</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    query</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">      ...</span><span style="color:#BABED8;">req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">query</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    },</span></span>
<span class="line"><span style="color:#89DDFF;">  }</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">10001</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> ()</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#BABED8;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">server is running on port 10001.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">))</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>创建<code>pm2.json</code>配置文件：</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">apps</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    {</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">frontend-nodejs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">script</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">server.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">watch</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> false,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">instance</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">autorestart</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> true,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">max_memory_restart</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">1G</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#F78C6C;">NODE_ENV</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">development</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      },</span></span>
<span class="line"><span style="color:#89DDFF;">      &quot;</span><span style="color:#FFCB6B;">env_production</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#F78C6C;">NODE_ENV</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">production</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">      }</span></span>
<span class="line"><span style="color:#89DDFF;">    }</span></span>
<span class="line"><span style="color:#89DDFF;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>Dockerfile配置文件：</p><div class="language-docker line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">docker</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#BABED8;"> node:alpine</span></span>
<span class="line"><span style="color:#F78C6C;">WORKDIR</span><span style="color:#BABED8;"> /app</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> package.json .</span></span>
<span class="line"><span style="color:#F78C6C;">RUN</span><span style="color:#BABED8;"> npm install &amp;&amp; npm install pm2 -g</span></span>
<span class="line"><span style="color:#F78C6C;">COPY</span><span style="color:#BABED8;"> . .</span></span>
<span class="line"><span style="color:#F78C6C;">EXPOSE</span><span style="color:#BABED8;"> 10001</span></span>
<span class="line"><span style="color:#F78C6C;">ENTRYPOINT</span><span style="color:#BABED8;"> [</span><span style="color:#C3E88D;">&quot;pm2-runtime&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;start&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;pm2.json&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;--env&quot;</span><span style="color:#BABED8;">, </span><span style="color:#C3E88D;">&quot;production&quot;</span><span style="color:#BABED8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>构建镜像：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> build -t blog:v2 .</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>运行容器：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> run --rm -p </span><span style="color:#F78C6C;">8088</span><span style="color:#C3E88D;">:10001 blog:v2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>以本人为例以上镜像大小有200MB大小，浏览器输入<code>IP:8088</code>访问页面就可以页面了，你还可以控制台查看日志输出</p><h2 id="构建优化" tabindex="-1">构建优化 <a class="header-anchor" href="#构建优化" aria-label="Permalink to &quot;构建优化&quot;">​</a></h2><p>构建优化在生产环境中是非常必要的，常见的优化手段有：</p><ul><li>多阶段构建：使用多阶段构建可以减小镜像大小，提高构建速度。多阶段构建可以将构建环境和运行环境分离，只保留必要的文件和组件。</li><li>使用 .dockerignore 文件：使用 .dockerignore 文件可以避免将不必要的文件和目录复制到镜像中，从而减小镜像大小。</li><li>构建时使用缓存：使用 Dockerfile 构建缓存可以加速镜像构建过程。例如，在 Dockerfile 中，可以将不经常更改的指令放在前面，从而利用缓存。</li><li>使用更小的基础镜像：使用更小的基础镜像可以减小镜像大小，提高镜像构建和部署的效率。</li></ul><h2 id="参考文档" tabindex="-1">参考文档 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档&quot;">​</a></h2><ul><li><a href="https://docs.docker.com/engine/reference/builder" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/builder</a></li><li><a href="https://docs.docker.com/engine/reference/commandline/build" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/commandline/build</a></li><li><a href="https://docs.docker.com/language/nodejs/build-images" target="_blank" rel="noreferrer">https://docs.docker.com/language/nodejs/build-images</a></li><li><a href="https://docs.docker.com/engine/reference/run" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/run</a></li></ul><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>Dockerfile 是构建和管理 Docker 镜像的重要工具，使用它可以简化应用程序的部署和管理，并提高可重复性、可自动化性、可定制性和可扩展性。</p><!--[--><div class="reward-divider"></div><figure><figcaption> 若您在阅读过程中发现一些错误：如语句不通、文字、逻辑等错误，可以在评论区指出，我会及时调整修改，感谢您的阅读。同时您觉得这篇文章对您有帮助的话，可以打赏作者一笔作为鼓励，金额不限，感谢支持🤝。 </figcaption><div style="text-align:center;margin-top:2em;"><img style="display:inline;" src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/005HV6Avgy1h72anu40usj30dw0dw40j.jpg" width="200" alt="支付宝捐赠"><img style="display:inline;" src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/005HV6Avgy1h72ap99ym1j30b40b4abq.jpg" width="200" alt="微信支付捐赠"></div></figure><div class="reward-divider"></div><div class="share_wrap"><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-weibo.png" alt="share to weibo" title="分享到微博"></a><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-twitter.png" alt="share to twitter" title="分享到twitter"></a><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-facebook.png" alt="share to facebook" title="分享到facebook"></a></div><!--]--><!----></div></div></main><footer class="VPDocFooter" data-v-fb80de84 data-v-a4d10c8e><!--[--><!--]--><div class="edit-info" data-v-a4d10c8e><!----><div class="last-updated" data-v-a4d10c8e><p class="VPLastUpdated" data-v-a4d10c8e data-v-86563300>最近更新: <time datetime="2024-03-03T04:31:19.000Z" data-v-86563300></time></p></div></div><nav class="prev-next" data-v-a4d10c8e><div class="pager" data-v-a4d10c8e><a class="VPLink link pager-link prev" href="/fullstack/docker/network.html" data-v-a4d10c8e><!--[--><span class="desc" data-v-a4d10c8e>Previous page</span><span class="title" data-v-a4d10c8e>Docker网络原理</span><!--]--></a></div><div class="pager" data-v-a4d10c8e><a class="VPLink link pager-link next" href="/fullstack/docker/docker-compose.html" data-v-a4d10c8e><!--[--><span class="desc" data-v-a4d10c8e>Next page</span><span class="title" data-v-a4d10c8e>使用DockerCompose部署服务</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-e69ff593 data-v-e09097b5><div class="container" data-v-e09097b5><p class="message" data-v-e09097b5>Released under the MIT License.</p><p class="copyright" data-v-e09097b5>Copyright © 2018-2024 HengShuai</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"frontend_babel_babel-analysis.md\":\"wGpC9j4r\",\"frontend_babel_babel-plugin-guide.md\":\"ppFJFpUc\",\"frontend_babel_base.md\":\"vrUaWuJ_\",\"frontend_base.md\":\"dwQglb_Z\",\"frontend_browser_base.md\":\"8v9kmWYQ\",\"frontend_building-tool_base.md\":\"IZjj-1k_\",\"frontend_canvas_base.md\":\"4FFeOXMN\",\"frontend_canvas_magic-effects.md\":\"d72-kJZY\",\"frontend_cli_index.md\":\"LW95mYz4\",\"frontend_compiler_index.md\":\"kb3LvP4F\",\"article_2021_vue-img-lazyload.md\":\"nS2xctKa\",\"frontend_computer-network_arp-protocol.md\":\"Kq6yx99o\",\"article_2020_vscode-shortcut.md\":\"9YPtkAQd\",\"article_2020_web-cache.md\":\"tgnHisxs\",\"article_2019_mysql-guide.md\":\"sVywMOTl\",\"article_2021_pwa-app.md\":\"OleMbyZc\",\"article_2021_vue-core-process.md\":\"lvBKNU2P\",\"article_2019_js-type-transfer.md\":\"6bgN44L7\",\"frontend_computer-network_base.md\":\"rscsR2cq\",\"article_base.md\":\"MRVl6scQ\",\"article_2022_emoji-markup.md\":\"OhV-I-1u\",\"article_2019_what-bfc.md\":\"3X8ih4fR\",\"article_2021_ts-decorator.md\":\"t9oGw5oN\",\"article_2020_webpack-guide.md\":\"4hgG0rTv\",\"article_2021_js-pattern.md\":\"s7bHowR9\",\"article_2021_flex-layout.md\":\"Svx6-bGi\",\"article_2019_nvm-guide.md\":\"DOn-ZyKp\",\"article_2019_ktv-system.md\":\"8zwU_3Hs\",\"article_2020_optimize-web-server.md\":\"zI4x4pon\",\"article_2019_css-center.md\":\"39T7ILEY\",\"article_2020_domparser-xml.md\":\"14rZ0LzC\",\"frontend_nginx_base.md\":\"zoU8TEMt\",\"article_2019_promise.md\":\"PPpH3Goo\",\"article_2019_bind-call-apply.md\":\"sKjhWUC_\",\"article_2019_js-copy.md\":\"aASz1f6e\",\"article_2020_regexp-guide.md\":\"Hz2CcED7\",\"article_2021_performance-tools.md\":\"f1ArMVK_\",\"frontend_performance_chunk-upload.md\":\"_H6a4GPM\",\"frontend_performance_load-perf.md\":\"GBvTUzYN\",\"frontend_performance_network-perf.md\":\"5sGmco83\",\"frontend_performance_cache.md\":\"GADg4UGM\",\"frontend_performance_performance.md\":\"eTHaQNUO\",\"frontend_performance_range-download.md\":\"hDSmWOR2\",\"frontend_performance_secure-perf.md\":\"1SJRKrnr\",\"frontend_performance_seo.md\":\"nVWyT-cr\",\"frontend_performance_virtual-scroll-1.md\":\"GMhzOTOC\",\"frontend_performance_virtual-scroll-2.md\":\"Tf9Xw2tC\",\"frontend_performance_web-score.md\":\"t6trh2aX\",\"frontend_project-integration_base.md\":\"H9p7xZIC\",\"frontend_project-integration_build-tool.md\":\"YEHYzLz2\",\"frontend_debug-skill_base.md\":\"ardgOXee\",\"frontend_debug-skill_charles.md\":\"c860e4Ce\",\"frontend_debug-skill_chrome.md\":\"VolKnY9H\",\"frontend_computer-network_ip-protocol.md\":\"cYsrbBjs\",\"frontend_project-integration_debugger-skill.md\":\"gdFZBkWV\",\"frontend_project-integration_deploy-specification.md\":\"TAZbHJxr\",\"frontend_project-integration_framework.md\":\"5X0ugAP5\",\"frontend_project-integration_git-commit.md\":\"hau9b8OP\",\"frontend_project-integration_monorepo.md\":\"vk1tlUoK\",\"frontend_project-integration_specification.md\":\"FUpSWKJb\",\"frontend_project-integration_style.md\":\"6YvYxYxO\",\"frontend_react_index.md\":\"WCWdbrtn\",\"frontend_regexp_base.md\":\"bxZXRG-x\",\"frontend_render-mode_base.md\":\"awKqNZtj\",\"frontend_sandbox_index.md\":\"gXXOpt2O\",\"frontend_ts_base.md\":\"EsuvODQ8\",\"frontend_vue_computed-watch.md\":\"ViMqGS60\",\"frontend_vue_pinia.md\":\"sFmcIG8v\",\"frontend_vue_router.md\":\"oywyEaoK\",\"frontend_vue_slot.md\":\"-cpDvOd1\",\"frontend_vue_template-compiler.md\":\"BoDuPu-F\",\"frontend_vue_transition.md\":\"oLOqknqJ\",\"frontend_debug-skill_h5.md\":\"JqHXkiol\",\"frontend_vue_update-process.md\":\"k6l2RNx4\",\"frontend_debug-skill_vscode.md\":\"bJXMRiLv\",\"frontend_vue_vuex.md\":\"mDVwtyM1\",\"frontend_wasm_base.md\":\"wKzjPpun\",\"frontend_debug-skill_wireshark.md\":\"h-Af8Z2N\",\"frontend_desktop-app_index.md\":\"CwmxVITt\",\"frontend_webpack_webpack-analysis.md\":\"B7vs5RGV\",\"frontend_editor_index.md\":\"Z3QRmU7I\",\"frontend_webpack_webpack-loader.md\":\"H5WVjPyO\",\"frontend_js_async.md\":\"xM2atz8E\",\"frontend_node-bff_index.md\":\"uvIlJlnt\",\"frontend_js_audio.md\":\"SxVGBXDx\",\"frontend_webpack_webpack-node.md\":\"wv3teGYs\",\"frontend_js_base.md\":\"xDEIN0Le\",\"frontend_webpack_webpack-plugin.md\":\"9tSSq7pn\",\"fullstack_base.md\":\"I4wE93qI\",\"fullstack_docker_base-tutorial.md\":\"9ZJDDyO1\",\"fullstack_docker_docker-compose.md\":\"zjlwGtUy\",\"frontend_js_binary.md\":\"APMVe8ro\",\"fullstack_docker_docker-repository.md\":\"wBmXzDQl\",\"frontend_js_eventloop.md\":\"F1aGIeQj\",\"frontend_js_implicit-conversion.md\":\"z9evaHOi\",\"fullstack_docker_dockerfile.md\":\"3YPLdvgt\",\"frontend_js_js-gc.md\":\"zQJ4SnO7\",\"frontend_js_meta-coding.md\":\"doArwweu\",\"fullstack_docker_install-configure.md\":\"ycQmqQb6\",\"frontend_lowcoding_base.md\":\"1AMtoVOM\",\"frontend_micro-frontend_base.md\":\"VCogbXGF\",\"frontend_monitor_base.md\":\"1PrBd---\",\"fullstack_docker_network.md\":\"sG-Vuzgw\",\"fullstack_docker_npm-repository.md\":\"xNRdDnzE\",\"fullstack_docker_volume-store.md\":\"AmWixEc_\",\"frontend_nestjs_swagger.md\":\"Miz3IuZP\",\"fullstack_gitlab_gitlab-pipeline.md\":\"2PnzZMhY\",\"fullstack_gitlab_gitlab-runner-install-configure.md\":\"AcLdY8_f\",\"fullstack_gitlab_install-configure.md\":\"hsqEggJv\",\"frontend_nestjs_base.md\":\"GEmB31Yt\",\"frontend_nestjs_mvc.md\":\"G7xy_a_Y\",\"frontend_nestjs_useful.md\":\"5BxCDwjN\",\"frontend_node-optimize_index.md\":\"9iTkxv8U\",\"frontend_node_base.md\":\"f045EATv\",\"frontend_node_node-debug.md\":\"VzMrpiGN\",\"fullstack_k8s_install.md\":\"shPzlnU9\",\"frontend_node_node-web.md\":\"BA0Qp_xe\",\"frontend_performance_node-score.md\":\"GHFkv_LH\",\"frontend_npm_index.md\":\"cPGRzDNd\",\"frontend_performance_base.md\":\"boqnWWao\",\"frontend_performance_cache-perf.md\":\"c67R59ai\",\"index.md\":\"DNChHY-j\",\"me.md\":\"9KzOPl0U\",\"super-nav_index.md\":\"sa1sp0Lq\",\"talk_2023_dad-foot-injured.md\":\"e316_81h\",\"talk_2023_lose-qoo-job.md\":\"wc9xrS2F\",\"talk_2023_love-4th-anniversary.md\":\"EL8i9jjc\",\"talk_2023_second-covid.md\":\"DQ3RHk2a\",\"talk_base.md\":\"bc9zk1r_\",\"frontend_computer-network_http-protocol.md\":\"bfrkeSkr\",\"frontend_project-integration_choose-editor.md\":\"0gNbjQse\",\"frontend_project-integration_ci-pipeline.md\":\"qrLOyYjp\",\"frontend_flutter_base.md\":\"yyvMr_gq\",\"frontend_node_node-framework.md\":\"G8o8zeYS\",\"frontend_debug-skill_fiddler.md\":\"NqneAeW9\",\"frontend_js_proto-inherit.md\":\"E5dVTnVb\",\"frontend_micro-program_index.md\":\"yyQYNhB6\",\"frontend_vue_reactivity.md\":\"9xkgqhJY\",\"frontend_webpack_base.md\":\"C2knYA00\",\"frontend_hybrid-app_base.md\":\"-Vm4xYDr\",\"frontend_node_node-measure.md\":\"4GqjVgP8\",\"frontend_node_node-process.md\":\"Ps4VtoHq\",\"frontend_project-integration_test-framework.md\":\"zZle5pVy\",\"frontend_computer-network_tcp-protocol.md\":\"fep1PHVR\",\"frontend_ts_ts-configure.md\":\"rAao85Hb\",\"frontend_visual_index.md\":\"qSiOl_Sl\",\"frontend_vue_component-render.md\":\"ZCTZuvWu\",\"frontend_js_scope-closure.md\":\"5EWzSuzB\",\"fullstack_k8s_base.md\":\"3Tzy-t_S\",\"fullstack_gitlab_npm-repository.md\":\"vjG8GM3X\",\"frontend_pattern_base.md\":\"GAbsFqbU\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"hengshuai's blog\",\"description\":\"大家好我是卫恒帅，这是我的个人博客，在这里我会分享web开发相关技能经验，也有自己的一些生活所思所悟，希望对你有所帮助，如你感觉不错可以将本站收藏！\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"dark\",\"themeConfig\":{\"externalLinkIcon\":true,\"logoLink\":\"/\",\"siteTitle\":\"Hengshuai's blog\",\"outline\":[2,3],\"outlineTitle\":\"目录\",\"nav\":[{\"text\":\"Frontend\",\"link\":\"/frontend/base.html\",\"activeMatch\":\"/frontend/base\"},{\"text\":\"Fullstack\",\"link\":\"/fullstack/base.html\",\"activeMatch\":\"/fullstack/base\"},{\"text\":\"Article\",\"link\":\"/article/base.html\",\"activeMatch\":\"/article/base\"},{\"text\":\"Case\",\"link\":\"https://case.usword.cn\"},{\"text\":\"Me\",\"link\":\"/me.html\",\"activeMatch\":\"/me\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/ihengshuai\"}],\"sidebar\":{\"/frontend/\":[{\"collapsible\":true,\"items\":[{\"text\":\"Javascript\",\"collapsed\":false,\"link\":\"/frontend/js/base.html\",\"items\":[{\"text\":\"原型、原型链与继承\",\"link\":\"/frontend/js/proto-inherit.html\"},{\"text\":\"作用域(链)、执行上下文及闭包\",\"link\":\"/frontend/js/scope-closure.html\"},{\"text\":\"类型隐式转换\",\"link\":\"/frontend/js/implicit-conversion.html\"},{\"text\":\"事件循环(EventLoop)\",\"link\":\"/frontend/js/eventloop.html\"},{\"text\":\"异步编程\",\"link\":\"/frontend/js/async.html\"},{\"text\":\"元编程\",\"link\":\"/frontend/js/meta-coding.html\"},{\"text\":\"二进制\",\"link\":\"/frontend/js/binary.html\"},{\"text\":\"音视频\",\"link\":\"/frontend/js/audio.html\"},{\"text\":\"垃圾回收\",\"link\":\"/frontend/js/js-gc.html\"}]},{\"text\":\"Browser\",\"link\":\"/frontend/browser/base.html\"},{\"text\":\"Vue\",\"collapsed\":true,\"items\":[{\"text\":\"响应式原理\",\"link\":\"/frontend/vue/reactivity.html\"},{\"text\":\"计算属性与侦听函数\",\"link\":\"/frontend/vue/computed-watch.html\"},{\"text\":\"模板编译\",\"link\":\"/frontend/vue/template-compiler.html\"},{\"text\":\"组件创建与渲染\",\"link\":\"/frontend/vue/component-render.html\"},{\"text\":\"视图更新流程\",\"link\":\"/frontend/vue/update-process.html\"},{\"text\":\"插槽原理\",\"link\":\"/frontend/vue/slot.html\"},{\"text\":\"实现过渡\",\"link\":\"/frontend/vue/transition.html\"},{\"text\":\"vuex内幕\",\"link\":\"/frontend/vue/vuex.html\"},{\"text\":\"pinia原理\",\"link\":\"/frontend/vue/pinia.html\"},{\"text\":\"路由实现\",\"link\":\"/frontend/vue/router.html\"}]},{\"text\":\"Regexp\",\"link\":\"/frontend/regexp/base.html\"},{\"text\":\"Babel\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/babel/base.html\"},{\"text\":\"原理分析\",\"link\":\"/frontend/babel/babel-analysis.html\"},{\"text\":\"自定义插件\",\"link\":\"/frontend/babel/babel-plugin-guide.html\"}]},{\"text\":\"Webpack\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/webpack/base.html\"},{\"text\":\"自定义loader\",\"link\":\"/frontend/webpack/webpack-loader.html\"},{\"text\":\"自定义插件\",\"link\":\"/frontend/webpack/webpack-plugin.html\"},{\"text\":\"结合node使用\",\"link\":\"/frontend/webpack/webpack-node.html\"},{\"text\":\"原理分析\",\"link\":\"/frontend/webpack/webpack-analysis.html\"}]},{\"text\":\"Building Tool\",\"link\":\"/frontend/building-tool/base.html\"},{\"text\":\"Debug Skill\",\"collapsed\":true,\"link\":\"/frontend/debug-skill/base.html\",\"items\":[{\"text\":\"Chrome\",\"link\":\"/frontend/debug-skill/chrome.html\"},{\"text\":\"Vscode\",\"link\":\"/frontend/debug-skill/vscode.html\"},{\"text\":\"Fiddler\",\"link\":\"/frontend/debug-skill/fiddler.html\"},{\"text\":\"Charles\",\"link\":\"/frontend/debug-skill/charles.html\"},{\"text\":\"Wireshark\",\"link\":\"/frontend/debug-skill/wireshark.html\"},{\"text\":\"H5\",\"link\":\"/frontend/debug-skill/h5.html\"}]},{\"text\":\"NodeJS\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/node/base.html\"},{\"text\":\"web服务\",\"link\":\"/frontend/node/node-web.html\"},{\"text\":\"多进程与多线程\",\"link\":\"/frontend/node/node-process.html\"},{\"text\":\"常见框架\",\"link\":\"/frontend/node/node-framework.html\"},{\"text\":\"调试技巧\",\"link\":\"/frontend/node/node-debug.html\"},{\"text\":\"性能优化\",\"link\":\"/frontend/node/node-measure.html\"}]},{\"text\":\"Typescript\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/ts/base.html\"},{\"text\":\"2.配置文件\",\"link\":\"/frontend/ts/ts-configure.html\"}]},{\"text\":\"NestJS\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/nestjs/base.html\"},{\"text\":\"2.搭建web服务\",\"link\":\"/frontend/nestjs/mvc.html\"},{\"text\":\"3.swagger文档\",\"link\":\"/frontend/nestjs/swagger.html\"},{\"text\":\"4.实用手册\",\"link\":\"/frontend/nestjs/useful.html\"}]},{\"text\":\"Render Mode\",\"link\":\"/frontend/render-mode/base.html\"},{\"text\":\"Canvas\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/canvas/base.html\"},{\"text\":\"2.炫酷特效\",\"link\":\"/frontend/canvas/magic-effects.html\"}]},{\"text\":\"Project Integration\",\"collapsed\":true,\"items\":[{\"text\":\"1.项目集成\",\"link\":\"/frontend/project-integration/base.html\"},{\"text\":\"2.编辑器之争\",\"link\":\"/frontend/project-integration/choose-editor.html\"},{\"text\":\"3.框架选型\",\"link\":\"/frontend/project-integration/framework.html\"},{\"text\":\"4.打包工具\",\"link\":\"/frontend/project-integration/build-tool.html\"},{\"text\":\"5.语法规范\",\"link\":\"/frontend/project-integration/specification.html\"},{\"text\":\"6.风格指南\",\"link\":\"/frontend/project-integration/style.html\"},{\"text\":\"7.提交规范\",\"link\":\"/frontend/project-integration/git-commit.html\"},{\"text\":\"8.monorepo\",\"link\":\"/frontend/project-integration/monorepo.html\"},{\"text\":\"9.自动化测试\",\"link\":\"/frontend/project-integration/test-framework.html\"},{\"text\":\"10.发布规范\",\"link\":\"/frontend/project-integration/deploy-specification.html\"},{\"text\":\"11.调试技巧\",\"link\":\"/frontend/project-integration/debugger-skill.html\"},{\"text\":\"12.自动化\",\"link\":\"/frontend/project-integration/ci-pipeline.html\"}]},{\"text\":\"Computer Network\",\"collapsed\":true,\"link\":\"/frontend/computer-network/base.html\",\"items\":[{\"text\":\"TCP协议\",\"link\":\"/frontend/computer-network/tcp-protocol.html\"},{\"text\":\"HTTP协议\",\"link\":\"/frontend/computer-network/http-protocol.html\"},{\"text\":\"IP协议\",\"link\":\"/frontend/computer-network/ip-protocol.html\"},{\"text\":\"ARP协议\",\"link\":\"/frontend/computer-network/arp-protocol.html\"}]},{\"text\":\"Performance\",\"collapsed\":true,\"items\":[{\"text\":\"前言\",\"link\":\"/frontend/performance/base.html\"},{\"text\":\"大文件上传\",\"link\":\"/frontend/performance/chunk-upload.html\"},{\"text\":\"大文件下载\",\"link\":\"/frontend/performance/range-download.html\"},{\"text\":\"虚拟滚动一\",\"link\":\"/frontend/performance/virtual-scroll-1.html\"},{\"text\":\"虚拟滚动二\",\"link\":\"/frontend/performance/virtual-scroll-2.html\"},{\"text\":\"网络优化\",\"link\":\"/frontend/performance/network-perf.html\"},{\"text\":\"加载优化\",\"link\":\"/frontend/performance/load-perf.html\"},{\"text\":\"缓存优化\",\"link\":\"/frontend/performance/cache-perf.html\"},{\"text\":\"安全优化\",\"link\":\"/frontend/performance/secure-perf.html\"},{\"text\":\"SEO优化\",\"link\":\"/frontend/performance/seo.html\"},{\"text\":\"Performance工具\",\"link\":\"/frontend/performance/performance.html\"},{\"text\":\"web评分指标\",\"link\":\"/frontend/performance/web-score.html\"},{\"text\":\"node评分指标\",\"link\":\"/frontend/performance/node-score.html\"}]},{\"text\":\"Nginx\",\"link\":\"/frontend/nginx/base.html\"},{\"text\":\"Design Pattern\",\"link\":\"/frontend/pattern/base.html\"},{\"text\":\"Monitor\",\"link\":\"/frontend/monitor/base.html\"},{\"text\":\"Micro Frontend\",\"link\":\"/frontend/micro-frontend/base.html\"},{\"text\":\"Webassembly\",\"link\":\"/frontend/wasm/base.html\"},{\"text\":\"Hybrid App\",\"link\":\"/frontend/hybrid-app/base.html\"},{\"text\":\"Flutter\",\"link\":\"/frontend/flutter/base.html\"}]}],\"/fullstack/\":[{\"text\":\"Docker\",\"items\":[{\"items\":[{\"text\":\"Docker安装与配置\",\"link\":\"/fullstack/docker/install-configure.html\"},{\"text\":\"Docker基础教程\",\"link\":\"/fullstack/docker/base-tutorial.html\"},{\"text\":\"Docker数据卷与持久化\",\"link\":\"/fullstack/docker/volume-store.html\"},{\"text\":\"Docker网络原理\",\"link\":\"/fullstack/docker/network.html\"},{\"text\":\"使用Dockerfile构建镜像\",\"link\":\"/fullstack/docker/dockerfile.html\"},{\"text\":\"使用DockerCompose部署服务\",\"link\":\"/fullstack/docker/docker-compose.html\"},{\"text\":\"使用Docker搭建npm仓库\",\"link\":\"/fullstack/docker/npm-repository.html\"},{\"text\":\"搭建docker私有仓库\",\"link\":\"/fullstack/docker/docker-repository.html\"}]}]},{\"text\":\"Gitlab\",\"items\":[{\"items\":[{\"text\":\"安装与配置\",\"link\":\"/fullstack/gitlab/install-configure.html\"},{\"text\":\"Gitlab Runner安装与配置\",\"link\":\"/fullstack/gitlab/gitlab-runner-install-configure.html\"},{\"text\":\"Gitlab流水线配置\",\"link\":\"/fullstack/gitlab/gitlab-pipeline.html\"},{\"text\":\"Gitlab搭建npm仓库\",\"link\":\"/fullstack/gitlab/npm-repository.html\"}]}]},{\"text\":\"Kubernetes\",\"items\":[{\"items\":[{\"text\":\"初识kubernetes\",\"link\":\"/fullstack/k8s/base.html\"},{\"text\":\"搭建k8s集群\",\"link\":\"/fullstack/k8s/install.html\"}]}]}],\"/article/\":[{\"text\":\"2022\",\"items\":[{\"items\":[{\"text\":\"emoji markup\",\"link\":\"/article/2022/emoji-markup.html\"}]}]},{\"text\":\"2021\",\"items\":[{\"items\":[{\"text\":\"PWA渐进式应用\",\"link\":\"/article/2021/pwa-app.html\"},{\"text\":\"前端性能测试工具\",\"link\":\"/article/2021/performance-tools.html\"},{\"text\":\"Typescript装饰器指南\",\"link\":\"/article/2021/ts-decorator.html\"},{\"text\":\"手写vue图片懒加载插件\",\"link\":\"/article/2021/vue-img-lazyload.html\"},{\"text\":\"谈谈vue内部运行机制\",\"link\":\"/article/2021/vue-core-process.html\"},{\"text\":\"JS中的设计模式\",\"link\":\"/article/2021/js-pattern.html\"},{\"text\":\"flex布局\",\"link\":\"/article/2021/flex-layout.html\"}]}]},{\"text\":\"2020\",\"items\":[{\"items\":[{\"text\":\"关于DOMParser、XMLSerializer、createTreeWalker使用\",\"link\":\"/article/2020/domparser-xml.html\"},{\"text\":\"vscode快捷键\",\"link\":\"/article/2020/vscode-shortcut.html\"},{\"text\":\"优化改善网页的加载及性能\",\"link\":\"/article/2020/optimize-web-server.html\"},{\"text\":\"深入浅出RegExp\",\"link\":\"/article/2020/regexp-guide.html\"},{\"text\":\"从零配置webpack工程\",\"link\":\"/article/2020/webpack-guide.html\"},{\"text\":\"web缓存策略\",\"link\":\"/article/2020/web-cache.html\"}]}]},{\"text\":\"2019\",\"items\":[{\"items\":[{\"text\":\"nvm使用技巧\",\"link\":\"/article/2019/nvm-guide.html\"},{\"text\":\"MySQL从入门到放弃\",\"link\":\"/article/2019/mysql-guide.html\"},{\"text\":\"7天撸完ktv点歌系统\",\"link\":\"/article/2019/ktv-system.html\"},{\"text\":\"css的10中居中方式\",\"link\":\"/article/2019/css-center.html\"},{\"text\":\"Promise使用与原理\",\"link\":\"/article/2019/promise.html\"},{\"text\":\"JS隐式转换\",\"link\":\"/article/2019/js-type-transfer.html\"},{\"text\":\"什么是BFC\",\"link\":\"/article/2019/what-bfc.html\"},{\"text\":\"JS深浅拷贝\",\"link\":\"/article/2019/js-copy.html\"},{\"text\":\"bind、call、apply使用技巧\",\"link\":\"/article/2019/bind-call-apply.html\"}]}]}],\"/talk/\":[{\"items\":[{\"items\":[{\"text\":\"我也赶上了裁员\",\"link\":\"/talk/2023/lose-qoo-job.html\"},{\"text\":\"我爸脚受伤了\",\"link\":\"/talk/2023/dad-foot-injured.html\"},{\"text\":\"二🐑了\",\"link\":\"/talk/2023/second-covid.html\"}]}]}]},\"lastUpdated\":{\"text\":\"最近更新\",\"formatOptions\":{\"dateStyle\":\"medium\"}},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2018-2024 HengShuai\"},\"search\":{\"options\":{\"detailedView\":true,\"miniSearch\":{\"searchOptions\":{\"fields\":[\"title\",\"text\"]}}},\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>