<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx使用手册 | hengshuai's blog</title>
    <meta name="description" content="Nginx是一个高性能、高可靠性、低内存占用和高并发性的HTTP和反向代理服务器，非常适合用于高负载的Web 站点、应用服务器和API网关等场景。通过本文来学习nginx强大功能如：静态服务器、反向代理、缓存压缩、HTTPS、跨域等等">
    <meta name="generator" content="VitePress v1.0.0-rc.40">
    <link rel="preload stylesheet" href="/assets/style.NwX665RZ.css" as="style">
    
    <script type="module" src="/assets/app.0fd12bH9.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.SV1ROkXV.js">
    <link rel="modulepreload" href="/assets/chunks/theme.l3RjJB8k.js">
    <link rel="modulepreload" href="/assets/frontend_nginx_base.md.zoU8TEMt.lean.js">
    <meta name="renderer" content="webkit">
    <meta name="author" content="ihengshuai@foxmail.com">
    <meta rel="profile" href="http://gmpg.org/xfn/11">
    <meta name="referrer" content="same-origin">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="theme-color" content="#646cff">
    <meta name="google-site-verification" content="T4xYOJVbUxeU5aZRUROdmEf_NWCjnRDwfXnzKYUVcFM">
    <meta name="baidu-site-verification" content="code-IpD4H7zKv4">
    <link rel="apple-touch-icon" href="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/192.png">
    <meta name="apple-mobile-web-app-title" content="hengshuai&#39;s blog">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#747bff">
    <meta rel="apple-touch-startup-image" href="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/192.png">
    <link rel="manifest" href="/manifest.json">
    <script id="ENV_VARIABLES">window.__ENV_VARIABLES__={ENV_PROD:!0};</script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V5736Z4DWT"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-V5736Z4DWT");</script>
    <script>var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?f6eda4089bba0c6f46ad6e00658a80f3";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta name="keywords" content="nginx教程,nginx安装,nginx命令,nginx反向代理,nginx跨域,nginx缓存">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Nginx使用手册 | hengshuai&#39;s blog">
    <meta property="og:url" content="https://blog.usword.cn/frontend/nginx/base.html">
    <meta property="og:site_name" content="hengshuai&#39;s blog">
    <meta property="og:description" content="Nginx是一个高性能、高可靠性、低内存占用和高并发性的HTTP和反向代理服务器，非常适合用于高负载的Web 站点、应用服务器和API网关等场景。通过本文来学习nginx强大功能如：静态服务器、反向代理、缓存压缩、HTTPS、跨域等等">
    <meta property="og:image" content="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-nginx.png">
    <meta name="twitter:url" value="https://blog.usword.cn/frontend/nginx/base.html">
    <meta name="twitter:title" value="Nginx使用手册 | hengshuai&#39;s blog">
    <meta name="twitter:domain" value="https://blog.usword.cn">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" value="Nginx是一个高性能、高可靠性、低内存占用和高并发性的HTTP和反向代理服务器，非常适合用于高负载的Web 站点、应用服务器和API网关等场景。通过本文来学习nginx强大功能如：静态服务器、反向代理、缓存压缩、HTTPS、跨域等等">
    <meta name="twitter:image" content="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-nginx.png">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-e69ff593><!--[--><!--]--><!--[--><span tabindex="-1" data-v-056fc64b></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-056fc64b> Skip to content </a><!--]--><!----><header class="VPNav" data-v-e69ff593 data-v-50ee880a><div class="VPNavBar has-sidebar" data-v-50ee880a data-v-575c0058><div class="wrapper" data-v-575c0058><div class="container" data-v-575c0058><div class="title" data-v-575c0058><div class="VPNavBarTitle has-sidebar" data-v-575c0058 data-v-5a8562d3><a class="title" href="/" data-v-5a8562d3><!--[--><!--]--><!----><!--[-->Hengshuai&#39;s blog<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-575c0058><div class="content-body" data-v-575c0058><!--[--><!--]--><div class="VPNavBarSearch search" data-v-575c0058><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-575c0058 data-v-3e017cdf><span id="main-nav-aria-label" class="visually-hidden" data-v-3e017cdf>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/frontend/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Frontend</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/fullstack/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Fullstack</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/article/base.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Article</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://case.usword.cn" target="_blank" rel="noreferrer" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Case</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/me.html" tabindex="0" data-v-3e017cdf data-v-2b0d6775><!--[--><span data-v-2b0d6775>Me</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-575c0058 data-v-3bd0ddce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-3bd0ddce data-v-62e667eb data-v-0438efbe><span class="check" data-v-0438efbe><span class="icon" data-v-0438efbe><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-62e667eb><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-62e667eb><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-575c0058 data-v-47b9b291 data-v-f534a663><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ihengshuai" aria-label="github" target="_blank" rel="noopener" data-v-f534a663 data-v-70b9b240><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-575c0058 data-v-edb1db61 data-v-41b0fac7><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-41b0fac7><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-41b0fac7><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-41b0fac7><div class="VPMenu" data-v-41b0fac7 data-v-32c6b1d0><!----><!--[--><!--[--><!----><div class="group" data-v-edb1db61><div class="item appearance" data-v-edb1db61><p class="label" data-v-edb1db61>Appearance</p><div class="appearance-action" data-v-edb1db61><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-edb1db61 data-v-62e667eb data-v-0438efbe><span class="check" data-v-0438efbe><span class="icon" data-v-0438efbe><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-62e667eb><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-62e667eb><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-edb1db61><div class="item social-links" data-v-edb1db61><div class="VPSocialLinks social-links-list" data-v-edb1db61 data-v-f534a663><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ihengshuai" aria-label="github" target="_blank" rel="noopener" data-v-f534a663 data-v-70b9b240><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-575c0058 data-v-279e6295><span class="container" data-v-279e6295><span class="top" data-v-279e6295></span><span class="middle" data-v-279e6295></span><span class="bottom" data-v-279e6295></span></span></button></div></div></div></div><div class="divider" data-v-575c0058><div class="divider-line" data-v-575c0058></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-e69ff593 data-v-2ebb1e0d><div class="container" data-v-2ebb1e0d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2ebb1e0d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2ebb1e0d><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2ebb1e0d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2ebb1e0d data-v-ba90ba94><button data-v-ba90ba94>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-e69ff593 data-v-983e8791><div class="curtain" data-v-983e8791></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-983e8791><span class="visually-hidden" id="sidebar-aria-label" data-v-983e8791> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-983e8791><section class="VPSidebarItem level-0 has-active" data-v-983e8791 data-v-3445ab86><!----><div class="items" data-v-3445ab86><!--[--><section class="VPSidebarItem level-1 collapsible is-link" data-v-3445ab86 data-v-3445ab86><div class="item" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/base.html" data-v-3445ab86><!--[--><h3 class="text" data-v-3445ab86>Javascript</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/proto-inherit.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>原型、原型链与继承</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/scope-closure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>作用域(链)、执行上下文及闭包</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/implicit-conversion.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>类型隐式转换</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/eventloop.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>事件循环(EventLoop)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/async.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>异步编程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/meta-coding.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>元编程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/binary.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>二进制</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/audio.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>音视频</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/js/js-gc.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>垃圾回收</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/browser/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Browser</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>Vue</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/reactivity.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>响应式原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/computed-watch.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>计算属性与侦听函数</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/template-compiler.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>模板编译</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/component-render.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>组件创建与渲染</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/update-process.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>视图更新流程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/slot.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>插槽原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/transition.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>实现过渡</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/vuex.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>vuex内幕</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/pinia.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>pinia原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/vue/router.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>路由实现</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/regexp/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Regexp</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>Babel</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/babel/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>基本使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/babel/babel-analysis.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>原理分析</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/babel/babel-plugin-guide.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>自定义插件</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>Webpack</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/webpack/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>基本使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/webpack/webpack-loader.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>自定义loader</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/webpack/webpack-plugin.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>自定义插件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/webpack/webpack-node.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>结合node使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/webpack/webpack-analysis.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>原理分析</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/building-tool/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Building Tool</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-3445ab86 data-v-3445ab86><div class="item" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/debug-skill/base.html" data-v-3445ab86><!--[--><h3 class="text" data-v-3445ab86>Debug Skill</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/debug-skill/chrome.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Chrome</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/debug-skill/vscode.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Vscode</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/debug-skill/fiddler.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Fiddler</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/debug-skill/charles.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Charles</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/debug-skill/wireshark.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Wireshark</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/debug-skill/h5.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>H5</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>NodeJS</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/node/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>基本使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/node/node-web.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>web服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/node/node-process.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>多进程与多线程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/node/node-framework.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>常见框架</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/node/node-debug.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>调试技巧</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/node/node-measure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>性能优化</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>Typescript</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/ts/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>1.基本使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/ts/ts-configure.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>2.配置文件</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>NestJS</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/nestjs/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>1.基本使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/nestjs/mvc.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>2.搭建web服务</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/nestjs/swagger.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>3.swagger文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/nestjs/useful.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>4.实用手册</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/render-mode/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Render Mode</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>Canvas</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/canvas/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>1.基本使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/canvas/magic-effects.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>2.炫酷特效</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>Project Integration</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>1.项目集成</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/choose-editor.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>2.编辑器之争</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/framework.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>3.框架选型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/build-tool.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>4.打包工具</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/specification.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>5.语法规范</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/style.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>6.风格指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/git-commit.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>7.提交规范</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/monorepo.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>8.monorepo</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/test-framework.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>9.自动化测试</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/deploy-specification.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>10.发布规范</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/debugger-skill.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>11.调试技巧</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/project-integration/ci-pipeline.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>12.自动化</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed is-link" data-v-3445ab86 data-v-3445ab86><div class="item" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/computer-network/base.html" data-v-3445ab86><!--[--><h3 class="text" data-v-3445ab86>Computer Network</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/computer-network/tcp-protocol.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>TCP协议</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/computer-network/http-protocol.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>HTTP协议</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/computer-network/ip-protocol.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>IP协议</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/computer-network/arp-protocol.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>ARP协议</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-3445ab86 data-v-3445ab86><div class="item" role="button" tabindex="0" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><h3 class="text" data-v-3445ab86>Performance</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-3445ab86><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-3445ab86><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-3445ab86><!--[--><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>前言</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/chunk-upload.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>大文件上传</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/range-download.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>大文件下载</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/virtual-scroll-1.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>虚拟滚动一</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/virtual-scroll-2.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>虚拟滚动二</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/network-perf.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>网络优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/load-perf.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>加载优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/cache-perf.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>缓存优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/secure-perf.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>安全优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/seo.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>SEO优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/performance.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Performance工具</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/web-score.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>web评分指标</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/performance/node-score.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>node评分指标</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/nginx/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Nginx</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/pattern/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Design Pattern</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/monitor/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Monitor</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/micro-frontend/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Micro Frontend</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/wasm/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Webassembly</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/hybrid-app/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Hybrid App</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-3445ab86 data-v-3445ab86><div class="item" data-v-3445ab86><div class="indicator" data-v-3445ab86></div><a class="VPLink link link" href="/frontend/flutter/base.html" data-v-3445ab86><!--[--><p class="text" data-v-3445ab86>Flutter</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-e69ff593 data-v-5a285343><div class="VPDoc has-sidebar has-aside" data-v-5a285343 data-v-fb80de84><!--[--><!--]--><div class="container" data-v-fb80de84><div class="aside" data-v-fb80de84><div class="aside-curtain" data-v-fb80de84></div><div class="aside-container" data-v-fb80de84><div class="aside-content" data-v-fb80de84><div class="VPDocAside" data-v-fb80de84 data-v-bb0b59e9><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-bb0b59e9 data-v-ea307b6d><div class="content" data-v-ea307b6d><div class="outline-marker" data-v-ea307b6d></div><div class="outline-title" role="heading" aria-level="2" data-v-ea307b6d>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-ea307b6d><span class="visually-hidden" id="doc-outline-aria-label" data-v-ea307b6d> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-ea307b6d data-v-20500810><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-bb0b59e9></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-fb80de84><div class="content-container" data-v-fb80de84><!--[--><!--]--><main class="main" data-v-fb80de84><div style="position:relative;" class="vp-doc _frontend_nginx_base external-link-icon-enabled" data-v-fb80de84><div><h1 id="nginx使用手册" tabindex="-1">Nginx使用手册 <a class="header-anchor" href="#nginx使用手册" aria-label="Permalink to &quot;Nginx使用手册&quot;">​</a></h1><p>Nginx（发音为 &quot;engine-x&quot;）是一个高性能、开源的HTTP和反向代理服务器，也可以作为电子邮件（IMAP/POP3）代理服务器、以及通用的TCP/UDP代理服务器。它由俄罗斯的程序员Igor Sysoev创建于2002年，其目的是解决C10K问题（即可以同时处理10000个并发连接）。它采用异步非阻塞的事件驱动模型，可以处理成千上万个并发连接，同时使用少量的CPU和内存资源。</p><p>本篇带着大家一起领略nginx的常见使用技巧</p><h2 id="优势" tabindex="-1">优势 <a class="header-anchor" href="#优势" aria-label="Permalink to &quot;优势&quot;">​</a></h2><ol><li><code>高性能</code>：Nginx具有高并发、低内存消耗以及高稳定性的特点，可以很好地应对大流量的访问</li><li><code>高可扩展性</code>：Nginx支持模块化扩展，可以灵活增加新功能。用户可以根据自己的需求选择相应的模块，从而实现定制化的功能</li><li><code>高可靠性</code>：Nginx具有故障自动恢复、热部署等功能，能够保证服务器在遇到问题时仍能继续提供服务</li><li><code>反向代理与负载均衡</code>：Nginx可以作为反向代理服务器，提供负载均衡功能。通过负载均衡，Nginx可以将请求分发到多个后端服务器，从而实现高可用和高性能的服务</li><li><code>静态文件处理</code>：Nginx在处理静态文件方面（如HTML、CSS、JS、图片等）具有非常高的性能，可以作为Web服务器或者静态资源服务器使用</li><li><code>灵活的配置</code>：Nginx的配置文件结构清晰，易于理解和修改。用户可以根据自己的需求对Nginx进行灵活的配置</li></ol><h2 id="功能" tabindex="-1">功能 <a class="header-anchor" href="#功能" aria-label="Permalink to &quot;功能&quot;">​</a></h2><ul><li>HTTP服务器：作为Web服务器，可以处理HTTP请求，提供网页浏览服务</li><li>反向代理：将客户端的请求转发到其他服务器，并将服务器的响应返回给客户端。这样可以隐藏服务器的真实IP地址，提高安全性</li><li>负载均衡：在多个服务器之间分配客户端的请求，实现请求的负载均衡</li><li>缓存和压缩：Nginx支持内容缓存和压缩，可以加快页面加载速度，降低服务器负载</li><li>虚拟主机：通过配置虚拟主机，可以使用一个Nginx服务器处理多个域名的请求</li><li>安全性：支持SSL/TLS加密，可以对传输的数据进行加密，保证数据的安全性</li><li>电子邮件代理：作为电子邮件服务器，可以处理IMAP/POP3协议，提供邮件收发服务</li></ul><h2 id="安装nginx" tabindex="-1">安装nginx <a class="header-anchor" href="#安装nginx" aria-label="Permalink to &quot;安装nginx&quot;">​</a></h2><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> install nginx -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>本人使用的是ARM架构的centos进行安装的，当执行以下命令时提示没有可用的安装包，如果你和我一样，可以访问<a href="http://nginx.org/en/linux_packages.html#RHEL" target="_blank" rel="noreferrer">官方下载</a>页面进行nginx的repo配置：</p><p>下载准备：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> install yum-utils</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>设置YUM存储库，创建名为<code>/etc/yum.repos.d/nginx.repo</code>的文件，并复制以下内容：</p><div class="language-toml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">nginx-stable</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">nginx stable repo</span></span>
<span class="line"><span style="color:#BABED8;">baseurl</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">http://nginx.org/packages/centos/$releasever/$basearch/</span></span>
<span class="line"><span style="color:#BABED8;">gpgcheck</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">enabled</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">gpgkey</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">https://nginx.org/keys/nginx_signing.key</span></span>
<span class="line"><span style="color:#BABED8;">module_hotfixes</span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">nginx-mainline</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">nginx mainline repo</span></span>
<span class="line"><span style="color:#BABED8;">baseurl</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">http://nginx.org/packages/mainline/centos/$releasever/$basearch/</span></span>
<span class="line"><span style="color:#BABED8;">gpgcheck</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">enabled</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#BABED8;">gpgkey</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">https://nginx.org/keys/nginx_signing.key</span></span>
<span class="line"><span style="color:#BABED8;">module_hotfixes</span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;">true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>以上配置好了后再次进行nginx的下载应该就可以了</p><p>下载好后查看nginx版本：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -v</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#C3E88D;"> version: nginx/1.22.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置开机启动：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> systemctl enable nginx --now</span></span>
<span class="line"><span style="color:#FFCB6B;">Created</span><span style="color:#C3E88D;"> symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h2><ol><li>查看nginx版本<div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -v</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#C3E88D;"> version: nginx/1.22.1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 详细内容(版本号、编译器版本、安装路径、日志路径、PID文件路径、HTTP模块、SSL模块、GZIP模块等等)</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -V</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#C3E88D;"> version: nginx/1.22.1</span></span>
<span class="line"><span style="color:#FFCB6B;">built</span><span style="color:#C3E88D;"> by gcc </span><span style="color:#F78C6C;">4.8</span><span style="color:#C3E88D;">.5 </span><span style="color:#F78C6C;">20150623</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">Red</span><span style="color:#C3E88D;"> Hat </span><span style="color:#F78C6C;">4.8</span><span style="color:#C3E88D;">.5-44</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> (GCC)</span></span>
<span class="line"><span style="color:#FFCB6B;">built</span><span style="color:#C3E88D;"> with OpenSSL </span><span style="color:#F78C6C;">1.0</span><span style="color:#C3E88D;">.2k-fips  </span><span style="color:#F78C6C;">26</span><span style="color:#C3E88D;"> Jan </span><span style="color:#F78C6C;">2017</span></span>
<span class="line"><span style="color:#FFCB6B;">TLS</span><span style="color:#C3E88D;"> SNI support enabled</span></span>
<span class="line"><span style="color:#FFCB6B;">configure</span><span style="color:#C3E88D;"> arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -fPIC</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> --with-ld-opt=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-Wl,-z,relro -Wl,-z,now -pie</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li><li>测试 Nginx 配置文件的语法和逻辑是否正确<div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -t</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx:</span><span style="color:#C3E88D;"> the configuration file /etc/nginx/nginx.conf syntax is ok</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx:</span><span style="color:#C3E88D;"> configuration file /etc/nginx/nginx.conf test is successful</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 检测并输出配置文件，快速诊断配置文件问题</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -T</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li>启动nginx与重启<div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -s reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li>关闭nginx<div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 立即停止</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -s stop</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 处理完请求后停止</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -s quit</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol><h2 id="配置文件" tabindex="-1">配置文件 <a class="header-anchor" href="#配置文件" aria-label="Permalink to &quot;配置文件&quot;">​</a></h2><p>可以使用<code>nginx -t</code>知道nginx的配置文件路径具体位置，打开配置文件如下：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># /etc/nginx/nginx.conf</span></span>
<span class="line"><span style="color:#89DDFF;">user </span><span style="color:#BABED8;"> nginx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 数量大，并发高，会受到硬件的配置影响</span></span>
<span class="line"><span style="color:#89DDFF;">worker_processes </span><span style="color:#BABED8;"> auto</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> # number/auto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">error_log </span><span style="color:#BABED8;"> /var/log/nginx/error.log</span><span style="color:#89DDFF;"> notice;</span><span style="color:#676E95;font-style:italic;"> # notice、info</span></span>
<span class="line"><span style="color:#89DDFF;">pid </span><span style="color:#BABED8;">       /var/run/nginx.pid</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">events</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">    worker_connections </span><span style="color:#F78C6C;"> 1024</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">http</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 定义文件类型映射表，返回浏览器会在头部加上对应的文件类型</span></span>
<span class="line"><span style="color:#89DDFF;">    include </span><span style="color:#BABED8;">      /etc/nginx/mime.types</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # mime中无对应类型，默认流类型</span></span>
<span class="line"><span style="color:#89DDFF;">    default_type </span><span style="color:#BABED8;"> application/octet-stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # 日志格式</span></span>
<span class="line"><span style="color:#89DDFF;">    log_format  main</span><span style="color:#C3E88D;">  &#39;</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">remote_addr</span><span style="color:#C3E88D;"> - </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">remote_user</span><span style="color:#C3E88D;"> [</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">time_local</span><span style="color:#C3E88D;">] &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">request</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#C3E88D;">                      &#39;</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">status</span><span style="color:#89DDFF;"> $</span><span style="color:#BABED8;">body_bytes_sent</span><span style="color:#C3E88D;"> &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_referer</span><span style="color:#C3E88D;">&quot; &#39;</span></span>
<span class="line"><span style="color:#C3E88D;">                      &#39;&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_user_agent</span><span style="color:#C3E88D;">&quot; &quot;</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_x_forwarded_for</span><span style="color:#C3E88D;">&quot;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # 访问日志</span></span>
<span class="line"><span style="color:#89DDFF;">    access_log </span><span style="color:#BABED8;"> /var/log/nginx/access.log </span><span style="color:#89DDFF;"> main;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # sendfile 是一种高效的文件传输方式，它可以将文件数据直接从磁盘读取到内核缓冲区，再通过网络传输到客户端，避免了将文件数据从内核缓冲区复制到用户空间的开销，提高了文件传输的效率。</span></span>
<span class="line"><span style="color:#89DDFF;">    sendfile </span><span style="color:#89DDFF;">       on;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    #tcp_nopush     on;</span></span>
<span class="line"><span style="color:#89DDFF;">    keepalive_timeout </span><span style="color:#F78C6C;"> 65</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # gzip压缩</span></span>
<span class="line"><span style="color:#89DDFF;">    gzip  on;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">	server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">	    listen </span><span style="color:#F78C6C;">      80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	    server_name </span><span style="color:#BABED8;"> localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">	    location</span><span style="color:#FFCB6B;"> / </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	        root </span><span style="color:#BABED8;">  /usr/share/nginx/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	        index </span><span style="color:#BABED8;"> index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	    # redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="color:#89DDFF;">	    error_page </span><span style="color:#F78C6C;"> 404</span><span style="color:#BABED8;">              /404.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">	    location</span><span style="color:#89DDFF;"> =</span><span style="color:#C3E88D;"> /404.html </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	        root </span><span style="color:#BABED8;">  /usr/share/nginx/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	    }</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#89DDFF;">    include </span><span style="color:#BABED8;">/etc/nginx/conf.d/*.conf</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>由以上的默认配置可以看出nginx配置是由以下几部分组成的：</p><ol><li>main块：主要包含全局配置参数，服务器的用户（组）、worker 进程数、进程 ID 文件路径、日志存放路径等</li><li>events块：用于配置事件模块的参数，例如 worker 进程的连接数、事件模型等</li><li>http块：用于配置 HTTP 协议相关的参数，例如服务器监听的端口、虚拟主机、代理、缓存等</li><li>server块：属于http块中的模块，用于配置一个虚拟主机的参数，例如监听的端口、域名、SSL 证书、代理、缓存等，http块中可以包含多个server块(常用server来配置虚拟主机)</li><li>location块：属于server块中的模块，用于配置一个 URI 的参数，例如 URI 匹配规则、代理、缓存等(匹配主机路径)</li></ol><p>Nginx 配置文件采用了一种层次结构的格式，每个块都以花括号 {} 包含，其中的参数和指令以分号 ; 结尾。通过修改 Nginx 配置文件，可以自定义 Nginx 服务器的行为和参数，以适应不同的需求和场景</p><p>在默认配置文件结尾会将<code>conf.d</code>路径下的所有<code>*.conf</code>结尾的配置文(server级别)件引入到主配置文件，这样可以根据不同的server模块进行划分配置，便于管理和维护：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">include </span><span style="color:#BABED8;">/etc/nginx/conf.d/*.conf</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="server" tabindex="-1">server <a class="header-anchor" href="#server" aria-label="Permalink to &quot;server&quot;">​</a></h3><p>server 块用于配置一个虚拟主机的参数，例如监听的端口、域名、SSL 证书、代理、缓存等。每个 server 块都必须包含一个 listen 指令，用于指定虚拟主机监听的端口和 IP 地址</p><p>示例：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">    listen </span><span style="color:#BABED8;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    server_name </span><span style="color:#BABED8;">example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">    location</span><span style="color:#FFCB6B;"> / </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    	root </span><span style="color:#BABED8;">/usr/share/nginx/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    	index </span><span style="color:#BABED8;">index.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>以上的server监听80端口并匹配域名<code>exemple.com</code>，当访问<code>/</code>时会访问<code>/usr/share/nginx/html/index.html</code>文件。</p><p><code>listen</code>表示当前虚拟主机监听的端口，可以写多个，如监听https端口可以写<code>listen 443 ssl;</code></p><p><code>server_name</code>表示匹配的域名，可以写正则来匹配，如<code>*.example.com</code>表示exempe.com的所有二级域名都可以匹配到</p><p>除了基本参数外，server 块还可以配置其他的参数，如：sl_certificate 和 ssl_certificate_key用于配置 SSL 证书和私钥的路径等等</p><h3 id="location" tabindex="-1">location <a class="header-anchor" href="#location" aria-label="Permalink to &quot;location&quot;">​</a></h3><p>location用来匹配server中的访问路径(path)，如访问<code>https://blog.usworn.cn/me</code>可以匹配path<code>/me</code>。location支持全匹配和正则表达式：</p><ul><li>全匹配：= /xxx</li><li>正则匹配： <ul><li><code>~</code>：区分大小写</li><li><code>~*</code>：不区分大小写</li><li><code>^~</code>：用于不含正则表达式uri前，nginx找到和请求uri匹配度最高的 location 后，立即用此location，不再用location 中的正则匹配</li></ul></li></ul><p>例子：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 全匹配 /me</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#89DDFF;"> =</span><span style="color:#C3E88D;"> /me </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		root </span><span style="color:#BABED8;">/usr/share/nginx/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		index </span><span style="color:#BABED8;">index.html index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 匹配 以/admin 开头的path</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#89DDFF;"> ~</span><span style="color:#C3E88D;"> ^/admin </span><span style="color:#BABED8;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 同上，这里不区分大小写相当于 /admin</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#89DDFF;"> ~*</span><span style="color:#C3E88D;"> ^/ADMIN </span><span style="color:#BABED8;">{}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="静态服务" tabindex="-1">静态服务 <a class="header-anchor" href="#静态服务" aria-label="Permalink to &quot;静态服务&quot;">​</a></h2><p>作为静态服务使用时，可以提供高效的静态文件传输和缓存服务，从而加速网站的加载速度，提升用户体验</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 指定静态文件的根目录，nginx 会根据 uri 在 根目录下匹配路径</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#89DDFF;"> ~</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">		root </span><span style="color:#BABED8;">/usr/share/nginx/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		index </span><span style="color:#BABED8;">index.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 路径映射，可以对外隐藏真实的路径</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> /images/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		alias </span><span style="color:#BABED8;">/documents/icons/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>假如访问index.html，内容如下：</p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#C792EA;"> html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">	&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">Welcome to nginx!</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">	&lt;</span><span style="color:#F07178;">img</span><span style="color:#C792EA;"> src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/images/icon-docker.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> &gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>访问页面时会请求请求图片，在nginx中替换掉图片地址为<code>/documents/icons/icon-docker.png</code>，这对外部来说隐藏了内部的真实地址</p><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230405210953779.png" alt=""></p><p>也可以作为资源目录列表：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 资源列表</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> / </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		autoindex </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">  # 开启资源列表目录</span></span>
<span class="line"><span style="color:#89DDFF;">		autoindex_exact_size </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">  # 显示文件的确切大小，单位是byte；off显示文件大概大小，单位KB、MB、GB</span></span>
<span class="line"><span style="color:#89DDFF;">		autoindex_localtime </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">  # off(默认)时显示的文件时间为GMT时间；on显示的文件时间为服务器时间</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230406091239342.png" alt=""></p><h2 id="访问控制" tabindex="-1">访问控制 <a class="header-anchor" href="#访问控制" aria-label="Permalink to &quot;访问控制&quot;">​</a></h2><ol><li><p>使用 deny 指令来进行访问控制，该指令可以限制某些 IP 地址或 IP 地址段的访问</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 禁止指定IP</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> /foo </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		deny </span><span style="color:#BABED8;">192.168.10.10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 禁止IP 地址段</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> /bar </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		deny </span><span style="color:#BABED8;">192.168.1.0/24</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 允许指定IP</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> / </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		deny </span><span style="color:#BABED8;">all</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		allow </span><span style="color:#BABED8;">192.168.1.10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230406074728011.png" alt=""></p></li><li><p>设置用户名和密码鉴权</p><p>安装<code>httpd-tools</code>，用来生成账户名和密码</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> install httpd-tools -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>设置用户名和密码：这里将会生成新的文件<code>/etc/nginx/.htpasswd</code>，用户名为ihengshuai，密码提示你输入</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> htpasswd -c /etc/nginx/.htpasswd ihengshuai</span></span>
<span class="line"><span style="color:#FFCB6B;">New</span><span style="color:#C3E88D;"> password:</span></span>
<span class="line"><span style="color:#FFCB6B;">Re-type</span><span style="color:#C3E88D;"> new password:</span></span>
<span class="line"><span style="color:#FFCB6B;">Adding</span><span style="color:#C3E88D;"> password for user ihengshuai</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>查看用户名和密码：默认生成的密码会被加密，密码加密算法有好几种，你也可以使用明文密码，请参考<code>htpasswd -h</code>了解更多</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> cat /etc/nginx/.htpasswd</span></span>
<span class="line"><span style="color:#FFCB6B;">ihengshuai:$apr1$FvO5arNB$nsrzQ8e.4DX.c8JUSJJTE1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接下来进行nginx配置：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># vim /etc/nginx/default.conf</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	#...</span></span>
<span class="line"><span style="color:#89DDFF;">	auth_basic </span><span style="color:#C3E88D;">&quot;请输入用户名和密码&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	auth_basic_user_file </span><span style="color:#BABED8;">/etc/nginx/.htpasswd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230405213736586.png" alt=""></p></li></ol><h2 id="重定向" tabindex="-1">重定向 <a class="header-anchor" href="#重定向" aria-label="Permalink to &quot;重定向&quot;">​</a></h2><p>nginx中支持<code>rewrite</code>和<code>return</code>关键字进行重定向</p><h3 id="rewrite" tabindex="-1">rewrite <a class="header-anchor" href="#rewrite" aria-label="Permalink to &quot;rewrite&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">rewrite</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">regex</span><span style="color:#BABED8;">p</span><span style="color:#89DDFF;">&gt;</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">replacemen</span><span style="color:#BABED8;">t</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> [flag]</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>regexp：路径匹配，如匹配：^/admin</li><li>replacement：替代的内容，比如换成 <a href="https://blog.usword.cn" target="_blank" rel="noreferrer">https://blog.usword.cn</a></li><li>flag：标识符 <ul><li>last：匹配完后继续向下匹配 location</li><li>break：匹配完后，不再匹配后面的规则</li><li>redirect：302临时重定向，浏览器会显示新的URL</li><li>permanent：301永久重定向，浏览器会显示新的URL</li></ul></li></ul><p>例子：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> / </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		rewrite</span><span style="color:#C3E88D;"> ^(/frontend(.*))$</span><span style="color:#BABED8;"> https://blog.usword.cn</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">1 </span><span style="color:#F78C6C;">permanent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 不管是啥都重定向到另一个域名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# rewrite ^(.*)$ https://blog.usword.cn$1 redirect;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置状态码 418 的错误 路径</span></span>
<span class="line"><span style="color:#89DDFF;">		error_page </span><span style="color:#BABED8;">418 = @redirect_stop</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 重定向 次数超过 10次时 ，返回状态码 418</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		if</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">redirect_count &gt; 10) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		    return</span><span style="color:#F78C6C;"> 418</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">		}</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> @redirect_stop </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# do something</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>当访问路径中以<code>/frontend</code>开头时永久重定向到<code>http://blog.usword.cn</code>，并将路径拼接到后面(这里需要了解正则表达式使用)</p><p>如果重写规则不正确，可能会导致死循环或者无限重定向。为了避免这种情况，可以使用 <code>error_page</code>指令或者 <code>return</code> 指令设置重定向的最大次数或者超时时间</p><h3 id="return" tabindex="-1">return <a class="header-anchor" href="#return" aria-label="Permalink to &quot;return&quot;">​</a></h3><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#BABED8;">code</span><span style="color:#89DDFF;">&gt;</span><span style="color:#89DDFF;"> [</span><span style="color:#BABED8;">text</span><span style="color:#89DDFF;">];</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>code：一个 HTTP 响应码，用于指示服务器应该返回哪种类型的响应</li><li>text：可选的文本字符串，用于指定响应正文</li></ul><p>例子：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> /api </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		add_header </span><span style="color:#C3E88D;">&#39;Content-Type&#39;</span><span style="color:#C3E88D;"> &#39;application/json&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		return</span><span style="color:#F78C6C;"> 200</span><span style="color:#C3E88D;"> &#39;{&quot;code&quot;: 200, &quot;msg&quot;: &quot;ok&quot;}&#39;</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#89DDFF;"> ~*</span><span style="color:#C3E88D;"> ^(/frontend(.*))$ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		return</span><span style="color:#F78C6C;"> 302</span><span style="color:#BABED8;"> https://blog.usword.cn</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">1;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>以上当访问/api时设置状态码200并以json的形式返回数据，当匹配到<code>/frontend</code>开头的路径时重定向到<a href="https://blog.usword.cn" target="_blank" rel="noreferrer">https://blog.usword.cn</a> 并将path拼接到后面</p><h2 id="gzip压缩" tabindex="-1">GZIP压缩 <a class="header-anchor" href="#gzip压缩" aria-label="Permalink to &quot;GZIP压缩&quot;">​</a></h2><p>使用 gzip 模块对 HTTP 响应进行压缩。这可以显著减少传输数据的大小，从而提高网站的性能和响应速度。gzip压缩功能由<a href="https://nginx.org/en/docs/http/ngx_http_gzip_module.html" target="_blank" rel="noreferrer">ngx_http_gzip_module</a>和<a href="https://nginx.org/en/docs/http/ngx_http_gzip_static_module.html" target="_blank" rel="noreferrer">ngx_http_gzip_static_module</a>模块提供</p><p>开启gzip：可以用在http、server、location中</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">gzip </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>其他用法：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_types </span><span style="color:#BABED8;">text/html text/css application/javascript</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_static </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_proxied </span><span style="color:#BABED8;">expired no-cache auth</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_buffers </span><span style="color:#BABED8;">16 </span><span style="color:#F78C6C;">8k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_min_length </span><span style="color:#BABED8;">2k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_comp_level </span><span style="color:#BABED8;">4</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_http_version </span><span style="color:#BABED8;">1.0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_vary </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_disable </span><span style="color:#C3E88D;">&quot;MSIE [1-6]</span><span style="color:#BABED8;">\\</span><span style="color:#C3E88D;">.&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol><li><code>gzip_types</code>：要采用 gzip 压缩的 MIME 文件类型，其中 text/html 被系统强制启用；</li><li><code>gzip_static</code>：默认 off，该模块启用后，Nginx 首先检查是否存在请求静态文件的 gz 结尾的文件，如果有则直接返回该 .gz 文件内容；</li><li><code>gzip_proxied</code>：默认 off，nginx 做为反向代理时启用，用于设置启用或禁用从代理服务器上收到相应内容 gzip 压缩；</li><li><code>gzip_buffers</code>：获取多少内存用于缓存压缩结果，16 8k 表示以 8k*16 为单位获得</li><li><code>gzip_min_length</code>：允许压缩的页面最小字节数，页面字节数从 header 头中的 Content-Length 中进行获取。默认值是 0，不管页面多大都压缩。建议设置成大于 1k 的字节数，小于 1k 可能会越压越大</li><li><code>gzip_comp_level</code>：gzip 压缩比，压缩级别是 1-9，默认6，1 压缩级别最低，9 最高，级别越高压缩率越大，压缩时间越长，建议 4-6；</li><li><code>gzip_http_version</code>：默认 1.1，启用 gzip 所需的 HTTP 最低版本；</li><li><code>gzip_vary</code>：用于在响应消息头中添加 Vary：Accept-Encoding，使代理服务器根据请求头中的 Accept-Encoding 识别是否启用 gzip 压缩；</li><li><code>gzip_disable</code> 指定哪些不需要 gzip 压缩的浏览器，正则匹配 请求头的User-Agent</li></ol><p>例子：对图片进行压缩</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">location</span><span style="color:#89DDFF;"> ~*</span><span style="color:#C3E88D;"> (png|jpeg|gif)$ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_comp_level </span><span style="color:#BABED8;">6</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	gzip_types </span><span style="color:#BABED8;">image/png image/jpeg image/jpg image/gif</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="图像转换" tabindex="-1">图像转换 <a class="header-anchor" href="#图像转换" aria-label="Permalink to &quot;图像转换&quot;">​</a></h2><p>nginx中可以使用<code>http_image_filter_module</code>模块的功能进行图片的转换如：缩放、裁剪、质量等等，使用此功能需要安装这个模块，这里演示在Centos中的安装过程，若已安装可以跳过此步骤。</p><p>首先检查是否安装了此模块，运行命令：如果发现有此模块将会高亮显示，如果没有什么都不会输出</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -V </span><span style="color:#89DDFF;">2&gt;&amp;1</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> grep</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">http_image_filter_module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">configure</span><span style="color:#C3E88D;"> arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -fPIC</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> --with-ld-opt=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-Wl,-z,relro -Wl,-z,now -pie</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> `</span><span style="color:#FFCB6B;">--with-http_image_filter_module</span><span style="color:#89DDFF;">`</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>安装模块依赖环境：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> yum install gd-devel pcre pcre-devel -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果原来是使用yum安装的nginx，则需要在<a href="https://nginx.org/en/download.html" target="_blank" rel="noreferrer">官方网站</a>上找到对应版本的nginx包下载到本地：这里我以1.22.1版本为例</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 下载</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> wget https://nginx.org/download/nginx-1.22.1.tar.gz</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 解压</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> tar xf nginx-1.22.1.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>为了不影响原来的nginx的数据和配置，使用和原版本的nginx同样的编译参数，然后在后面添加上<code>--with-http_image_filter_module</code>参数即可：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看原来版本的编译参数，并复制configure arguments 的值</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -V</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 编译nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> cd nginx-1.22.1</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -fPIC</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> --with-ld-opt=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-Wl,-z,relro -Wl,-z,now -pie</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> `</span><span style="color:#FFCB6B;">--with-http_image_filter_module</span><span style="color:#89DDFF;">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 编译安装文件</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> make </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#FFCB6B;"> make</span><span style="color:#C3E88D;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 重启nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -s reload</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 可以再次使用一下命令进行验证是否安装成功</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx -V </span><span style="color:#89DDFF;">2&gt;&amp;1</span><span style="color:#89DDFF;"> |</span><span style="color:#FFCB6B;"> grep</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">http_image_filter_module</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>到这里就可以使用http_image_filter_module模块的功能了，官方文档配置戳👉<a href="https://nginx.org/en/docs/http/ngx_http_image_filter_module.html" target="_blank" rel="noreferrer">这里</a></p><blockquote><p>以上安装此模块后编译如果出现其他的错误，请按照提示安装上相关的依赖即可解决</p></blockquote><p>image_filter使用参数：</p><ul><li><code>image_filter off;</code>：关闭模块</li><li><code>image_filter test;</code>：确保图片格式为PNG、JPEG、GIF、WEBP，否则返回415状态码</li><li><code>image_filter size;</code>：以json的形式输出图片的信息，如：&#39;{&quot;img&quot;:{&quot;width&quot;:1135,&quot;height&quot;:500,&quot;type&quot;:&quot;jpeg&quot;}}&#39;，resize、crop等同时使用时无效果</li><li><code>image_filter rotate 90|180|270;</code>：旋转图像，可以和resize、crop一起使用</li><li><code>image_filter resize width height;</code>：按比例缩放图像，要减少一个维度可以将另一个值设置为<code>-</code></li><li><code>image_filter crop width height;</code>：按比例将图像缩小到较大的一侧，并在另一侧产生无关边缘</li><li><code>image_filter_buffer size;</code>：读取图片缓冲区大小，若图片太大缓冲区太小则会抛415错误</li><li><code>image_filter_interlace on;</code>：如果启用，最终图像将交错。对于JPEG，最终图像将采用&quot;逐行JPEG&quot;格式。</li><li><code>image_filter_jpeg_quality 1-100;</code>：设置转换的JPEG图像的质量。可接受的值是从1到100的范围内。较小的值通常意味着图像质量越低，以达到减少数据传输。推荐的最大值为95，参数值可以包含变量</li><li><code>image_filter_webp_quality 1-100</code>：设置webp图片质量，同上</li><li><code>image_filter_transparency on|off;</code>：定义在使用调色板指定的颜色转换GIF图像或PNG图像时是否应保留透明度。透明度的降低会导致质量更好的图像，PNG中的alpha通道透明度始终保留。</li><li><code>image_filter_sharpen 1-100;</code>：增加最终图像的清晰度，锐度百分比可以超过100。零值将禁用锐化。参数值可以包含变量</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>注意以上大部分操作都会耗时，尤其是对于很大的图片，如果裁剪、缩放的比例很大，将会增加耗时，应合理设置处理流程</p><p>此模块处理图像出现异常的情况下基本都是抛出415错误，因此在不能正常处理图像情况下，重定向到指定的位置更为友好</p></div><p><strong>例子</strong>：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> /images/ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 初始化 width 为-，也就是原始大小</span></span>
<span class="line"><span style="color:#89DDFF;">	  set $</span><span style="color:#BABED8;">width -</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	  # 匹配图片url上的 w参数 如：/images/cat.png?w=1 | w=xx</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	  # 正则判断是纯数字且大于0时将值 赋值给 width</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">	  if</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">arg_w </span><span style="color:#89DDFF;">~* </span><span style="color:#C3E88D;">^[1-9]\d+$</span><span style="color:#BABED8;">) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	    set $</span><span style="color:#BABED8;">width</span><span style="color:#89DDFF;"> $</span><span style="color:#BABED8;">arg_w</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	  }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	  # 设置缓冲区 5M</span></span>
<span class="line"><span style="color:#89DDFF;">	  image_filter_buffer </span><span style="color:#BABED8;">5m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	  image_filter </span><span style="color:#BABED8;">test</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	  # 缩放图片 width，另一侧按比例缩放</span></span>
<span class="line"><span style="color:#89DDFF;">	  image_filter </span><span style="color:#BABED8;">resize </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">width -</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">	  alias </span><span style="color:#BABED8;">/documents/</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	  allow </span><span style="color:#BABED8;">all</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	  # 当抛出 415 错误时，走 @image_filter_error 路由</span></span>
<span class="line"><span style="color:#89DDFF;">	  error_page </span><span style="color:#BABED8;">415 @image_filter_error</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 重定向到 错误图片</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> @image_filter_error </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		return</span><span style="color:#F78C6C;"> 301</span><span style="color:#BABED8;"> /images/error.png;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>在浏览器上测试使用w参数：大于0都可以正常处理，其他的都会以原始大小返回；当图像大小大于5M时，由于太大将会重定向到错误图片，以上根据实际情况自行处理</p><p>除了以上对图片进行转换外，还可以使用<code>ngx_http_set_misc_module</code>模块或<code>Lua</code>脚本将图片转换成webp格式，提高图像加载，这里就不介绍了</p><h2 id="缓存" tabindex="-1">缓存 <a class="header-anchor" href="#缓存" aria-label="Permalink to &quot;缓存&quot;">​</a></h2><p>nginx默认支持静态资源的缓存和代理缓存</p><h3 id="静态资源缓存" tabindex="-1">静态资源缓存 <a class="header-anchor" href="#静态资源缓存" aria-label="Permalink to &quot;静态资源缓存&quot;">​</a></h3><p>可以使用<code>expires</code>和<code>Cache-Control</code>请求头设置缓存</p><ol><li>使用expires进行缓存，Expires 是 HTTP/1.0 中定义的字段，它指定了在过期之前客户端可以缓存响应的时间。服务器会在响应头中设置一个到期日期，客户端在该日期之前可以缓存响应。Expires 头部的时间格式是 GMT 格式的绝对时间，如 &quot;Expires: Wed, 21 Oct 2015 07:28:00 GMT&quot;。<div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#89DDFF;"> ~</span><span style="color:#C3E88D;"> \.(png|jpg|jpeg|gif|webp)$ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		expires </span><span style="color:#BABED8;">1d</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li>使用Cache-Control进行缓存，它是 HTTP/1.1 中定义的字段，它提供了更为灵活的缓存控制方式。它可以指定缓存的时间、缓存的位置、缓存的类型等。常用的指令包括<code>max-age</code>、<code>no-cache</code>、<code>no-store</code>、<code>must-revalidate</code> 等。其中，<code>max-age</code> 指定了缓存的最长时间，它的值是一个相对时间，如 &quot;Cache-Control: max-age=86400&quot; 表示缓存 1 天。<div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#89DDFF;"> ~</span><span style="color:#C3E88D;"> \.(png|jpg|jpeg|gif|webp)$ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		add_header </span><span style="color:#BABED8;">Cache-Control </span><span style="color:#C3E88D;">&quot;public, max-age=86400&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>Cache Control可以使用的参数如下： <ul><li>public：指示响应可以被任何中间缓存缓存，包括客户端和代理服务器。</li><li>private：指示响应只能被客户端缓存，不应该被代理服务器缓存。</li><li>max-age：指示缓存存储的最长时间，单位为秒。例如，Cache-Control: max-age=3600 表示缓存有效期为 1 小时。</li><li>s-maxage：与 max-age 类似，但只适用于共享缓存（比如代理服务器）。如果同时设置了max-age 和 s-maxage，则 s-maxage 优先级更高。</li><li>no-cache：指示客户端必须在使用缓存之前重新验证资源的有效性。如果资源未被修改，则可以从缓存中读取资源。否则，需要重新下载资源。</li><li>no-store：指示不应将响应存储在任何缓存中，包括客户端和代理服务器。</li><li>must-revalidate：指示在过期之后，缓存必须从原始服务器重新获取资源，以确保缓存仍然有效。如果不能从原始服务器重新获取资源，则缓存必须标记为过期。</li></ul></li></ol><p><strong>二者的区别和对比：</strong></p><p>Expires 和 Cache-Control 的区别主要在于过期时间的计算方式不同。Expires 是基于服务器时间的绝对时间，因此它的缺点是服务器时间和客户端时间可能不同步，可能导致缓存不一致。而 Cache-Control 则是相对时间，可以避免这个问题。此外，<code>Cache-Control</code>还支持更为灵活的控制方式，可以更好地控制缓存策略。建议使用Cache-Control 来设置 HTTP 缓存控制，而Expires则可以用作向后兼容，或在某些场景下作为备用方案。</p><h3 id="代理缓存" tabindex="-1">代理缓存 <a class="header-anchor" href="#代理缓存" aria-label="Permalink to &quot;代理缓存&quot;">​</a></h3><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">proxy_cache_path </span><span style="color:#BABED8;">/var/cache/nginx levels=1:2 keys_zone=my_cache:10m inactive=60m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> /proxy </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_pass </span><span style="color:#BABED8;">http://localhost:10000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 定义缓存的键名</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_key </span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">scheme</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">proxy_host</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">request_uri</span><span style="color:#C3E88D;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 缓存的有效期为 5 分钟</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_valid </span><span style="color:#BABED8;">200 </span><span style="color:#F78C6C;">5m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 根据 Pragma 字段决定是否跳过缓存</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_bypass $</span><span style="color:#BABED8;">http_pragma</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 制重新验证缓存</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_revalidate </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 启用代理缓存，并指定缓存区名称</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache </span><span style="color:#BABED8;">my_cache</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 启用缓存背景更新</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_background_update </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置缓存背景更新的时间间隔为 1 小时</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_background_update_interval</span><span style="color:#BABED8;"> 1h</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置缓存背景更新的失败重试次数为 2 次</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_background_update_retries</span><span style="color:#BABED8;"> 2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置缓存背景更新时使用的临时文件路径</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_background_update_temp_path</span><span style="color:#BABED8;"> /tmp/nginx_cache</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 启用缓存锁定，控制并发缓存请求</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_lock </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置缓存锁定的超时时间为 5 秒</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_lock_timeout </span><span style="color:#BABED8;">5s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 缓存锁定失败时，是否返回错误码 503</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_lock_age </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 启用缓存失效时使用旧的缓存数据</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_use_stale </span><span style="color:#BABED8;">error timeout updating</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置缓存失效时使用旧的缓存数据的有效期为 1 分钟</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_cache_valid </span><span style="color:#BABED8;">404 </span><span style="color:#F78C6C;">1m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="防盗链" tabindex="-1">防盗链 <a class="header-anchor" href="#防盗链" aria-label="Permalink to &quot;防盗链&quot;">​</a></h2><p>防盗链（Referer 防盗链）是指在网站或服务器端设置一些规则，只允许指定的域名或网站引用自己的资源，防止非法盗链，减少带宽浪费。</p><p>在 Nginx 中，可以使用 valid_referers 指令来实现防盗链的功能。该指令用于设置有效的引用来源（Referer）列表，只有在该列表中的来源才能访问指定的资源。</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">valid_referers</span><span style="color:#BABED8;"> [none</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">blocked</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">server_names</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">string</span><span style="color:#C3E88D;"> ...]</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><code>none</code>：允许空的引用来源（Referer）。</li><li><code>blocked</code>：阻止所有的引用来源（Referer）。</li><li><code>server_names</code>：允许与服务器名匹配的引用来源（Referer）。</li><li><code>string</code>：允许指定字符串的引用来源（Referer），可以使用通配符和正则表达式进行匹配。</li></ul><p>例子：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">	server_name </span><span style="color:#BABED8;">*.general-mac.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#89DDFF;"> ~</span><span style="color:#C3E88D;"> \.(png|jpg|jpeg|gif|webp)$ </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		valid_referers </span><span style="color:#BABED8;">blocked server_names </span><span style="color:#C3E88D;">&quot;~.*general-mac\.com$&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		if</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">invalid_referer) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">			return</span><span style="color:#F78C6C;"> 403</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">		}</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>上面的例子设置了不允许refer为none(不允许单独打开图片)，使用正则匹配只允许refer为 <code>general-mac.com</code> 或其任何子域名，其余的都会返回403，</p><h2 id="反向代理" tabindex="-1">反向代理 <a class="header-anchor" href="#反向代理" aria-label="Permalink to &quot;反向代理&quot;">​</a></h2><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> /proxy </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_pass </span><span style="color:#BABED8;">http://localhost:10001</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 添加响应头部返回给客户端</span></span>
<span class="line"><span style="color:#89DDFF;">		add_header </span><span style="color:#BABED8;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 传给目标服务器设置的头部信息</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 源host</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">Host </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		#上层请求真实IP (一般设置在第一层代理服务器)</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 访问的协议</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">X-Forwarded-Scheme </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">scheme</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 将经过多个代理服务器的ip以 逗号 拼接，最左边是用户真实ip</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# Websocket</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">Connection </span><span style="color:#C3E88D;">&quot;upgrade&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">Upgrade </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_upgrade</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 目标服务器数据回传超时时间</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_send_timeout </span><span style="color:#BABED8;">10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 目标服务器响应超时时间</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_read_timeout </span><span style="color:#BABED8;">30</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 和目标服务器连接超时时间</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_connect_timeout </span><span style="color:#BABED8;">90</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>使用nodejs简单的写一个后端服务：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> express</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> port </span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;"> 10001</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> res</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#BABED8;">	res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">		port</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		code</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;"> 200</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		msg</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">ok</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">		url</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> req</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span></span>
<span class="line"><span style="color:#89DDFF;">	}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#BABED8;">(port</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> ()</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#BABED8;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">server is running on port</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> +</span><span style="color:#BABED8;"> port))</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>测试：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> curl general-mac.com/proxy -I</span></span>
<span class="line"><span style="color:#FFCB6B;">HTTP/1.1</span><span style="color:#F78C6C;"> 200</span><span style="color:#C3E88D;"> OK</span></span>
<span class="line"><span style="color:#FFCB6B;">Server:</span><span style="color:#C3E88D;"> nginx/1.22.1</span></span>
<span class="line"><span style="color:#FFCB6B;">Date:</span><span style="color:#C3E88D;"> Thu, </span><span style="color:#F78C6C;">06</span><span style="color:#C3E88D;"> Apr </span><span style="color:#F78C6C;">2023</span><span style="color:#F78C6C;"> 13</span><span style="color:#C3E88D;">:17:41 GMT</span></span>
<span class="line"><span style="color:#FFCB6B;">Content-Type:</span><span style="color:#C3E88D;"> application/json</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> charset</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">utf-8</span></span>
<span class="line"><span style="color:#FFCB6B;">Content-Length:</span><span style="color:#F78C6C;"> 290</span></span>
<span class="line"><span style="color:#FFCB6B;">Connection:</span><span style="color:#C3E88D;"> keep-alive</span></span>
<span class="line"><span style="color:#FFCB6B;">X-Powered-By:</span><span style="color:#C3E88D;"> Express</span></span>
<span class="line"><span style="color:#FFCB6B;">ETag:</span><span style="color:#C3E88D;"> W/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">122-vJBMYWLUDf/IIuHJiL8M6GUx+Wo</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">X-Real-IP:</span><span style="color:#F78C6C;"> 192.168</span><span style="color:#C3E88D;">.10.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="配置跨域" tabindex="-1">配置跨域 <a class="header-anchor" href="#配置跨域" aria-label="Permalink to &quot;配置跨域&quot;">​</a></h2><p>跨域是怎么产生的这里不再赘述，在nginx中进行反向代理的跨域配置</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 后端服务器，使用上面的nodejs</span></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">	listen </span><span style="color:#BABED8;">10010</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> /proxy </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置允许的源(IP+PORT)</span></span>
<span class="line"><span style="color:#89DDFF;">		add_header </span><span style="color:#BABED8;">Access-Control-Allow-Origin </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_origin</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置允许的 请求方法</span></span>
<span class="line"><span style="color:#89DDFF;">		add_header </span><span style="color:#BABED8;">Access-Control-Allow-Methods </span><span style="color:#C3E88D;">&#39;OPTIONS, GET, POST, PUT, DELETE&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置允许的请求头</span></span>
<span class="line"><span style="color:#89DDFF;">		add_header </span><span style="color:#BABED8;">Access-Control-Allow-Headers </span><span style="color:#C3E88D;">&#39;x-locale&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 其他自定义...</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 预检请求 204 快速返回</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		if</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">request_method </span><span style="color:#89DDFF;">= </span><span style="color:#C3E88D;">&#39;OPTIONS&#39;</span><span style="color:#BABED8;">) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">		   return</span><span style="color:#F78C6C;"> 204</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#F07178;">		}</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">X-Real-IP </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">X-Host </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">X-Http-Host </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">http_host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">X-Forwarded-Scheme </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">scheme</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_set_header </span><span style="color:#BABED8;">X-Forwarded-For </span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_pass </span><span style="color:#BABED8;">http://backend</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>新建一个HTML页面：</p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;&lt;</span><span style="color:#F07178;">meta</span><span style="color:#C792EA;"> charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">/&gt;&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">input</span><span style="color:#C792EA;"> id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">input</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">请求</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#C792EA;">	const</span><span style="color:#BABED8;"> btn </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">button</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	btn</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">click</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#C792EA;"> async</span><span style="color:#BABED8;font-style:italic;"> e</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#C792EA;">		const</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;font-style:italic;"> await</span><span style="color:#82AAFF;"> fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://192.168.10.9:10010/proxy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#F07178;">			mode</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">cors</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">			headers</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">				&#39;</span><span style="color:#F07178;">x-locale</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">zh</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">			}</span></span>
<span class="line"><span style="color:#89DDFF;">		}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">		.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#BABED8;">		console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">	}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230406215803347.png" alt=""></p><h2 id="负载均衡" tabindex="-1">负载均衡 <a class="header-anchor" href="#负载均衡" aria-label="Permalink to &quot;负载均衡&quot;">​</a></h2><p>nginx中可以使用<code>nginx_http_upstream_module</code>模块实现负载均衡，请确保已安装</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">upstream</span><span style="color:#FFCB6B;"> backend </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 使用三个后端服务地址</span></span>
<span class="line"><span style="color:#89DDFF;">	server</span><span style="color:#BABED8;"> backend1.example.com </span><span style="color:#BABED8;font-style:italic;">weight</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">;</span></span>
<span class="line"><span style="color:#BABED8;">	server backend2.example.com;</span></span>
<span class="line"><span style="color:#89DDFF;">	server</span><span style="color:#BABED8;"> backend3.example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 轮询</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# round_robin;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 连接最小数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# least_conn;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# IP哈希</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# ip_hash;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> / </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#89DDFF;">		proxy_pass </span><span style="color:#BABED8;">http://backend</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>nginx可以根据不同的负载均衡策略进行流量分发</p><h2 id="配置https" tabindex="-1">配置HTTPS <a class="header-anchor" href="#配置https" aria-label="Permalink to &quot;配置HTTPS&quot;">​</a></h2><p>在使用HTTPS之前，需要获得SSL证书。可以从证书颁发机构（CA）购买证书，或者使用免费的证书颁发机构（如Let&#39;s Encrypt）获得证书，这里采用OpenSSL自签证书，便于使用封装成以下脚本<code>auto-cetificate.sh</code>：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># https://docs.azure.cn/zh-cn/articles/azure-operations-guide/application-gateway/aog-application-gateway-howto-create-self-signed-cert-via-openssl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">请使用sudo运行以获取系统权限!</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">请输入域名：</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">read</span><span style="color:#C3E88D;"> userdomain</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 啥都不输退出</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;"> !</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#BABED8;">$userdomain</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> ];</span><span style="color:#89DDFF;font-style:italic;"> then</span></span>
<span class="line"><span style="color:#82AAFF;">    exit</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 使用OpenSSL签发证书</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 1. 生成服务器私钥 (domain.com.key)  domain.com 随便起的名字</span></span>
<span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> genrsa -out </span><span style="color:#BABED8;">$userdomain</span><span style="color:#C3E88D;">.key </span><span style="color:#F78C6C;">4096</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2.生成证书签名请求(CSR) domain.com.csr</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 生成 CSR 的过程中，会提示输入一些信息，其中一个提示是 Common Name (e.g. YOUR name)，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 这个非常重要，这一项应填入 FQDN(Fully Qualified Domain Name)完全合格域名/全称域名，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如果您使用 SSL 加密保护网络服务器和客户端之间的数据流，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 举例被保护的网站是 https://test.chinacloudsites.cn，</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 那么此处 Common Name 应输入 test.chinacloudsites.cn</span></span>
<span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> req -new -key </span><span style="color:#BABED8;">$userdomain</span><span style="color:#C3E88D;">.key -out </span><span style="color:#BABED8;">$userdomain</span><span style="color:#C3E88D;">.csr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 3.使用上一步的证书签名请求签发证书</span></span>
<span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> x509 -req -days </span><span style="color:#F78C6C;">365</span><span style="color:#C3E88D;"> -in </span><span style="color:#BABED8;">$userdomain</span><span style="color:#C3E88D;">.csr -signkey </span><span style="color:#BABED8;">$userdomain</span><span style="color:#C3E88D;">.key -out </span><span style="color:#BABED8;">$userdomain</span><span style="color:#C3E88D;">.crt -extensions SAN</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># pem</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># openssl s_client -showcerts -connect gitlab.ihengshuai.com:443 -servername gitlab.ihengshuai.com &lt; /dev/null 2&gt;/dev/null | openssl x509 -outform PEM &gt; /certs/gitlab.ihengshuai.com.crt</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Generate success!</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 将本地域名写入host</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#C3E88D;"> 需要将域名写入host吗[yes/no]?</span></span>
<span class="line"><span style="color:#82AAFF;">read</span><span style="color:#C3E88D;"> confirm_read_host</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#BABED8;">$confirm_read_host</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> !=</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">yes</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> ];</span><span style="color:#89DDFF;font-style:italic;"> then</span></span>
<span class="line"><span style="color:#82AAFF;">    exit</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#C3E88D;"> 需要保持和证书域名相同不[yes/no]?</span></span>
<span class="line"><span style="color:#82AAFF;">read</span><span style="color:#C3E88D;"> confirm_write_host</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#BABED8;">$confirm_write_host</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> ==</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">no</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> ];</span><span style="color:#89DDFF;font-style:italic;"> then</span></span>
<span class="line"><span style="color:#82AAFF;">    echo</span><span style="color:#C3E88D;"> 请填写待写入host的域名</span></span>
<span class="line"><span style="color:#82AAFF;">    read</span><span style="color:#C3E88D;"> custom_host_domain</span></span>
<span class="line"><span style="color:#FFCB6B;">    cp</span><span style="color:#C3E88D;"> /etc/hosts /etc/hosts.old</span></span>
<span class="line"><span style="color:#82AAFF;">    echo</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">127.0.0.1 </span><span style="color:#BABED8;">$custom_host_domain</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> &gt;&gt;</span><span style="color:#C3E88D;">/etc/hosts</span></span>
<span class="line"><span style="color:#82AAFF;">    exit</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#C3E88D;"> /etc/hosts /etc/hosts.old</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">127.0.0.1 </span><span style="color:#BABED8;">$userdomain</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> &gt;&gt;</span><span style="color:#C3E88D;">/etc/hosts</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Write success!</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">sleep</span><span style="color:#F78C6C;"> 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>执行脚本根据提示输入生成证书：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> ./auto-cetificate.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>最终会产生如下文件：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> ls </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#82AAFF;"> pwd</span></span>
<span class="line"><span style="color:#FFCB6B;">auto-cetificate.sh</span><span style="color:#C3E88D;">  general-mac.com.crt  general-mac.com.csr  general-mac.com.key</span></span>
<span class="line"><span style="color:#FFCB6B;">/root/certificates</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>生成DH加密参数：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 此过程会耗时</span></span>
<span class="line"><span style="color:#FFCB6B;">openssl</span><span style="color:#C3E88D;"> dhparam -out dhparam.pem </span><span style="color:#F78C6C;">2048</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>对于SSL相关配置、握手不太清楚的可以阅读我的<a href="/frontend/computer-network/http-protocol.html#https">「HTTP协议及安全防范」</a>一文</p></blockquote><p>在nginx中配置https：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">	listen </span><span style="color:#F78C6C;">      80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	listen </span><span style="color:#F78C6C;">      443</span><span style="color:#BABED8;"> ssl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	server_name </span><span style="color:#BABED8;"> general-mac.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 证书</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_certificate </span><span style="color:#BABED8;">/root/certificates/general-mac.com.crt</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_certificate_key </span><span style="color:#BABED8;">/root/certificates/general-mac.com.key</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# TLS版本、加密套件</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_protocols </span><span style="color:#BABED8;">TLSv1 TLSv1.1 TLSv1.2 TLSv1.3</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_ciphers </span><span style="color:#BABED8;">ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> # 加密套件根据自己需求调整</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 服务器推荐加密套件</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_prefer_server_ciphers </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# DH参数</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_dhparam </span><span style="color:#BABED8;">/root/certificates/dhparam.pem</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# TLS会话恢复</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_session_timeout </span><span style="color:#BABED8;">10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_session_cache </span><span style="color:#BABED8;">  shared:SSL:10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_session_tickets </span><span style="color:#BABED8;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 重定向https</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">	if</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">ssl_protocol </span><span style="color:#89DDFF;">= </span><span style="color:#C3E88D;">&#39;&#39;</span><span style="color:#BABED8;">) </span><span style="color:#F07178;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	    rewrite</span><span style="color:#C3E88D;"> ^(.*) https://$</span><span style="color:#F07178;">server_name</span><span style="color:#89DDFF;">$</span><span style="color:#BABED8;">request_uri</span><span style="color:#F78C6C;"> permanent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 判断有多种方式</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	#if ($scheme = &#39;http&#39;) {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	#  rewrite ^(.*) https://$server_name$request_uri permanent;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	#}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>配置好后记得重启nginx，打开游览器访问<code>general-mac.com</code>：由于自签证书没有被CA认证会被浏览器鉴定不安全的链接，点击高级进一步访问即可，或者将证书放入系统根证书中让操作系统信任 <img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230407081742842.png" alt=""></p><p><strong>优化https</strong>：</p><p>启用了https后由于会进行SSL握手会消耗更多的CPU资源，通过启用SSL会话重用来优化：</p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">ssl_session_cache </span><span style="color:#BABED8;">shared:SSL:50m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">ssl_session_timeout </span><span style="color:#BABED8;">1h</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">ssl_session_tickets </span><span style="color:#BABED8;">off</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><code>ssl_session_cache</code>：这个指令用于配置SSL会话缓存，它指定了缓存的名称（&quot;shared:SSL&quot;）和大小（&quot;50m&quot;）。SSL会话缓存是用来存储SSL握手过程中生成的会话密钥的，这些会话密钥可以被重用来加速后续的SSL握手过程。通过启用SSL会话缓存，可以减少SSL握手的时间和CPU负载，从而提高服务器的性能</li><li><code>ssl_session_timeout</code>：这个指令用于配置SSL会话缓存的超时时间，它指定了会话缓存的有效期为1个小时。一旦会话缓存过期，会话密钥将被删除，下一次SSL握手将会重新生成一个新的会话密钥。通过使用合适的会话超时时间，可以平衡服务器的安全性和性能</li></ul><h2 id="配置http2-3" tabindex="-1">配置HTTP2/3 <a class="header-anchor" href="#配置http2-3" aria-label="Permalink to &quot;配置HTTP2/3&quot;">​</a></h2><p>要在nginx中启用HTTP/2需要在nginx版本1.9.5或更高版本中启用，只支持在加密通道上运行，因此只能在HTTPS上使用，在以上的基础上添加<code>http2</code></p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">	listen </span><span style="color:#BABED8;">443 ssl http2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">	location</span><span style="color:#FFCB6B;"> / </span><span style="color:#BABED8;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# HTTP2 server push功能</span></span>
<span class="line"><span style="color:#89DDFF;">		http2_push </span><span style="color:#BABED8;">/style.css</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>打开浏览器访问：如果你没有看到h2，需要勾选显示protocol一栏 <img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230407083521035.png" alt=""> HTTP/2使用多路复用技术，可以在单个TCP连接上同时发送多个请求和响应。这样可以减少延迟和提高并发性，从而加快页面加载速度；HTTP/2使用二进制协议，可以减少网络流量和解析时间，从而提高了网络性能和效率</p><p>虽然HTTP2使用多路复用技术减少连接时间，由于其存在<code>队头阻塞</code>的问题，当一个请求或响应被阻塞时，后续请求或响应也会被阻塞，从而导致整个连接的性能下降，因此它仍不是完美的协议也是存在一些缺点</p><div class="tip custom-block"><p class="custom-block-title">什么是队头阻塞</p><p><u>在HTTP/2中，多个请求和响应可以通过单个TCP连接并行传输。但是，由于HTTP/2使用了帧的概念来分割请求和响应，而帧必须按顺序发送和接收，因此如果前面的请求或响应被阻塞，后续的请求或响应也必须等待前面的请求或响应完成后才能发送或接收。这就是队头阻塞的问题。</u></p></div><p>那如何解决队头阻塞问题呢？可以使用多域名请求提高并发度、优化请求队列(性能好的放前面之类)、采用HTTP3</p><p>这里来讲QUIC协议(HTTP3)，一种基于UDP协议的传输层协议，其优势如下：</p><ul><li>更快的连接建立和恢复</li><li>更好的多路复用：使用流来分隔请求和响应，可以更好地实现多路复用，并且不需要使用帧头部，从而提高了头部压缩效率。此外，QUIC还支持优先级，可以更好地控制请求和响应的优先级</li><li>更好的拥塞控制：QUIC采用基于TCP的拥塞控制算法，但可以更快地适应网络环境的变化，从而提高了网络传输的效率。同时，QUIC还支持基于连接的流量控制，可以更好地适应不同的应用需求</li><li>QUIC使用TLS 1.3来保护数据的安全性和隐私性，并且支持0-RTT、1—RTT握手，可以更快地建立安全连接。此外，QUIC还支持源地址验证和连接迁移等功能，可以更好地防止网络攻击和提高网络的可靠性</li></ul><p>如何使用？可以安装<a href="https://quic.nginx.org/" target="_blank" rel="noreferrer">nginx-quic</a>使用其功能，这里就不介绍如何安装了，可以参考<a href="https://quic.nginx.org/readme.html" target="_blank" rel="noreferrer">nginx-quic官方配置</a>或<a href="https://github.com/cloudflare/quiche/tree/master/nginx" target="_blank" rel="noreferrer">quiche配置nginx</a></p><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">server</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">	listen </span><span style="color:#BABED8;">443 ssl http2</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> #TCP</span></span>
<span class="line"><span style="color:#89DDFF;">	listen </span><span style="color:#BABED8;">443 http3 quic reuseport</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;"> # QUIC</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">	ssl_protocols </span><span style="color:#BABED8;">  TLSv1.3</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 开启 TLS 1.3 0-RTT</span></span>
<span class="line"><span style="color:#89DDFF;">	ssl_early_data </span><span style="color:#BABED8;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	add_header </span><span style="color:#BABED8;">Alt-Svc </span><span style="color:#C3E88D;">&#39;h3-29=&quot;:8443&quot;; ma=2592000,h3-T051=&quot;:8443&quot;; ma=2592000,h3-Q050=&quot;:8443&quot;; ma=2592000,h3-Q046=&quot;:8443&quot;; ma=2592000,h3-Q043=&quot;:8443&quot;; ma=2592000,quic=&quot;:8443&quot;; ma=2592000; v=&quot;46,43&quot;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>参考文档：</p><ul><li><a href="https://quic.nginx.org/readme.html" target="_blank" rel="noreferrer">nginx-quic官方配置</a></li><li><a href="https://hg.nginx.org/nginx-quic/shortlog/quic" target="_blank" rel="noreferrer">nginx-quic-repository</a></li><li><a href="https://www.nginx.com/blog/binary-packages-for-preview-nginx-quic-http3-implementation/" target="_blank" rel="noreferrer">Binary Packages to Preview Nginx HTTP3/QUIC Implementation</a></li><li><a href="https://github.com/cloudflare/quiche/tree/master/nginx" target="_blank" rel="noreferrer">quiche配置nginx</a></li></ul><h2 id="keepalived实现高可用" tabindex="-1">keepalived实现高可用 <a class="header-anchor" href="#keepalived实现高可用" aria-label="Permalink to &quot;keepalived实现高可用&quot;">​</a></h2><p>由于流量都是通过nginx入口分发给应用服务，nginx很难保持永久正常服务状态，当nginx挂了时就会导致所有应用都无法访问，因此使用多个机器进行备份待用实现高可用是必然的</p><p>keepalived是一款常用于搭建高可用性服务的软件，可以与nginx等应用程序一起使用，以确保在一个节点故障时，服务能够在另一个节点上继续运行，从而提高应用程序的可用性和稳定性。keepalived需要绑定和主机同一网段的一个或多个虚拟ip，根据检测机制将虚拟ip绑定到指定的机器上，当机器宕机时，又会绑定到另一个健康的机器上。使用keepalived实现高可用至少需要2台主机，这里准备两台虚拟机。</p><ol><li><p>每个节点都安装keepalived和nginx</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#C3E88D;"> install keepalived nginx -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>查看节点网卡，这里显示我有两张网卡ens160和ens256，这里使用ens256网卡地址，两个节点的ip分别为<code>192.168.10.9</code>和<code>192.168.10.8</code></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 节点1</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> keepalived ip a</span></span>
<span class="line"><span style="color:#FFCB6B;">2:</span><span style="color:#C3E88D;"> ens160: </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">BROADCAST,MULTICAST,UP,LOWER_U</span><span style="color:#BABED8;">P</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> mtu </span><span style="color:#F78C6C;">1500</span><span style="color:#C3E88D;"> qdisc fq_codel state UP group default qlen </span><span style="color:#F78C6C;">1000</span></span>
<span class="line"><span style="color:#FFCB6B;">    link/ether</span><span style="color:#C3E88D;"> xx:xx:xx:xx:76:b0 brd ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#FFCB6B;">    inet</span><span style="color:#F78C6C;"> 192.168</span><span style="color:#C3E88D;">.3.92/24 brd </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.3.255 scope global noprefixroute dynamic ens160</span></span>
<span class="line"><span style="color:#FFCB6B;">       valid_lft</span><span style="color:#F78C6C;"> 79657</span><span style="color:#C3E88D;">sec preferred_lft </span><span style="color:#F78C6C;">79657</span><span style="color:#C3E88D;">sec</span></span>
<span class="line"><span style="color:#FFCB6B;">3:</span><span style="color:#C3E88D;"> ens256: </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">BROADCAST,MULTICAST,UP,LOWER_U</span><span style="color:#BABED8;">P</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> mtu </span><span style="color:#F78C6C;">1500</span><span style="color:#C3E88D;"> qdisc fq_codel state UP group default qlen </span><span style="color:#F78C6C;">1000</span></span>
<span class="line"><span style="color:#FFCB6B;">    link/ether</span><span style="color:#C3E88D;"> xx:xx:xx:xx:72:86 brd ff:ff:ff:ff:ff:ff</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">    inet</span><span style="color:#F78C6C;"> 192.168</span><span style="color:#C3E88D;">.10.9/24 brd </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.255 scope global noprefixroute ens256</span></span>
<span class="line"><span style="color:#FFCB6B;">       valid_lft</span><span style="color:#C3E88D;"> forever preferred_lft forever</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 节点2</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> keepalived ip a</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ...</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">192.168.10.8/24</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li><li><p>配置keepalived，<code>vim /etc/keepalived/keepalived.conf</code>：默认的配置文件应该有很多，只需要以下配置即可，其他可以直接删除掉</p><blockquote><p>注意每个节点都需要配置以下内容，不同的节点请注意配置文件中的提示进行修改</p></blockquote><div class="language-nginx line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># /etc/keepalived/keepalived.conf</span></span>
<span class="line"><span style="color:#BABED8;">! </span><span style="color:#89DDFF;">Configuration</span><span style="color:#BABED8;"> File for keepalived</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">global_defs</span><span style="color:#BABED8;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">   router_id</span><span style="color:#BABED8;"> LVS_DEVEL</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   #vrrp_strict</span></span>
<span class="line"><span style="color:#89DDFF;">   vrrp_skip_check_adv_addr</span></span>
<span class="line"><span style="color:#89DDFF;">   vrrp_garp_interval</span><span style="color:#BABED8;"> 0</span></span>
<span class="line"><span style="color:#89DDFF;">   vrrp_gna_interval</span><span style="color:#BABED8;"> 0</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">vrrp_script</span><span style="color:#BABED8;"> chk_http_ port {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 检测nginx健康状态脚本，根据下一步骤创建</span></span>
<span class="line"><span style="color:#89DDFF;">	script</span><span style="color:#C3E88D;"> &quot;/etc/keepalived/nginx_check.sh&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">	interval</span><span style="color:#BABED8;"> 2</span></span>
<span class="line"><span style="color:#89DDFF;">	weight</span><span style="color:#BABED8;"> 2</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">vrrp_instance</span><span style="color:#BABED8;"> VI_1 {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 指定keepalived的角色，MASTER为主，BACKUP为备，当前节点设置为MASTER，其余节点设置为BACKUP</span></span>
<span class="line"><span style="color:#89DDFF;">	state </span><span style="color:#BABED8;">MASTER</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 指定网卡，根据自己节点网卡的名称 替换ens256</span></span>
<span class="line"><span style="color:#BABED8;">	interface ens256</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# vrrp实例id，所有节点的值必须一致</span></span>
<span class="line"><span style="color:#BABED8;">	virtual_router_id 51</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 数值越大，优先级越大，获取处理请求的优先级越高，根据节点的性能自行调整</span></span>
<span class="line"><span style="color:#BABED8;">	priority 100</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 检测节点状态的心跳间隔</span></span>
<span class="line"><span style="color:#BABED8;">	advert_int 1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 节点间通信类型和密码</span></span>
<span class="line"><span style="color:#BABED8;">	authentication {</span></span>
<span class="line"><span style="color:#BABED8;">		auth_type PASS </span><span style="color:#676E95;font-style:italic;"># 密码类型</span></span>
<span class="line"><span style="color:#BABED8;">		auth_pass </span><span style="color:#F78C6C;">1111</span><span style="color:#676E95;font-style:italic;"> # 密码</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">	# 虚拟ip，根据当前节点的ip网段设置</span></span>
<span class="line"><span style="color:#BABED8;">	virtual_ipaddress {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		# 设置其中一个虚拟ip为 192.168.10.5  网卡 ens256  打标签 ens256:vip51</span></span>
<span class="line"><span style="color:#BABED8;">		192.168.10.5/24 dev ens256 label ens256:vip51</span></span>
<span class="line"><span style="color:#BABED8;">	}</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></li><li><p>配置检测nginx状态脚本，同样每个节点都需要，<code>vim /etc/keepalived/nginx_check.sh</code>：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">#! /bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看nginx的进程数</span></span>
<span class="line"><span style="color:#BABED8;">A</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">`</span><span style="color:#FFCB6B;">ps</span><span style="color:#C3E88D;"> -C nginx --no-heading </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;"> wc</span><span style="color:#C3E88D;"> -l</span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 进程数位0时，启动nginx</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;"> [</span><span style="color:#BABED8;"> $A </span><span style="color:#89DDFF;">-eq</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;"> ];</span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#FFCB6B;">    /usr/sbin/nginx</span></span>
<span class="line"><span style="color:#FFCB6B;">    sleep</span><span style="color:#F78C6C;"> 2</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    # 两秒后nginx进程还是0则杀死keepalived，进行VIP的转移，将会飘到另一节点上</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    if</span><span style="color:#89DDFF;"> [</span><span style="color:#89DDFF;"> `</span><span style="color:#FFCB6B;">ps</span><span style="color:#C3E88D;"> -C nginx --no-heading </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;"> wc</span><span style="color:#C3E88D;"> -l</span><span style="color:#89DDFF;">`</span><span style="color:#89DDFF;"> -eq</span><span style="color:#F78C6C;"> 0</span><span style="color:#89DDFF;"> ];</span><span style="color:#89DDFF;font-style:italic;">then</span></span>
<span class="line"><span style="color:#FFCB6B;">        killall</span><span style="color:#C3E88D;"> keepalived</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">    fi</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li><li><p>所有节点添加<code>keepalived_script</code>用户并赋予执行脚本权限：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> useradd keepalived_script</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> visudo # 添加以下内容</span></span>
<span class="line"><span style="color:#FFCB6B;">keepalived_script</span><span style="color:#C3E88D;"> ALL=</span><span style="color:#BABED8;">(</span><span style="color:#C3E88D;">ALL</span><span style="color:#BABED8;">) NOPASSWD: ALL</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>所有节点启动nginx和keepalived，请确保nginx可以正常访问：为了方便演示，可以将不同节点的nginx首页设置成不同的</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 启动nginx，或 systemctl start nginx，安装包的在bin文件下执行</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> nginx</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 启动keepalived</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> systemctl start keepalived</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看keepalive状态</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> systemctl status keepalived -l</span></span>
<span class="line"><span style="color:#FFCB6B;">keepalived.service</span><span style="color:#C3E88D;"> - LVS and VRRP High Availability Monitor</span></span>
<span class="line"><span style="color:#FFCB6B;">Loaded:</span><span style="color:#C3E88D;"> loaded </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">/usr/lib/systemd/system/keepalived.service</span><span style="color:#89DDFF;">;</span><span style="color:#FFCB6B;"> disabled</span><span style="color:#89DDFF;">;</span><span style="color:#FFCB6B;"> vendor</span><span style="color:#C3E88D;"> preset: disabled</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">Active:</span><span style="color:#C3E88D;"> active </span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">running</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;"> since 六 </span><span style="color:#F78C6C;">2020</span><span style="color:#C3E88D;">-04-08 </span><span style="color:#F78C6C;">18</span><span style="color:#C3E88D;">:08:52 CST</span><span style="color:#89DDFF;">;</span><span style="color:#FFCB6B;"> 18min</span><span style="color:#C3E88D;"> ago</span></span>
<span class="line"><span style="color:#FFCB6B;">Process:</span><span style="color:#F78C6C;"> 5171</span><span style="color:#C3E88D;"> ExecStart=/usr/sbin/keepalived </span><span style="color:#BABED8;">$KEEPALIVED_OPTIONS (code=exited, </span><span style="color:#C3E88D;">status=</span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">/SUCCESS</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">Main</span><span style="color:#C3E88D;"> PID: </span><span style="color:#F78C6C;">5172</span><span style="color:#89DDFF;"> (</span><span style="color:#FFCB6B;">keepalived</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">	CGroup:</span><span style="color:#C3E88D;"> /system.slice/keepalived.service</span></span>
<span class="line"><span style="color:#FFCB6B;">       ├─5172</span><span style="color:#C3E88D;"> /usr/sbin/keepalived -D</span></span>
<span class="line"><span style="color:#FFCB6B;">       ├─5173</span><span style="color:#C3E88D;"> /usr/sbin/keepalived -D</span></span>
<span class="line"><span style="color:#FFCB6B;">       └─5174</span><span style="color:#C3E88D;"> /usr/sbin/keepalived -D</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">4月</span><span style="color:#F78C6C;"> 08</span><span style="color:#F78C6C;"> 18</span><span style="color:#C3E88D;">:08:54 general-mac Keepalived_vrrp[</span><span style="color:#F78C6C;">5174</span><span style="color:#C3E88D;">]: Sending gratuitous ARP on ens256 for </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.5</span></span>
<span class="line"><span style="color:#FFCB6B;">4月</span><span style="color:#F78C6C;"> 08</span><span style="color:#F78C6C;"> 18</span><span style="color:#C3E88D;">:08:54 general-mac Keepalived_vrrp[</span><span style="color:#F78C6C;">5174</span><span style="color:#C3E88D;">]: Sending gratuitous ARP on ens256 for </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li><li><p>在主节点上查看ip：可以看到当前主节点的ens256网卡上会绑定一个VIP(192.168.10.5)，就是keepalived设置的虚拟ip<code>192.168.10.5</code>，查看其他机器是没有当前VIP的</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> ip a</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#省略其他...</span></span>
<span class="line"><span style="color:#FFCB6B;">3:</span><span style="color:#C3E88D;"> ens256: </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">BROADCAST,MULTICAST,UP,LOWER_U</span><span style="color:#BABED8;">P</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> mtu </span><span style="color:#F78C6C;">1500</span><span style="color:#C3E88D;"> qdisc fq_codel state UP group default qlen </span><span style="color:#F78C6C;">1000</span></span>
<span class="line"><span style="color:#FFCB6B;">link/ether</span><span style="color:#C3E88D;"> xx:xx:xx:xx:72:86 brd ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#FFCB6B;">inet</span><span style="color:#F78C6C;"> 192.168</span><span style="color:#C3E88D;">.10.9/24 brd </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.255 scope global noprefixroute ens256</span></span>
<span class="line"><span style="color:#FFCB6B;">   valid_lft</span><span style="color:#C3E88D;"> forever preferred_lft forever</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">inet</span><span style="color:#F78C6C;"> 192.168</span><span style="color:#C3E88D;">.10.5/24 scope global secondary ens256:vip51</span></span>
<span class="line"><span style="color:#FFCB6B;">   valid_lft</span><span style="color:#C3E88D;"> forever preferred_lft forever</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>浏览器访问VIP地址<code>192.168.10.5</code><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230408183654244.png" alt=""></p><p>当所有节点都没有问题时keepalived会将访问导向<code>priority</code>优先级最高的节点上，上面主节点优先级最高，所以会返回主节点上的nginx首页(包含k8s图片)</p><p>这里停用主节点上的keepalived来演示宕机的情况，宕机后VIP会从当前节点剔除并根据优先级绑定到另一节点，这样再次访问时就会访问到另一节点的nginx上，而当宕机恢复后keepalived又会根据优先级回到原来的节点上，感兴趣可以试试</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 主节点上停止</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> systemctl stop keepalived</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 主节点上查看ip，网卡上没了VIP</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> ip a</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 另一节点上查看，会发现绑定了VIP，再次刷新浏览器发现网页变了</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> ip a</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol><h2 id="内置变量" tabindex="-1">内置变量 <a class="header-anchor" href="#内置变量" aria-label="Permalink to &quot;内置变量&quot;">​</a></h2><p>以下是一些常用的内置变量，对于配置是有很大帮助的</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#BABED8;">$arg_PARAMETER </span><span style="color:#676E95;font-style:italic;">#GET 请求中变量名 PARAMETER 参数的值</span></span>
<span class="line"><span style="color:#BABED8;">$args </span><span style="color:#676E95;font-style:italic;">#这个变量等于 GET 请求中的参数，例如，foo=123&amp;bar=blahblah;这个变量可以被修改</span></span>
<span class="line"><span style="color:#BABED8;">$binary_remote_addr </span><span style="color:#676E95;font-style:italic;">#二进制码形式的客户端地址</span></span>
<span class="line"><span style="color:#BABED8;">$body_bytes_sent </span><span style="color:#676E95;font-style:italic;">#传送页面的字节数</span></span>
<span class="line"><span style="color:#BABED8;">$content_length </span><span style="color:#676E95;font-style:italic;">#请求头中的 Content-length 字段</span></span>
<span class="line"><span style="color:#BABED8;">$content_type </span><span style="color:#676E95;font-style:italic;">#请求头中的 Content-Type 字段</span></span>
<span class="line"><span style="color:#BABED8;">$cookie_COOKIE </span><span style="color:#676E95;font-style:italic;">#cookie COOKIE 的值</span></span>
<span class="line"><span style="color:#BABED8;">$document_root </span><span style="color:#676E95;font-style:italic;">#当前请求在 root 指令中指定的值</span></span>
<span class="line"><span style="color:#BABED8;">$document_uri </span><span style="color:#676E95;font-style:italic;">#与 $uri 相同</span></span>
<span class="line"><span style="color:#BABED8;">$host </span><span style="color:#676E95;font-style:italic;">#请求中的主机头(Host)字段，如果请求中的主机头不可用或者空，则为处理请求的 server 名称(处理请求的 server 的 server_name 指令的值)。值为小写，不包含端口</span></span>
<span class="line"><span style="color:#BABED8;">$hostname </span><span style="color:#676E95;font-style:italic;">#机器名使用 gethostname 系统调用的值</span></span>
<span class="line"><span style="color:#BABED8;">$http_HEADER </span><span style="color:#676E95;font-style:italic;">#HTTP 请求头中的内容，HEADER 为 HTTP 请求中的内容转为小写，-变为_(破折号变为下划线)，例如：$http_user_agent(Uaer-Agent 的值)</span></span>
<span class="line"><span style="color:#BABED8;">$sent_http_HEADER </span><span style="color:#676E95;font-style:italic;">#HTTP 响应头中的内容，HEADER 为 HTTP 响应中的内容转为小写，-变为_(破折号变为下划线)，例如：sent_http_content_type…</span></span>
<span class="line"><span style="color:#BABED8;">$is_args </span><span style="color:#676E95;font-style:italic;">#如果 $args 设置，值为&quot;?&quot;，否则为&quot;&quot;</span></span>
<span class="line"><span style="color:#BABED8;">$limit_rate </span><span style="color:#676E95;font-style:italic;">#这个变量可以限制连接速率</span></span>
<span class="line"><span style="color:#BABED8;">$nginx_version </span><span style="color:#676E95;font-style:italic;">#当前运行的 nginx 版本号</span></span>
<span class="line"><span style="color:#BABED8;">$query_string </span><span style="color:#676E95;font-style:italic;">#与 $args 相同</span></span>
<span class="line"><span style="color:#BABED8;">$remote_addr </span><span style="color:#676E95;font-style:italic;">#客户端的IP地址</span></span>
<span class="line"><span style="color:#BABED8;">$remote_port </span><span style="color:#676E95;font-style:italic;">#客户端的端口</span></span>
<span class="line"><span style="color:#BABED8;">$remote_port </span><span style="color:#676E95;font-style:italic;">#已经经过 Auth Basic Module 验证的用户名</span></span>
<span class="line"><span style="color:#BABED8;">$request_filename </span><span style="color:#676E95;font-style:italic;">#当前连接请求的文件路径，由 root 或 alias 指令与 URI 请求生成</span></span>
<span class="line"><span style="color:#BABED8;">$request_body </span><span style="color:#676E95;font-style:italic;">#这个变量（0.7.58+）包含请求的主要信息。在使用 proxy_pass 或 fastcgi_pass 指令的 location 中比较有意义</span></span>
<span class="line"><span style="color:#BABED8;">$request_body_file </span><span style="color:#676E95;font-style:italic;">#客户端请求主体信息的临时文件名</span></span>
<span class="line"><span style="color:#BABED8;">$request_completion </span><span style="color:#676E95;font-style:italic;">#如果请求成功，设为&quot;OK&quot;；如果请求未完成或者不是一系列请求中最后一部分则设为空</span></span>
<span class="line"><span style="color:#BABED8;">$request_method </span><span style="color:#676E95;font-style:italic;">#这个变量是客户端请求的动作，通常为 GET 或 POST。包括 0.8.20 及之前的版本中，这个变量总为 main request 中的动作，如果当前请求是一个子请求，并不使用这个当前请求的动作</span></span>
<span class="line"><span style="color:#BABED8;">$request_uri </span><span style="color:#676E95;font-style:italic;">#这个变量等于包含一些客户端请求参数的原始 URI，它无法修改，请查看 $uri 更改或重写 URI</span></span>
<span class="line"><span style="color:#BABED8;">$scheme </span><span style="color:#676E95;font-style:italic;">#所用的协议，例如 http 或者是 https，例如 rewrite ^(.+)$$scheme://example.com$1 redirect</span></span>
<span class="line"><span style="color:#BABED8;">$server_addr </span><span style="color:#676E95;font-style:italic;">#服务器地址，在完成一次系统调用后可以确定这个值，如果要绕开系统调用，则必须在listen中指定地址并且使用bind参数</span></span>
<span class="line"><span style="color:#BABED8;">$server_name </span><span style="color:#676E95;font-style:italic;">#服务器名称</span></span>
<span class="line"><span style="color:#BABED8;">$server_port </span><span style="color:#676E95;font-style:italic;">#请求到达服务器的端口号</span></span>
<span class="line"><span style="color:#BABED8;">$server_protocol </span><span style="color:#676E95;font-style:italic;">#请求使用的协议，通常是 HTTP/1.0、HTTP/1.1或HTTP/2</span></span>
<span class="line"><span style="color:#BABED8;">$uri </span><span style="color:#676E95;font-style:italic;">#请求中的当前 URI(不带请求参数，参数位于 args ) ， 不 同 于 浏 览 器 传 递 的 args)，不同于浏览器传递的 args)，不同于浏览器传递的 request_uri 的值，它可以通过内部重定向，或者使用 index 指令进行修改。不包括协议和主机名，例如 /foo/bar.html</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="参考文档" tabindex="-1">参考文档 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档&quot;">​</a></h2><ul><li><a href="https://nginx.org/en/" target="_blank" rel="noreferrer">Nginx官方文档</a></li><li><a href="https://nginx.org/en/docs/" target="_blank" rel="noreferrer">Nginx手册</a></li></ul><!--[--><div class="reward-divider"></div><figure><figcaption> 若您在阅读过程中发现一些错误：如语句不通、文字、逻辑等错误，可以在评论区指出，我会及时调整修改，感谢您的阅读。同时您觉得这篇文章对您有帮助的话，可以打赏作者一笔作为鼓励，金额不限，感谢支持🤝。 </figcaption><div style="text-align:center;margin-top:2em;"><img style="display:inline;" src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/005HV6Avgy1h72anu40usj30dw0dw40j.jpg" width="200" alt="支付宝捐赠"><img style="display:inline;" src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/005HV6Avgy1h72ap99ym1j30b40b4abq.jpg" width="200" alt="微信支付捐赠"></div></figure><div class="reward-divider"></div><div class="share_wrap"><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-weibo.png" alt="share to weibo" title="分享到微博"></a><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-twitter.png" alt="share to twitter" title="分享到twitter"></a><a href="#" target="_blank"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-facebook.png" alt="share to facebook" title="分享到facebook"></a></div><!--]--><!----></div></div></main><footer class="VPDocFooter" data-v-fb80de84 data-v-a4d10c8e><!--[--><!--]--><div class="edit-info" data-v-a4d10c8e><!----><div class="last-updated" data-v-a4d10c8e><p class="VPLastUpdated" data-v-a4d10c8e data-v-86563300>最近更新: <time datetime="2024-03-03T04:31:19.000Z" data-v-86563300></time></p></div></div><nav class="prev-next" data-v-a4d10c8e><div class="pager" data-v-a4d10c8e><a class="VPLink link pager-link prev" href="/frontend/performance/node-score.html" data-v-a4d10c8e><!--[--><span class="desc" data-v-a4d10c8e>Previous page</span><span class="title" data-v-a4d10c8e>node评分指标</span><!--]--></a></div><div class="pager" data-v-a4d10c8e><a class="VPLink link pager-link next" href="/frontend/pattern/base.html" data-v-a4d10c8e><!--[--><span class="desc" data-v-a4d10c8e>Next page</span><span class="title" data-v-a4d10c8e>Design Pattern</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-e69ff593 data-v-e09097b5><div class="container" data-v-e09097b5><p class="message" data-v-e09097b5>Released under the MIT License.</p><p class="copyright" data-v-e09097b5>Copyright © 2018-2024 HengShuai</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"frontend_babel_babel-analysis.md\":\"wGpC9j4r\",\"frontend_babel_babel-plugin-guide.md\":\"ppFJFpUc\",\"frontend_babel_base.md\":\"vrUaWuJ_\",\"frontend_base.md\":\"dwQglb_Z\",\"frontend_browser_base.md\":\"8v9kmWYQ\",\"frontend_building-tool_base.md\":\"IZjj-1k_\",\"frontend_canvas_base.md\":\"4FFeOXMN\",\"frontend_canvas_magic-effects.md\":\"d72-kJZY\",\"frontend_cli_index.md\":\"LW95mYz4\",\"frontend_compiler_index.md\":\"kb3LvP4F\",\"article_2021_vue-img-lazyload.md\":\"nS2xctKa\",\"frontend_computer-network_arp-protocol.md\":\"Kq6yx99o\",\"article_2020_vscode-shortcut.md\":\"9YPtkAQd\",\"article_2020_web-cache.md\":\"tgnHisxs\",\"article_2019_mysql-guide.md\":\"sVywMOTl\",\"article_2021_pwa-app.md\":\"OleMbyZc\",\"article_2021_vue-core-process.md\":\"lvBKNU2P\",\"article_2019_js-type-transfer.md\":\"6bgN44L7\",\"frontend_computer-network_base.md\":\"rscsR2cq\",\"article_base.md\":\"MRVl6scQ\",\"article_2022_emoji-markup.md\":\"OhV-I-1u\",\"article_2019_what-bfc.md\":\"3X8ih4fR\",\"article_2021_ts-decorator.md\":\"t9oGw5oN\",\"article_2020_webpack-guide.md\":\"4hgG0rTv\",\"article_2021_js-pattern.md\":\"s7bHowR9\",\"article_2021_flex-layout.md\":\"Svx6-bGi\",\"article_2019_nvm-guide.md\":\"DOn-ZyKp\",\"article_2019_ktv-system.md\":\"8zwU_3Hs\",\"article_2020_optimize-web-server.md\":\"zI4x4pon\",\"article_2019_css-center.md\":\"39T7ILEY\",\"article_2020_domparser-xml.md\":\"14rZ0LzC\",\"frontend_nginx_base.md\":\"zoU8TEMt\",\"article_2019_promise.md\":\"PPpH3Goo\",\"article_2019_bind-call-apply.md\":\"sKjhWUC_\",\"article_2019_js-copy.md\":\"aASz1f6e\",\"article_2020_regexp-guide.md\":\"Hz2CcED7\",\"article_2021_performance-tools.md\":\"f1ArMVK_\",\"frontend_performance_chunk-upload.md\":\"_H6a4GPM\",\"frontend_performance_load-perf.md\":\"GBvTUzYN\",\"frontend_performance_network-perf.md\":\"5sGmco83\",\"frontend_performance_cache.md\":\"GADg4UGM\",\"frontend_performance_performance.md\":\"eTHaQNUO\",\"frontend_performance_range-download.md\":\"hDSmWOR2\",\"frontend_performance_secure-perf.md\":\"1SJRKrnr\",\"frontend_performance_seo.md\":\"nVWyT-cr\",\"frontend_performance_virtual-scroll-1.md\":\"GMhzOTOC\",\"frontend_performance_virtual-scroll-2.md\":\"Tf9Xw2tC\",\"frontend_performance_web-score.md\":\"t6trh2aX\",\"frontend_project-integration_base.md\":\"H9p7xZIC\",\"frontend_project-integration_build-tool.md\":\"YEHYzLz2\",\"frontend_debug-skill_base.md\":\"ardgOXee\",\"frontend_debug-skill_charles.md\":\"c860e4Ce\",\"frontend_debug-skill_chrome.md\":\"VolKnY9H\",\"frontend_computer-network_ip-protocol.md\":\"cYsrbBjs\",\"frontend_project-integration_debugger-skill.md\":\"gdFZBkWV\",\"frontend_project-integration_deploy-specification.md\":\"TAZbHJxr\",\"frontend_project-integration_framework.md\":\"5X0ugAP5\",\"frontend_project-integration_git-commit.md\":\"hau9b8OP\",\"frontend_project-integration_monorepo.md\":\"vk1tlUoK\",\"frontend_project-integration_specification.md\":\"FUpSWKJb\",\"frontend_project-integration_style.md\":\"6YvYxYxO\",\"frontend_react_index.md\":\"WCWdbrtn\",\"frontend_regexp_base.md\":\"bxZXRG-x\",\"frontend_render-mode_base.md\":\"awKqNZtj\",\"frontend_sandbox_index.md\":\"gXXOpt2O\",\"frontend_ts_base.md\":\"EsuvODQ8\",\"frontend_vue_computed-watch.md\":\"ViMqGS60\",\"frontend_vue_pinia.md\":\"sFmcIG8v\",\"frontend_vue_router.md\":\"oywyEaoK\",\"frontend_vue_slot.md\":\"-cpDvOd1\",\"frontend_vue_template-compiler.md\":\"BoDuPu-F\",\"frontend_vue_transition.md\":\"oLOqknqJ\",\"frontend_debug-skill_h5.md\":\"JqHXkiol\",\"frontend_vue_update-process.md\":\"k6l2RNx4\",\"frontend_debug-skill_vscode.md\":\"bJXMRiLv\",\"frontend_vue_vuex.md\":\"mDVwtyM1\",\"frontend_wasm_base.md\":\"wKzjPpun\",\"frontend_debug-skill_wireshark.md\":\"h-Af8Z2N\",\"frontend_desktop-app_index.md\":\"CwmxVITt\",\"frontend_webpack_webpack-analysis.md\":\"B7vs5RGV\",\"frontend_editor_index.md\":\"Z3QRmU7I\",\"frontend_webpack_webpack-loader.md\":\"H5WVjPyO\",\"frontend_js_async.md\":\"xM2atz8E\",\"frontend_node-bff_index.md\":\"uvIlJlnt\",\"frontend_js_audio.md\":\"SxVGBXDx\",\"frontend_webpack_webpack-node.md\":\"wv3teGYs\",\"frontend_js_base.md\":\"xDEIN0Le\",\"frontend_webpack_webpack-plugin.md\":\"9tSSq7pn\",\"fullstack_base.md\":\"I4wE93qI\",\"fullstack_docker_base-tutorial.md\":\"9ZJDDyO1\",\"fullstack_docker_docker-compose.md\":\"zjlwGtUy\",\"frontend_js_binary.md\":\"APMVe8ro\",\"fullstack_docker_docker-repository.md\":\"wBmXzDQl\",\"frontend_js_eventloop.md\":\"F1aGIeQj\",\"frontend_js_implicit-conversion.md\":\"z9evaHOi\",\"fullstack_docker_dockerfile.md\":\"3YPLdvgt\",\"frontend_js_js-gc.md\":\"zQJ4SnO7\",\"frontend_js_meta-coding.md\":\"doArwweu\",\"fullstack_docker_install-configure.md\":\"ycQmqQb6\",\"frontend_lowcoding_base.md\":\"1AMtoVOM\",\"frontend_micro-frontend_base.md\":\"VCogbXGF\",\"frontend_monitor_base.md\":\"1PrBd---\",\"fullstack_docker_network.md\":\"sG-Vuzgw\",\"fullstack_docker_npm-repository.md\":\"xNRdDnzE\",\"fullstack_docker_volume-store.md\":\"AmWixEc_\",\"frontend_nestjs_swagger.md\":\"Miz3IuZP\",\"fullstack_gitlab_gitlab-pipeline.md\":\"2PnzZMhY\",\"fullstack_gitlab_gitlab-runner-install-configure.md\":\"AcLdY8_f\",\"fullstack_gitlab_install-configure.md\":\"hsqEggJv\",\"frontend_nestjs_base.md\":\"GEmB31Yt\",\"frontend_nestjs_mvc.md\":\"G7xy_a_Y\",\"frontend_nestjs_useful.md\":\"5BxCDwjN\",\"frontend_node-optimize_index.md\":\"9iTkxv8U\",\"frontend_node_base.md\":\"f045EATv\",\"frontend_node_node-debug.md\":\"VzMrpiGN\",\"fullstack_k8s_install.md\":\"shPzlnU9\",\"frontend_node_node-web.md\":\"BA0Qp_xe\",\"frontend_performance_node-score.md\":\"GHFkv_LH\",\"frontend_npm_index.md\":\"cPGRzDNd\",\"frontend_performance_base.md\":\"boqnWWao\",\"frontend_performance_cache-perf.md\":\"c67R59ai\",\"index.md\":\"DNChHY-j\",\"me.md\":\"9KzOPl0U\",\"super-nav_index.md\":\"sa1sp0Lq\",\"talk_2023_dad-foot-injured.md\":\"e316_81h\",\"talk_2023_lose-qoo-job.md\":\"wc9xrS2F\",\"talk_2023_love-4th-anniversary.md\":\"EL8i9jjc\",\"talk_2023_second-covid.md\":\"DQ3RHk2a\",\"talk_base.md\":\"bc9zk1r_\",\"frontend_computer-network_http-protocol.md\":\"bfrkeSkr\",\"frontend_project-integration_choose-editor.md\":\"0gNbjQse\",\"frontend_project-integration_ci-pipeline.md\":\"qrLOyYjp\",\"frontend_flutter_base.md\":\"yyvMr_gq\",\"frontend_node_node-framework.md\":\"G8o8zeYS\",\"frontend_debug-skill_fiddler.md\":\"NqneAeW9\",\"frontend_js_proto-inherit.md\":\"E5dVTnVb\",\"frontend_micro-program_index.md\":\"yyQYNhB6\",\"frontend_vue_reactivity.md\":\"9xkgqhJY\",\"frontend_webpack_base.md\":\"C2knYA00\",\"frontend_hybrid-app_base.md\":\"-Vm4xYDr\",\"frontend_node_node-measure.md\":\"4GqjVgP8\",\"frontend_node_node-process.md\":\"Ps4VtoHq\",\"frontend_project-integration_test-framework.md\":\"zZle5pVy\",\"frontend_computer-network_tcp-protocol.md\":\"fep1PHVR\",\"frontend_ts_ts-configure.md\":\"rAao85Hb\",\"frontend_visual_index.md\":\"qSiOl_Sl\",\"frontend_vue_component-render.md\":\"ZCTZuvWu\",\"frontend_js_scope-closure.md\":\"5EWzSuzB\",\"fullstack_k8s_base.md\":\"3Tzy-t_S\",\"fullstack_gitlab_npm-repository.md\":\"vjG8GM3X\",\"frontend_pattern_base.md\":\"GAbsFqbU\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"hengshuai's blog\",\"description\":\"大家好我是卫恒帅，这是我的个人博客，在这里我会分享web开发相关技能经验，也有自己的一些生活所思所悟，希望对你有所帮助，如你感觉不错可以将本站收藏！\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"dark\",\"themeConfig\":{\"externalLinkIcon\":true,\"logoLink\":\"/\",\"siteTitle\":\"Hengshuai's blog\",\"outline\":[2,3],\"outlineTitle\":\"目录\",\"nav\":[{\"text\":\"Frontend\",\"link\":\"/frontend/base.html\",\"activeMatch\":\"/frontend/base\"},{\"text\":\"Fullstack\",\"link\":\"/fullstack/base.html\",\"activeMatch\":\"/fullstack/base\"},{\"text\":\"Article\",\"link\":\"/article/base.html\",\"activeMatch\":\"/article/base\"},{\"text\":\"Case\",\"link\":\"https://case.usword.cn\"},{\"text\":\"Me\",\"link\":\"/me.html\",\"activeMatch\":\"/me\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/ihengshuai\"}],\"sidebar\":{\"/frontend/\":[{\"collapsible\":true,\"items\":[{\"text\":\"Javascript\",\"collapsed\":false,\"link\":\"/frontend/js/base.html\",\"items\":[{\"text\":\"原型、原型链与继承\",\"link\":\"/frontend/js/proto-inherit.html\"},{\"text\":\"作用域(链)、执行上下文及闭包\",\"link\":\"/frontend/js/scope-closure.html\"},{\"text\":\"类型隐式转换\",\"link\":\"/frontend/js/implicit-conversion.html\"},{\"text\":\"事件循环(EventLoop)\",\"link\":\"/frontend/js/eventloop.html\"},{\"text\":\"异步编程\",\"link\":\"/frontend/js/async.html\"},{\"text\":\"元编程\",\"link\":\"/frontend/js/meta-coding.html\"},{\"text\":\"二进制\",\"link\":\"/frontend/js/binary.html\"},{\"text\":\"音视频\",\"link\":\"/frontend/js/audio.html\"},{\"text\":\"垃圾回收\",\"link\":\"/frontend/js/js-gc.html\"}]},{\"text\":\"Browser\",\"link\":\"/frontend/browser/base.html\"},{\"text\":\"Vue\",\"collapsed\":true,\"items\":[{\"text\":\"响应式原理\",\"link\":\"/frontend/vue/reactivity.html\"},{\"text\":\"计算属性与侦听函数\",\"link\":\"/frontend/vue/computed-watch.html\"},{\"text\":\"模板编译\",\"link\":\"/frontend/vue/template-compiler.html\"},{\"text\":\"组件创建与渲染\",\"link\":\"/frontend/vue/component-render.html\"},{\"text\":\"视图更新流程\",\"link\":\"/frontend/vue/update-process.html\"},{\"text\":\"插槽原理\",\"link\":\"/frontend/vue/slot.html\"},{\"text\":\"实现过渡\",\"link\":\"/frontend/vue/transition.html\"},{\"text\":\"vuex内幕\",\"link\":\"/frontend/vue/vuex.html\"},{\"text\":\"pinia原理\",\"link\":\"/frontend/vue/pinia.html\"},{\"text\":\"路由实现\",\"link\":\"/frontend/vue/router.html\"}]},{\"text\":\"Regexp\",\"link\":\"/frontend/regexp/base.html\"},{\"text\":\"Babel\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/babel/base.html\"},{\"text\":\"原理分析\",\"link\":\"/frontend/babel/babel-analysis.html\"},{\"text\":\"自定义插件\",\"link\":\"/frontend/babel/babel-plugin-guide.html\"}]},{\"text\":\"Webpack\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/webpack/base.html\"},{\"text\":\"自定义loader\",\"link\":\"/frontend/webpack/webpack-loader.html\"},{\"text\":\"自定义插件\",\"link\":\"/frontend/webpack/webpack-plugin.html\"},{\"text\":\"结合node使用\",\"link\":\"/frontend/webpack/webpack-node.html\"},{\"text\":\"原理分析\",\"link\":\"/frontend/webpack/webpack-analysis.html\"}]},{\"text\":\"Building Tool\",\"link\":\"/frontend/building-tool/base.html\"},{\"text\":\"Debug Skill\",\"collapsed\":true,\"link\":\"/frontend/debug-skill/base.html\",\"items\":[{\"text\":\"Chrome\",\"link\":\"/frontend/debug-skill/chrome.html\"},{\"text\":\"Vscode\",\"link\":\"/frontend/debug-skill/vscode.html\"},{\"text\":\"Fiddler\",\"link\":\"/frontend/debug-skill/fiddler.html\"},{\"text\":\"Charles\",\"link\":\"/frontend/debug-skill/charles.html\"},{\"text\":\"Wireshark\",\"link\":\"/frontend/debug-skill/wireshark.html\"},{\"text\":\"H5\",\"link\":\"/frontend/debug-skill/h5.html\"}]},{\"text\":\"NodeJS\",\"collapsed\":true,\"items\":[{\"text\":\"基本使用\",\"link\":\"/frontend/node/base.html\"},{\"text\":\"web服务\",\"link\":\"/frontend/node/node-web.html\"},{\"text\":\"多进程与多线程\",\"link\":\"/frontend/node/node-process.html\"},{\"text\":\"常见框架\",\"link\":\"/frontend/node/node-framework.html\"},{\"text\":\"调试技巧\",\"link\":\"/frontend/node/node-debug.html\"},{\"text\":\"性能优化\",\"link\":\"/frontend/node/node-measure.html\"}]},{\"text\":\"Typescript\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/ts/base.html\"},{\"text\":\"2.配置文件\",\"link\":\"/frontend/ts/ts-configure.html\"}]},{\"text\":\"NestJS\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/nestjs/base.html\"},{\"text\":\"2.搭建web服务\",\"link\":\"/frontend/nestjs/mvc.html\"},{\"text\":\"3.swagger文档\",\"link\":\"/frontend/nestjs/swagger.html\"},{\"text\":\"4.实用手册\",\"link\":\"/frontend/nestjs/useful.html\"}]},{\"text\":\"Render Mode\",\"link\":\"/frontend/render-mode/base.html\"},{\"text\":\"Canvas\",\"collapsed\":true,\"items\":[{\"text\":\"1.基本使用\",\"link\":\"/frontend/canvas/base.html\"},{\"text\":\"2.炫酷特效\",\"link\":\"/frontend/canvas/magic-effects.html\"}]},{\"text\":\"Project Integration\",\"collapsed\":true,\"items\":[{\"text\":\"1.项目集成\",\"link\":\"/frontend/project-integration/base.html\"},{\"text\":\"2.编辑器之争\",\"link\":\"/frontend/project-integration/choose-editor.html\"},{\"text\":\"3.框架选型\",\"link\":\"/frontend/project-integration/framework.html\"},{\"text\":\"4.打包工具\",\"link\":\"/frontend/project-integration/build-tool.html\"},{\"text\":\"5.语法规范\",\"link\":\"/frontend/project-integration/specification.html\"},{\"text\":\"6.风格指南\",\"link\":\"/frontend/project-integration/style.html\"},{\"text\":\"7.提交规范\",\"link\":\"/frontend/project-integration/git-commit.html\"},{\"text\":\"8.monorepo\",\"link\":\"/frontend/project-integration/monorepo.html\"},{\"text\":\"9.自动化测试\",\"link\":\"/frontend/project-integration/test-framework.html\"},{\"text\":\"10.发布规范\",\"link\":\"/frontend/project-integration/deploy-specification.html\"},{\"text\":\"11.调试技巧\",\"link\":\"/frontend/project-integration/debugger-skill.html\"},{\"text\":\"12.自动化\",\"link\":\"/frontend/project-integration/ci-pipeline.html\"}]},{\"text\":\"Computer Network\",\"collapsed\":true,\"link\":\"/frontend/computer-network/base.html\",\"items\":[{\"text\":\"TCP协议\",\"link\":\"/frontend/computer-network/tcp-protocol.html\"},{\"text\":\"HTTP协议\",\"link\":\"/frontend/computer-network/http-protocol.html\"},{\"text\":\"IP协议\",\"link\":\"/frontend/computer-network/ip-protocol.html\"},{\"text\":\"ARP协议\",\"link\":\"/frontend/computer-network/arp-protocol.html\"}]},{\"text\":\"Performance\",\"collapsed\":true,\"items\":[{\"text\":\"前言\",\"link\":\"/frontend/performance/base.html\"},{\"text\":\"大文件上传\",\"link\":\"/frontend/performance/chunk-upload.html\"},{\"text\":\"大文件下载\",\"link\":\"/frontend/performance/range-download.html\"},{\"text\":\"虚拟滚动一\",\"link\":\"/frontend/performance/virtual-scroll-1.html\"},{\"text\":\"虚拟滚动二\",\"link\":\"/frontend/performance/virtual-scroll-2.html\"},{\"text\":\"网络优化\",\"link\":\"/frontend/performance/network-perf.html\"},{\"text\":\"加载优化\",\"link\":\"/frontend/performance/load-perf.html\"},{\"text\":\"缓存优化\",\"link\":\"/frontend/performance/cache-perf.html\"},{\"text\":\"安全优化\",\"link\":\"/frontend/performance/secure-perf.html\"},{\"text\":\"SEO优化\",\"link\":\"/frontend/performance/seo.html\"},{\"text\":\"Performance工具\",\"link\":\"/frontend/performance/performance.html\"},{\"text\":\"web评分指标\",\"link\":\"/frontend/performance/web-score.html\"},{\"text\":\"node评分指标\",\"link\":\"/frontend/performance/node-score.html\"}]},{\"text\":\"Nginx\",\"link\":\"/frontend/nginx/base.html\"},{\"text\":\"Design Pattern\",\"link\":\"/frontend/pattern/base.html\"},{\"text\":\"Monitor\",\"link\":\"/frontend/monitor/base.html\"},{\"text\":\"Micro Frontend\",\"link\":\"/frontend/micro-frontend/base.html\"},{\"text\":\"Webassembly\",\"link\":\"/frontend/wasm/base.html\"},{\"text\":\"Hybrid App\",\"link\":\"/frontend/hybrid-app/base.html\"},{\"text\":\"Flutter\",\"link\":\"/frontend/flutter/base.html\"}]}],\"/fullstack/\":[{\"text\":\"Docker\",\"items\":[{\"items\":[{\"text\":\"Docker安装与配置\",\"link\":\"/fullstack/docker/install-configure.html\"},{\"text\":\"Docker基础教程\",\"link\":\"/fullstack/docker/base-tutorial.html\"},{\"text\":\"Docker数据卷与持久化\",\"link\":\"/fullstack/docker/volume-store.html\"},{\"text\":\"Docker网络原理\",\"link\":\"/fullstack/docker/network.html\"},{\"text\":\"使用Dockerfile构建镜像\",\"link\":\"/fullstack/docker/dockerfile.html\"},{\"text\":\"使用DockerCompose部署服务\",\"link\":\"/fullstack/docker/docker-compose.html\"},{\"text\":\"使用Docker搭建npm仓库\",\"link\":\"/fullstack/docker/npm-repository.html\"},{\"text\":\"搭建docker私有仓库\",\"link\":\"/fullstack/docker/docker-repository.html\"}]}]},{\"text\":\"Gitlab\",\"items\":[{\"items\":[{\"text\":\"安装与配置\",\"link\":\"/fullstack/gitlab/install-configure.html\"},{\"text\":\"Gitlab Runner安装与配置\",\"link\":\"/fullstack/gitlab/gitlab-runner-install-configure.html\"},{\"text\":\"Gitlab流水线配置\",\"link\":\"/fullstack/gitlab/gitlab-pipeline.html\"},{\"text\":\"Gitlab搭建npm仓库\",\"link\":\"/fullstack/gitlab/npm-repository.html\"}]}]},{\"text\":\"Kubernetes\",\"items\":[{\"items\":[{\"text\":\"初识kubernetes\",\"link\":\"/fullstack/k8s/base.html\"},{\"text\":\"搭建k8s集群\",\"link\":\"/fullstack/k8s/install.html\"}]}]}],\"/article/\":[{\"text\":\"2022\",\"items\":[{\"items\":[{\"text\":\"emoji markup\",\"link\":\"/article/2022/emoji-markup.html\"}]}]},{\"text\":\"2021\",\"items\":[{\"items\":[{\"text\":\"PWA渐进式应用\",\"link\":\"/article/2021/pwa-app.html\"},{\"text\":\"前端性能测试工具\",\"link\":\"/article/2021/performance-tools.html\"},{\"text\":\"Typescript装饰器指南\",\"link\":\"/article/2021/ts-decorator.html\"},{\"text\":\"手写vue图片懒加载插件\",\"link\":\"/article/2021/vue-img-lazyload.html\"},{\"text\":\"谈谈vue内部运行机制\",\"link\":\"/article/2021/vue-core-process.html\"},{\"text\":\"JS中的设计模式\",\"link\":\"/article/2021/js-pattern.html\"},{\"text\":\"flex布局\",\"link\":\"/article/2021/flex-layout.html\"}]}]},{\"text\":\"2020\",\"items\":[{\"items\":[{\"text\":\"关于DOMParser、XMLSerializer、createTreeWalker使用\",\"link\":\"/article/2020/domparser-xml.html\"},{\"text\":\"vscode快捷键\",\"link\":\"/article/2020/vscode-shortcut.html\"},{\"text\":\"优化改善网页的加载及性能\",\"link\":\"/article/2020/optimize-web-server.html\"},{\"text\":\"深入浅出RegExp\",\"link\":\"/article/2020/regexp-guide.html\"},{\"text\":\"从零配置webpack工程\",\"link\":\"/article/2020/webpack-guide.html\"},{\"text\":\"web缓存策略\",\"link\":\"/article/2020/web-cache.html\"}]}]},{\"text\":\"2019\",\"items\":[{\"items\":[{\"text\":\"nvm使用技巧\",\"link\":\"/article/2019/nvm-guide.html\"},{\"text\":\"MySQL从入门到放弃\",\"link\":\"/article/2019/mysql-guide.html\"},{\"text\":\"7天撸完ktv点歌系统\",\"link\":\"/article/2019/ktv-system.html\"},{\"text\":\"css的10中居中方式\",\"link\":\"/article/2019/css-center.html\"},{\"text\":\"Promise使用与原理\",\"link\":\"/article/2019/promise.html\"},{\"text\":\"JS隐式转换\",\"link\":\"/article/2019/js-type-transfer.html\"},{\"text\":\"什么是BFC\",\"link\":\"/article/2019/what-bfc.html\"},{\"text\":\"JS深浅拷贝\",\"link\":\"/article/2019/js-copy.html\"},{\"text\":\"bind、call、apply使用技巧\",\"link\":\"/article/2019/bind-call-apply.html\"}]}]}],\"/talk/\":[{\"items\":[{\"items\":[{\"text\":\"我也赶上了裁员\",\"link\":\"/talk/2023/lose-qoo-job.html\"},{\"text\":\"我爸脚受伤了\",\"link\":\"/talk/2023/dad-foot-injured.html\"},{\"text\":\"二🐑了\",\"link\":\"/talk/2023/second-covid.html\"}]}]}]},\"lastUpdated\":{\"text\":\"最近更新\",\"formatOptions\":{\"dateStyle\":\"medium\"}},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2018-2024 HengShuai\"},\"search\":{\"options\":{\"detailedView\":true,\"miniSearch\":{\"searchOptions\":{\"fields\":[\"title\",\"text\"]}}},\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>