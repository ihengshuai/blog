import{_ as p,c as e,J as s,V as o,o as t,G as n}from"./chunks/framework.SV1ROkXV.js";const g=JSON.parse('{"title":"Gitlab搭建npm仓库","description":"如何使用Gitlab搭建npm仓库,通过以下这些步骤帮你快速搭建","frontmatter":{"title":"Gitlab搭建npm仓库","description":"如何使用Gitlab搭建npm仓库,通过以下这些步骤帮你快速搭建","keywords":"npm私有仓库,搭建npm仓库,gitlab仓库,gitlab搭建npm仓库","logo":"https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/icon-npm.png"},"headers":[],"relativePath":"fullstack/gitlab/npm-repository.md","filePath":"fullstack/gitlab/npm-repository.md","lastUpdated":1709440279000}'),r={name:"fullstack/gitlab/npm-repository.md"},c=o(`<h1 id="gitlab搭建npm仓库" tabindex="-1">Gitlab搭建npm仓库 <a class="header-anchor" href="#gitlab搭建npm仓库" aria-label="Permalink to &quot;Gitlab搭建npm仓库&quot;">​</a></h1><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>使用gitlab的仓库注册表特性需要版本<code>14.0+</code>，如果你的版本比较低，请先根据自己的需求合理升级后再使用</p></div><p>npm私有仓库的搭建方式有很多种，比如使用<a href="/fullstack/docker/npm-repository.html">docker(阅读此篇)</a>，这里讲述如何使用gitlab作为npm仓库方法，gitlab仓库有多种使用方法，这里都会讲解到。接下来就来学习下如何使用gitlab搭建npm仓库。</p><h2 id="创建组与项目" tabindex="-1">创建组与项目 <a class="header-anchor" href="#创建组与项目" aria-label="Permalink to &quot;创建组与项目&quot;">​</a></h2><p>为了方便演示这里从头讲起，分别创建组、项目</p><ol><li>创建组 <img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321112321027.png" alt="image-20230321112321027"></li><li>创建项目 <img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321112503456.png" alt="image-20230321112503456"><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321112816193.png" alt="image-20230321112816193"></li></ol><h2 id="初始化项目" tabindex="-1">初始化项目 <a class="header-anchor" href="#初始化项目" aria-label="Permalink to &quot;初始化项目&quot;">​</a></h2><p>本地创建一个简单的项目，推送到gitlab项目中</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 创建路径</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#C3E88D;"> gitlab-frontend-helper-lib </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#FFCB6B;"> ccd</span><span style="color:#C3E88D;"> gitlab-frontend-helper-lib</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 初始化 npm</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> init</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>package.json</code>文件内容实例：</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">helper</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">0.0.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">前端通用库</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [],</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">license</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">ISC</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>创建<code>index.js</code>文件：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> add </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">x</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> y</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#BABED8;"> x </span><span style="color:#89DDFF;">+</span><span style="color:#BABED8;"> y</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> minus </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;"> (</span><span style="color:#BABED8;font-style:italic;">x</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;font-style:italic;"> y</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;"> =&gt;</span><span style="color:#BABED8;"> x </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> y</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> {</span><span style="color:#BABED8;"> add</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> minus </span><span style="color:#89DDFF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>推送项目到gitlab</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> init</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> .gitignore </span><span style="color:#89DDFF;">&lt;&lt;</span><span style="color:#89DDFF;"> EOF</span></span>
<span class="line"><span style="color:#C3E88D;">node_modules</span></span>
<span class="line"><span style="color:#C3E88D;">.DS_Store</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> add .</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> cm -m </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">初次提交(#0)</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> remote add origin http://192.168.10.10/frontend-lib/helper.git</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> push --set-upstream origin main</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="项目作为依赖" tabindex="-1">项目作为依赖 <a class="header-anchor" href="#项目作为依赖" aria-label="Permalink to &quot;项目作为依赖&quot;">​</a></h2><p>你可以在某个项目中把刚刚上传的项目作为依赖安装，为了方便管理可以对上传的库打上<code>tag</code>，然后项目中可以下载指定tag</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># gitlab-frontend-helper-lib 打tag</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> tag </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">.1</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> push --tags</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>新建一个项目使用当前库：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#C3E88D;"> gitlab-npm </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#82AAFF;"> cd</span><span style="color:#C3E88D;"> gitlab-npm </span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> init -y</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>手动在<code>package.json</code>文件中添加待安装的依赖项目</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">gitlab-npm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">echo </span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;">Error: no test specified</span><span style="color:#BABED8;">\\&quot;</span><span style="color:#C3E88D;"> &amp;&amp; exit 1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  },</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [],</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">license</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">ISC</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">dependencies</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    // 这里指定 helper依赖的地址为 git+http://192.168.10.10/frontend-lib/helper.git，并使用 tag 0.0.1版本</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#FFCB6B;">helper</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">git+http://192.168.10.10/frontend-lib/helper.git#0.0.1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  },</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>安装当前项目依赖：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> npm i</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice created a lockfile as package-lock.json. You should commit this file.</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> WARN use-gitlab-npm@1.0.0 No description</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> WARN use-gitlab-npm@1.0.0 No repository field.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">added</span><span style="color:#F78C6C;"> 1</span><span style="color:#C3E88D;"> package in </span><span style="color:#F78C6C;">0.577</span><span style="color:#C3E88D;">s</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>验证<code>helper</code>包，创建js文件</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">// index.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> helper </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">helper</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(helper</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;"> 2</span><span style="color:#BABED8;">))</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>执行打印</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">node</span><span style="color:#C3E88D;"> index.js // </span><span style="color:#F78C6C;">3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这种方式的使用比较简单，不过不够灵活，接下来使用gitlab官方的仓库注册表</p><h2 id="gitlab软件库" tabindex="-1">Gitlab软件库 <a class="header-anchor" href="#gitlab软件库" aria-label="Permalink to &quot;Gitlab软件库&quot;">​</a></h2><p><a href="https://docs.gitlab.com/ee/user/packages/npm_registry/" target="_blank" rel="noreferrer">Gitlab支持包仓库注册了</a>，也及时可以当做包仓库使用，需要版本<code>14.0+</code>，这里演示<a href="https://docs.gitlab.com/ee/user/packages/npm_registry/" target="_blank" rel="noreferrer">npm仓库注册表</a>来管理npm包</p><h3 id="注册表类型" tabindex="-1">注册表类型 <a class="header-anchor" href="#注册表类型" aria-label="Permalink to &quot;注册表类型&quot;">​</a></h3><p>gitlab支持两种的仓库注册表<a href="https://docs.gitlab.com/ee/user/packages/npm_registry/#naming-convention" target="_blank" rel="noreferrer">项目级别和示例级别(组级别)</a>，两者对于包的上传没有什么影响，只是作用于包的安装，包的注册表名字是scope形式，也就是说包名是<code>@scope/packageName</code>这种形式</p><ul><li>实例级别：你可以理解为group级别，必须提供一个范围的scope名字，当你需要在不同的组创建包时，可以使用@scope/packageName 引入，你可以为不同的组设置权限，公开使用</li><li>项目级别：注册表 URL仅针对该范围更新。在项目级别注册包时，您可以使用/附加您自己的唯一范围到您的包名称</li></ul><h3 id="发布准备" tabindex="-1">发布准备 <a class="header-anchor" href="#发布准备" aria-label="Permalink to &quot;发布准备&quot;">​</a></h3><p>这里修改前面的仓库</p><div class="language-json line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">// package.json</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 包名</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">@frontend-lib/helper</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">  // 包版本</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">0.0.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">前端通用库</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> [],</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#C792EA;">license</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">ISC</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>创建<code>.npmrc</code>文件：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;">#@scope:registry=https://your_domain_name/api/v4/projects/your_project_id/packages/npm/</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#//your_domain_name/api/v4/projects/your_project_id/packages/npm/:_authToken=&quot;\${NPM_TOKEN}&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 格式:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#  - scope：你的scopename</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#  - your_domain_name：你的gitlab域名或ip</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#  - your_project_id：你的仓库id</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#  - NPM_TOKEN：用户发布的用户token</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 示例</span></span>
<span class="line"><span style="color:#FFCB6B;">@frontend-lib:registry</span><span style="color:#BABED8;">=http://192.168.10.10/api/v4/projects/4/packages/npm/</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 你可以直接将token写在这里</span></span>
<span class="line"><span style="color:#FFCB6B;">//192.168.10.10/api/v4/projects/4/packages/npm/:_authToken</span><span style="color:#BABED8;">=HUzUdsos4WfnsgfUBi6j</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>记得忽略掉<code>.npmrc</code>追踪：</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># .gitignore</span></span>
<span class="line"><span style="color:#FFCB6B;">.npmrc</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="发布npm包" tabindex="-1">发布npm包 <a class="header-anchor" href="#发布npm包" aria-label="Permalink to &quot;发布npm包&quot;">​</a></h2><p>发布npm包可以手动发布也可以自动构建发布，两种方式都演示下。本次演示项目上传至github了</p><ul><li><a href="https://github.com/ihengshuai/gitlab-practice/tree/main/gitlab-frontend-helper-lib" target="_blank" rel="noreferrer">https://github.com/ihengshuai/gitlab-practice/tree/main/gitlab-frontend-helper-lib</a></li><li><a href="https://github.com/ihengshuai/gitlab-practice/tree/main/gitlab-npm" target="_blank" rel="noreferrer">https://github.com/ihengshuai/gitlab-practice/tree/main/gitlab-npm</a></li></ul><h3 id="手动发布" tabindex="-1">手动发布 <a class="header-anchor" href="#手动发布" aria-label="Permalink to &quot;手动发布&quot;">​</a></h3><p>创建token</p><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321124138019.png" alt="image-20230321124138019"></p><p>拿到token后将其写入<code>.npmrc</code>文件中</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 如果没有将token写入npmrc，可以用命令行传入</span></span>
<span class="line"><span style="color:#BABED8;">NPM_TOKEN</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">HUzUdsos4WfnsgfUBi6j npm publish</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 这里写入了npmrc，然后发布</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> npm publish</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice 📦  @frontend-lib/helper@0.0.1</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice === Tarball Contents === </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice </span><span style="color:#F78C6C;">94</span><span style="color:#C3E88D;">B  index.js    </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice </span><span style="color:#F78C6C;">171</span><span style="color:#C3E88D;">B package.json</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice </span><span style="color:#F78C6C;">15</span><span style="color:#C3E88D;">B  README.md   </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice === Tarball Details === </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice name:          @frontend-lib/helper                    </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice version:       </span><span style="color:#F78C6C;">0.0</span><span style="color:#C3E88D;">.1                                   </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice package size:  </span><span style="color:#F78C6C;">369</span><span style="color:#C3E88D;"> B                                   </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice unpacked size: </span><span style="color:#F78C6C;">280</span><span style="color:#C3E88D;"> B                                   </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice shasum:        </span><span style="color:#F78C6C;">25</span><span style="color:#C3E88D;">bcde10511ed5f253bdf2761f86a92d62959847</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice integrity:     sha512-0spZZ3DBZZhpM[...]yDmfOTOUq0rqQ==</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice total files:   </span><span style="color:#F78C6C;">3</span><span style="color:#C3E88D;">                                       </span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice </span></span>
<span class="line"><span style="color:#FFCB6B;">+</span><span style="color:#C3E88D;"> @frontend-lib/helper@0.0.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>可以看到发布成功，并标记是手动发布</p><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321124452671.png" alt="image-20230321124452671"></p><h3 id="ci-cd自动构建npm包" tabindex="-1">CI/CD自动构建npm包 <a class="header-anchor" href="#ci-cd自动构建npm包" aria-label="Permalink to &quot;CI/CD自动构建npm包&quot;">​</a></h3><p>以上便是手动发布npm包的整个流程，不过有很多不方便：</p><ul><li>存储发包token不能忘记</li><li>手动执行</li></ul><p>为了解决这些问题可以使用gitlab ci自动构建发布：</p><ol><li><p>创建ci文件，指定发布到main指定分支时进行发包</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># .gitlab-ci.yml</span></span>
<span class="line"><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> node:16-alpine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">stages</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;"> -</span><span style="color:#C3E88D;"> deploy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">deploy_npm</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;"> stage</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> deploy</span></span>
<span class="line"><span style="color:#F07178;"> only</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">  -</span><span style="color:#C3E88D;"> main</span></span>
<span class="line"><span style="color:#F07178;"> tags</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;"> -</span><span style="color:#C3E88D;"> testing</span></span>
<span class="line"><span style="color:#F07178;"> script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;"> -</span><span style="color:#C3E88D;"> npm config set registry https://registry.npm.taobao.org</span></span>
<span class="line"><span style="color:#89DDFF;"> -</span><span style="color:#C3E88D;"> npm install</span></span>
<span class="line"><span style="color:#89DDFF;"> -</span><span style="color:#C3E88D;"> npm run build</span></span>
<span class="line"><span style="color:#89DDFF;"> -</span><span style="color:#C3E88D;"> echo &quot;@frontend-lib:registry=http://192.168.10.10/api/v4/projects/\${CI_PROJECT_ID}/packages/npm/&quot; &gt; .npmrc</span></span>
<span class="line"><span style="color:#89DDFF;"> -</span><span style="color:#C3E88D;"> echo &quot;//192.168.10.10/api/v4/projects/\${CI_PROJECT_ID}/packages/npm/:_authToken=\${NPM_TOKEN}&quot; &gt;&gt; .npmrc</span></span>
<span class="line"><span style="color:#89DDFF;"> -</span><span style="color:#C3E88D;"> npm publish</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li><li><p>创建换将CI变量<code>NPM_TOKEN</code>，将值设置为发包的token</p><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321134742476.png" alt="image-20230321134742476"></p></li><li><p>为了防止后续开发可以删除本地<code>.npmrc</code>文件</p></li><li><p>修改版本号提交代码</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#676E95;font-style:italic;"># package.json</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># version: 0.0.3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> add .</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> cm -m </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">add ci(#0)</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> push</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p>查看流水线执行情况 <img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321135048568.png" alt="image-20230321135048568"></p><p><img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321135116085.png" alt="image-20230321135116085"></p></li><li><p>查看仓库，这里我发了两次 <img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321135219054.png" alt="image-20230321135219054"></p></li></ol><h2 id="使用npm包" tabindex="-1">使用npm包 <a class="header-anchor" href="#使用npm包" aria-label="Permalink to &quot;使用npm包&quot;">​</a></h2><p>使用npm包你可以用根端点或项目端点</p><ol><li><p>新建一个项目初始化，创建<code>.npmrc</code>文件，根据提示写入仓库地址： <img src="https://ihengshuai-demo1.oss-cn-beijing.aliyuncs.com/image-20230321140703921.png" alt="image-20230321140703921"></p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">@frontend-lib:registry</span><span style="color:#BABED8;">=http://192.168.10.10/api/v4/packages/npm/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如果你的项目或组需要权限才能访问就需要添加token</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># //192.168.10.10/api/v4/projects/4/packages/npm/:_authToken=jev-72gFiNtp1JGTLZFn</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>这里你可以选择根配置或者项目级别的配置都可以</p></blockquote></li><li><p>下载npm包</p><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight vp-code"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> i @frontend-lib/helper</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 示例</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;"> npm i @frontend-lib/helper</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> notice created a lockfile as package-lock.json. You should commit this file.</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> WARN use-gitlab-npm@1.0.0 No description</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> WARN use-gitlab-npm@1.0.0 No repository field.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">+</span><span style="color:#C3E88D;"> @frontend-lib/helper@0.0.3</span></span>
<span class="line"><span style="color:#FFCB6B;">added</span><span style="color:#F78C6C;"> 1</span><span style="color:#C3E88D;"> package in </span><span style="color:#F78C6C;">0.537</span><span style="color:#C3E88D;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 测试代码</span></span>
<span class="line"><span style="color:#FFCB6B;">➜</span><span style="color:#C3E88D;">  gitlab-npm node index.js             </span></span>
<span class="line"><span style="color:#FFCB6B;">5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ol><blockquote><p>如果你下载失败了如404、401，很大原因是没有权限，通过将项目或组的权限设置public解决，或者提供用户token就可以了</p></blockquote><h2 id="参考文档" tabindex="-1">参考文档 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档&quot;">​</a></h2><ul><li><a href="https://docs.gitlab.com/ee/user/packages/package_registry/" target="_blank" rel="noreferrer">https://docs.gitlab.com/ee/user/packages/package_registry/</a></li><li><a href="https://docs.gitlab.com/ee/user/packages/npm_registry/" target="_blank" rel="noreferrer">https://docs.gitlab.com/ee/user/packages/npm_registry/</a></li><li><a href="https://docs.gitlab.com/ee/user/packages/yarn_repository/" target="_blank" rel="noreferrer">https://docs.gitlab.com/ee/user/packages/yarn_repository/</a></li></ul>`,62);function i(y,F,b,D,m,u){const a=n("Reward"),l=n("Gitalk");return t(),e("div",null,[c,s(a),s(l)])}const h=p(r,[["render",i]]);export{g as __pageData,h as default};
